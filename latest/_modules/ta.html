

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ta &mdash; pytwanalysis 0.0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://networkx.github.io/documentation/stable/_modules/ta.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pytwanalysis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datadictionary.html">Data Dictionary - (MongoDB Collections)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galery.html">Galery</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pytwanalysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>ta</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ta</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Main class</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pytwanalysis.py_twitter_db</span> <span class="kn">import</span> <span class="n">TwitterDB</span>
<span class="kn">from</span> <span class="nn">pytwanalysis.py_twitter_graphs</span> <span class="kn">import</span> <span class="n">TwitterGraphs</span>
<span class="kn">from</span> <span class="nn">pytwanalysis.py_twitter_topics</span> <span class="kn">import</span> <span class="n">TwitterTopics</span>

<span class="c1">#from pyTwitterGraphAnalysis import tw_graph</span>
<span class="c1">#from pyTwitterDB import tw_database</span>
<span class="c1">#from pyTwitterTopics import tw_topics</span>


<span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>


<span class="n">MIN_NO_OF_NODES_TO_REDUCE_GRAPH</span> <span class="o">=</span> <span class="mi">100</span>



<span class="k">class</span> <span class="nc">TwitterAnalysis</span><span class="p">(</span><span class="n">TwitterGraphs</span><span class="p">,</span> <span class="n">TwitterDB</span><span class="p">,</span> <span class="n">TwitterTopics</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main class - It inherits TwitterGraphs, TwitterDB, and TwitterTopics classes.    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">base_folder_path</span><span class="p">,</span> 
            <span class="n">mongoDB_database</span><span class="p">):</span>
        
        <span class="n">TwitterGraphs</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_folder_path</span><span class="p">)</span>
        <span class="n">TwitterDB</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongoDB_database</span><span class="p">)</span>
        <span class="n">TwitterTopics</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_folder_path</span><span class="p">,</span> <span class="n">mongoDB_database</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">=</span> <span class="s1">&#39;user_conn_all&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes_edges_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graphs_files_flag</span> <span class="o">=</span><span class="s1">&#39;Y&#39;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">create_topic_model_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ht_frequency_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">create_words_frequency_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_timeseries_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_top_nodes_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">create_community_files_flag</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ht_conn_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_of_topics</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_no_word_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_ht_to_ignore</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_nodes</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_edges</span> <span class="o">=</span> <span class="mi">2000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graph_without_node_scale_flag</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graph_with_node_scale_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_reduced_graph_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_comty_contract_per</span> <span class="o">=</span> <span class="mi">90</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edge_weight</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edges</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_start</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_end</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_top_degree_start</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_top_degree_end</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commty_edge_size_cutoff</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_conn_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;UserConnections_&#39;</span>
        

        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: setConfigs</span>
    <span class="c1"># Description: Configure objects settings</span>
<div class="viewcode-block" id="TwitterAnalysis.setConfigs"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.setConfigs.html#ta.TwitterAnalysis.setConfigs">[docs]</a>    <span class="k">def</span> <span class="nf">setConfigs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_all&#39;</span><span class="p">,</span> 
            <span class="n">is_bot_Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">period_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">create_nodes_edges_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_graphs_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_topic_model_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_ht_frequency_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_words_frequency_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_timeseries_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>   
            <span class="n">create_top_nodes_files_flag</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_community_files_flag</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> 
            <span class="n">create_ht_conn_files_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
            <span class="n">num_of_topics</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
            <span class="n">top_no_word_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">top_ht_to_ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">graph_plot_cutoff_no_nodes</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> 
            <span class="n">graph_plot_cutoff_no_edges</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">create_graph_without_node_scale_flag</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> 
            <span class="n">create_graph_with_node_scale_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">create_reduced_graph_flag</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
            <span class="n">reduced_graph_comty_contract_per</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
            <span class="n">reduced_graph_remove_edge_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">reduced_graph_remove_edges</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>                            
            <span class="n">top_degree_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">top_degree_end</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
            <span class="n">period_top_degree_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">period_top_degree_end</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
            <span class="n">commty_edge_size_cutoff</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure the current object settings to drive the automation of the analysis files</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        type_of_graph : (Optional)</span>
<span class="sd">            This setting defines the type of graph to analyze. Six different options are available: user_conn_all, user_conn_retweet, user_conn_quote, user_conn_reply, user_conn_mention, and ht_conn.</span>
<span class="sd">            (Default=&#39;user_conn_all&#39;)</span>
<span class="sd">        </span>
<span class="sd">        is_bot_Filter : (Default=None)</span>
<span class="sd">        </span>
<span class="sd">        period_arr : (Optional)</span>
<span class="sd">            An array of start and end dates can be set so that the pipeline creates a separate analysis folder for each of the periods in the array. (Default=None)</span>
<span class="sd">        </span>
<span class="sd">        create_nodes_edges_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will create two files for each graph and sub-graph. One file with the edge list, and one with the node list and their respective degree.(Default=&#39;Y&#39;) </span>
<span class="sd">        </span>
<span class="sd">        create_graphs_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will plot the graph showing all the connections.</span>
<span class="sd">            (Default=&#39;Y&#39;)</span>
<span class="sd">        </span>
<span class="sd">        create_topic_model_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will create topic discovery related files for each folder. It will create a text file with all the tweets that are part of that folder, it will also train a LDA model based on the tweets texts and plot a graph with the results.</span>
<span class="sd">            (Default=&#39;Y&#39;)</span>
<span class="sd">        </span>
<span class="sd">        create_ht_frequency_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will create hashtag frequency files for each folder. It will create a text file with the full list of hashtags and their frequency, a wordcloud showing the most frequently used hashtags, and barcharts showing the top 30 hashtags.</span>
<span class="sd">            (Default=&#39;y&#39;)&#39;</span>
<span class="sd">        </span>
<span class="sd">        create_words_frequency_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will create word frequency files for each folder. It will create a text file with a list of words and their frequency, a wordcloud showing the most frequently used words, and barcharts showing the top 30 words.</span>
<span class="sd">            (Default=&#39;Y&#39;) </span>
<span class="sd">        </span>
<span class="sd">        create_timeseries_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will create timeseries graphs for each folder representing the tweet count by day, and the top hashtags frequency count by day.</span>
<span class="sd">            (Default=&#39;Y&#39;)    </span>
<span class="sd">        </span>
<span class="sd">        create_top_nodes_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will create separate analysis folders for all the top degree nodes.</span>
<span class="sd">            (Default=&#39;Y&#39;) </span>
<span class="sd">        </span>
<span class="sd">        create_community_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will use the louvain method to assign each node to a community. A separate folder for each of the communities will be created with all the analysis files.</span>
<span class="sd">            (Default=&#39;N&#39;) </span>
<span class="sd">        </span>
<span class="sd">        create_ht_conn_files_flag : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, the pipeline will plot hashtag connections graphs. This can be used when user connections are being analyzed, but it could still be interesting to see the hashtags connections made by that group of users.</span>
<span class="sd">            (Default=&#39;Y&#39;) </span>
<span class="sd">        </span>
<span class="sd">        num_of_topics : (Optional)</span>
<span class="sd">            If the setting *CREATE_TOPIC_MODEL_FILES_FLAG* was set to &#39;Y&#39;, then this number will be used to send as input to the LDA model. If no number is given, the pipeline will use 4 as the default value.</span>
<span class="sd">            (Default=4) </span>
<span class="sd">        </span>
<span class="sd">        top_no_word_filter : (Optional)</span>
<span class="sd">            If the setting *CREATE_WORDS_FREQUENCY_FILES_FLAG* was set to &#39;Y&#39;, then this number will be used to decide how many words will be saved in the word frequency list text file. If no number is given, the pipeline will use 5000 as the default value.</span>
<span class="sd">            (Default=None)</span>
<span class="sd">        </span>
<span class="sd">        top_ht_to_ignore : (Optional)</span>
<span class="sd">            If the setting *CREATE_HT_CONN_FILES_FLAG* was set to &#39;Y&#39;, then this number will be used to choose how many top hashtags can be ignored. Sometimes ignoring the main hashtag can be helpful in visualizations to discovery other interesting structures within the graph.</span>
<span class="sd">            (Default=None)</span>
<span class="sd">        </span>
<span class="sd">        graph_plot_cutoff_no_nodes : (Optional)</span>
<span class="sd">            Used with the graph_plot_cutoff_no_edges parameter. For each graph created, these numbers will be used as cutoff values to decide if a graph is too large to be plot or not. Choosing a large number can result in having the graph to take a long time to run. Choosing a small number can result in graphs that are too reduced and with little value or even graphs that can&#39;t be printed at all because they can&#39;t be reduce further. </span>
<span class="sd">            (Default=500) </span>
<span class="sd">        </span>
<span class="sd">        graph_plot_cutoff_no_edges : (Optional) </span>
<span class="sd">            Used with the graph_plot_cutoff_no_nodes parameter. For each graph created, these numbers will be used as cutoff values to decide if a graph is too large to be plot or not. Choosing a large number can result in having the graph to take a long time to run. Choosing a small number can result in graphs that are too reduced and with little value or even graphs that can&#39;t be printed at all because they can&#39;t be reduce further. </span>
<span class="sd">            (Default=2000)</span>
<span class="sd">        </span>
<span class="sd">        create_graph_without_node_scale_flag : (Optional)</span>
<span class="sd">            For each graph created, if this setting is set to &#39;Y&#39;, the pipeline will try to plot the full graph with no reduction and without any logic for scaling the node size.</span>
<span class="sd">            (Default=&#39;N&#39;) </span>
<span class="sd">        </span>
<span class="sd">        create_graph_with_node_scale_flag : (Optional)</span>
<span class="sd">            For each graph created, if this setting is set to &#39;Y&#39;, the pipeline will try to plot the full graph with no reduction, but with additional logic for scaling the node size.</span>
<span class="sd">            (Default=&#39;Y&#39;) </span>
<span class="sd">        </span>
<span class="sd">        create_reduced_graph_flag : (Optional)</span>
<span class="sd">            For each graph created, if this setting is set to &#39;Y&#39;, the pipeline will try to plot the reduced form of the graph.</span>
<span class="sd">            (Default=&#39;Y&#39;) </span>
<span class="sd">        </span>
<span class="sd">        reduced_graph_comty_contract_per : (Optional)</span>
<span class="sd">            If the setting *CREATE_REDUCED_GRAPH_FLAG* was set to &#39;Y&#39;, then this number will be used to reduce the graphs by removing a percentage of each community found in that particular graph. The logic can be run multiple times with different percentages. For each time, a new graph file will be saved with a different name according to the parameter given.</span>
<span class="sd">            (Default=90) </span>
<span class="sd">        </span>
<span class="sd">        reduced_graph_remove_edge_weight : (Optional)</span>
<span class="sd">            If the setting *CREATE_REDUCED_GRAPH_FLAG* was set to &#39;Y&#39;, then this number will be used to reduce the graphs by removing edges that have weights smaller then this number. The logic can be run multiple times with different percentages. For each time, a new graph file will be saved with a different name according to the parameter given.</span>
<span class="sd">            (Default=None)</span>
<span class="sd">        </span>
<span class="sd">        reduced_graph_remove_edges : (Optional)</span>
<span class="sd">            If this setting is set to &#39;Y&#39;, and the setting *CREATE_REDUCED_GRAPH_FLAG was set to &#39;Y&#39;, then the pipeline will continuously try to reduce the graphs by removing edges of nodes with degrees smaller than this number. It will stop the graph reduction once it hits the the values set int the GRAPH_PLOT_CUTOFF parameters.</span>
<span class="sd">            (Default=&#39;Y&#39;)     </span>
<span class="sd">        </span>
<span class="sd">        top_degree_start : (Optional)</span>
<span class="sd">            If the setting  *CREATE_TOP_NODES_FILES_FLAG* was set to &#39;Y&#39;, then these numbers will define how many top degree node sub-folders to create.</span>
<span class="sd">            (Default=1) </span>
<span class="sd">        </span>
<span class="sd">        top_degree_end : (Optional)</span>
<span class="sd">            If the setting  *CREATE_TOP_NODES_FILES_FLAG* was set to &#39;Y&#39;, then these numbers will define how many top degree node sub-folders to create.</span>
<span class="sd">            (Default=10) </span>
<span class="sd">        </span>
<span class="sd">        period_top_degree_start : (Optional)</span>
<span class="sd">            If the setting  *CREATE_TOP_NODES_FILES_FLAG* was set to &#39;Y&#39;, then these numbers will define how many top degree node sub-folders for each period to create.</span>
<span class="sd">            (Default=1) </span>
<span class="sd">        </span>
<span class="sd">        period_top_degree_end : (Optional)</span>
<span class="sd">            If the setting  *CREATE_TOP_NODES_FILES_FLAG* was set to &#39;Y&#39;, then these numbers will define how many top degree node sub-folders for each period to create.</span>
<span class="sd">            (Default=5) </span>
<span class="sd">        </span>
<span class="sd">        commty_edge_size_cutoff : (Optional)</span>
<span class="sd">            If the setting textit{CREATE_COMMUNITY_FILES_FLAG} was set to &#39;Y&#39;, then this number will be used as the community size cutoff number. Any communities that have less nodes then this number will be ignored. If no number is given, the pipeline will use 200 as the default value.</span>
<span class="sd">            (Default=200)                 </span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">        ...:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; setConfigs(type_of_graph=TYPE_OF_GRAPH,</span>
<span class="sd">            &gt;&gt;&gt;             is_bot_Filter=IS_BOT_FILTER,</span>
<span class="sd">            &gt;&gt;&gt;             period_arr=PERIOD_ARR,</span>
<span class="sd">            &gt;&gt;&gt;             create_nodes_edges_files_flag=CREATE_NODES_EDGES_FILES_FLAG, </span>
<span class="sd">            &gt;&gt;&gt;             create_graphs_files_flag=CREATE_GRAPHS_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             create_topic_model_files_flag=CREATE_TOPIC_MODEL_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             create_ht_frequency_files_flag=CREATE_HT_FREQUENCY_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             create_words_frequency_files_flag=CREATE_WORDS_FREQUENCY_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             create_timeseries_files_flag=CREATE_TIMESERIES_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             create_top_nodes_files_flag=CREATE_TOP_NODES_FILES_FLAG, </span>
<span class="sd">            &gt;&gt;&gt;             create_community_files_flag=CREATE_COMMUNITY_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             create_ht_conn_files_flag=CREATE_HT_CONN_FILES_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             num_of_topics=NUM_OF_TOPICS, </span>
<span class="sd">            &gt;&gt;&gt;             top_no_word_filter=TOP_NO_WORD_FILTER, </span>
<span class="sd">            &gt;&gt;&gt;             top_ht_to_ignore=TOP_HT_TO_IGNORE,</span>
<span class="sd">            &gt;&gt;&gt;             graph_plot_cutoff_no_nodes=GRAPH_PLOT_CUTOFF_NO_NODES, </span>
<span class="sd">            &gt;&gt;&gt;             graph_plot_cutoff_no_edges=GRAPH_PLOT_CUTOFF_NO_EDGES,</span>
<span class="sd">            &gt;&gt;&gt;             create_graph_without_node_scale_flag=CREATE_GRAPH_WITHOUT_NODE_SCALE_FLAG, </span>
<span class="sd">            &gt;&gt;&gt;             create_graph_with_node_scale_flag=CREATE_GRAPH_WITH_NODE_SCALE_FLAG, </span>
<span class="sd">            &gt;&gt;&gt;             create_reduced_graph_flag=CREATE_REDUCED_GRAPH_FLAG,</span>
<span class="sd">            &gt;&gt;&gt;             reduced_graph_comty_contract_per=REDUCED_GRAPH_COMTY_PER,</span>
<span class="sd">            &gt;&gt;&gt;             reduced_graph_remove_edge_weight=REDUCED_GRAPH_REMOVE_EDGE_WEIGHT, </span>
<span class="sd">            &gt;&gt;&gt;             reduced_graph_remove_edges=REDUCED_GRAPH_REMOVE_EDGES_UNTIL_CUTOFF_FLAG,                            </span>
<span class="sd">            &gt;&gt;&gt;             top_degree_start=TOP_DEGREE_START, </span>
<span class="sd">            &gt;&gt;&gt;             top_degree_end=TOP_DEGREE_END, </span>
<span class="sd">            &gt;&gt;&gt;             period_top_degree_start=PERIOD_TOP_DEGREE_START, </span>
<span class="sd">            &gt;&gt;&gt;             period_top_degree_end=PERIOD_TOP_DEGREE_END, </span>
<span class="sd">            &gt;&gt;&gt;             commty_edge_size_cutoff=COMMTY_EDGE_SIZE_CUTOFF</span>
<span class="sd">            &gt;&gt;&gt;             )            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">=</span> <span class="n">type_of_graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span> <span class="o">=</span> <span class="n">is_bot_Filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span> <span class="o">=</span> <span class="n">period_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes_edges_files_flag</span> <span class="o">=</span> <span class="n">create_nodes_edges_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graphs_files_flag</span> <span class="o">=</span> <span class="n">create_graphs_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_topic_model_files_flag</span> <span class="o">=</span> <span class="n">create_topic_model_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ht_frequency_files_flag</span> <span class="o">=</span> <span class="n">create_ht_frequency_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_words_frequency_files_flag</span> <span class="o">=</span> <span class="n">create_words_frequency_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_timeseries_files_flag</span> <span class="o">=</span> <span class="n">create_timeseries_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_top_nodes_files_flag</span> <span class="o">=</span> <span class="n">create_top_nodes_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_community_files_flag</span> <span class="o">=</span> <span class="n">create_community_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ht_conn_files_flag</span> <span class="o">=</span> <span class="n">create_ht_conn_files_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_of_topics</span> <span class="o">=</span> <span class="n">num_of_topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_no_word_filter</span> <span class="o">=</span> <span class="n">top_no_word_filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_ht_to_ignore</span> <span class="o">=</span> <span class="n">top_ht_to_ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_nodes</span> <span class="o">=</span> <span class="n">graph_plot_cutoff_no_nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_edges</span> <span class="o">=</span> <span class="n">graph_plot_cutoff_no_edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graph_without_node_scale_flag</span> <span class="o">=</span> <span class="n">create_graph_without_node_scale_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_graph_with_node_scale_flag</span> <span class="o">=</span> <span class="n">create_graph_with_node_scale_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_reduced_graph_flag</span> <span class="o">=</span> <span class="n">create_reduced_graph_flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_comty_contract_per</span> <span class="o">=</span> <span class="n">reduced_graph_comty_contract_per</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edge_weight</span> <span class="o">=</span> <span class="n">reduced_graph_remove_edge_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edges</span> <span class="o">=</span> <span class="n">reduced_graph_remove_edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_start</span> <span class="o">=</span> <span class="n">top_degree_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_end</span> <span class="o">=</span> <span class="n">top_degree_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_top_degree_start</span> <span class="o">=</span> <span class="n">period_top_degree_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_top_degree_end</span> <span class="o">=</span> <span class="n">period_top_degree_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commty_edge_size_cutoff</span> <span class="o">=</span> <span class="n">commty_edge_size_cutoff</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;UserConnections_&#39;</span>                
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_mention&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;MentionUserConnections_&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;mention&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_retweet&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;RetweetUserConnections_&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;retweet&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_reply&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;ReplyUserConnections_&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;reply&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_quote&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;QuoteUserConnections_&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;quote&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;ht_conn&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;HTConnection_&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_type</span> <span class="o">=</span> <span class="s1">&#39;ht_edges&#39;</span></div>
        
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: create_path</span>
    <span class="c1"># Description: creates a path to add the files for this node        </span>
    <span class="k">def</span> <span class="nf">create_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>       
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: get_now_dt</span>
    <span class="c1"># Description: returns formated current timestamp to be printed</span>
    <span class="k">def</span> <span class="nf">get_now_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="c1">#####################################</span>
    <span class="c1"># Method: concat_edges</span>
    <span class="c1"># Description: aux function to concatenate edges to help filter in mongoDB</span>
<div class="viewcode-block" id="TwitterAnalysis.concat_edges"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.concat_edges.html#ta.TwitterAnalysis.concat_edges">[docs]</a>    <span class="k">def</span> <span class="nf">concat_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aux function to concatenate edges to help filter in mongoDB</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        G : </span>
<span class="sd">            undirected networkx graph created from the Twitter data                               </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        arr_edges</span>
<span class="sd">            the array with the concatenatd edges            </span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">        Create an array of concatenated edges from a networkx graph:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; arr_edges = concat_edges(G)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">arr_edges</span> <span class="o">=</span> <span class="p">[]</span>                        
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">arr_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span><span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">arr_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span><span class="n">u</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                                    
        <span class="k">return</span> <span class="n">arr_edges</span></div>

    <span class="c1">#####################################</span>
    <span class="c1"># Method: build_db_collections</span>
    <span class="c1"># Description: Call methods to create all collections in mongoDB</span>
<div class="viewcode-block" id="TwitterAnalysis.build_db_collections"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.build_db_collections.html#ta.TwitterAnalysis.build_db_collections">[docs]</a>    <span class="k">def</span> <span class="nf">build_db_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">bots_ids_list_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is in charge of extracting, cleaning, and loading the data </span>
<span class="sd">        into all the collections in MongoDB. </span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        inc : (Optional)</span>
<span class="sd">            used to determine how many tweets will be processed at a time - (Default=100000).</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">              </span>
<span class="sd">        bots_ids_list_file : (Optional)</span>
<span class="sd">            a file that contains a list of user ids that are bots. </span>
<span class="sd">            It creates flags in the MongoDB collection to indentify </span>
<span class="sd">            which tweets and user are in the bots list. - (Default=None)</span>
<span class="sd">                 </span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">        Load all data into all collections in MongoDB:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; inc = 50000</span>
<span class="sd">            &gt;&gt;&gt; build_db_collections(inc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="c1">### Loading Focused Data into MongoDB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadFocusedData</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
        
        <span class="c1">### Loading user information to collection</span>
        <span class="c1"># Loading user information for the actual tweet document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUsersData</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="s1">&#39;tweet&#39;</span><span class="p">)</span>
        <span class="c1"># Loading user information for the original tweet in case of retweets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUsersData</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="s1">&#39;retweet&#39;</span><span class="p">)</span>
        <span class="c1"># Loading user information for the quoted tweet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUsersData</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="s1">&#39;quote&#39;</span><span class="p">)</span>
        <span class="c1"># Loading user information for replies - </span>
        <span class="c1"># (in this case we we don&#39;t have full information about the user. Only screen_name and user_id)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUsersData</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="s1">&#39;reply&#39;</span><span class="p">)</span>
        <span class="c1"># Loading user information for mention - </span>
        <span class="c1"># (in this case we we don&#39;t have full information about the user. Only screen_name and sometimes user_id)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUsersData</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="s1">&#39;mention&#39;</span><span class="p">)</span>
        
        <span class="c1">### Breaking tweets into Words        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadWordsData</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
        
        <span class="c1">### Loading tweet connections - </span>
        <span class="c1"># These are the edges formed between users by replies, retweets, quotes and mentions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTweetConnections</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span> 
                                
        <span class="c1">### Loading tweet hashtag connections - </span>
        <span class="c1"># These are the edges formed between hash tags being used together in the same tweet        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTweetHTConnections</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span> 
        
        <span class="c1">#####</span>
        <span class="c1">### loading aggregate collections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadAggregations</span><span class="p">(</span><span class="s1">&#39;tweetCountByFile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadAggregations</span><span class="p">(</span><span class="s1">&#39;tweetCountByLanguageAgg&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadAggregations</span><span class="p">(</span><span class="s1">&#39;tweetCountByMonthAgg&#39;</span><span class="p">)</span>

        
        <span class="c1"># Loading bots list from file - (List of user ids that are bots)</span>
        <span class="c1"># SKIP this step if you don&#39;t have a bots list        </span>
        <span class="k">if</span> <span class="n">bots_ids_list_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bots_list_id_str</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bots_ids_list_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">bots_list_id_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_bot_flag_based_on_arr</span><span class="p">(</span><span class="n">bots_list_id_str</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span> </div>

        


                            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: plot_graph_contracted_nodes</span>
    <span class="c1"># Description: aux function to plot graph. </span>
    <span class="c1"># This steps repets in different parts of this code, so creating a function to avoid repetition</span>
<div class="viewcode-block" id="TwitterAnalysis.plot_graph_contracted_nodes"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.plot_graph_contracted_nodes.html#ta.TwitterAnalysis.plot_graph_contracted_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">plot_graph_contracted_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to compress and plot graph based on the graph reduction </span>
<span class="sd">        settings that can be updated using the *setConfigs* method.                </span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        G : </span>
<span class="sd">            undirected networkx graph created from the Twitter data</span>
<span class="sd">        file :</span>
<span class="sd">            the path and name of the graph you want to save</span>
<span class="sd">                </span>
<span class="sd">        Example</span>
<span class="sd">        --------                          </span>
<span class="sd">            &gt;&gt;&gt; plot_graph_contracted_nodes(G, &#39;c:\\Data\\MyGraph.png&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>   
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">MIN_NO_OF_NODES_TO_REDUCE_GRAPH</span><span class="p">:</span>                    
                    
            <span class="n">contraction_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Graph to plot before changes: nodes=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; edges=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">)))</span>
            
            
            <span class="c1">#in case we want to reduce the graph with edges of weight less than a cutoff number </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edge_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>               
                <span class="c1">#find list of edges that have that weigh cutoff</span>
                <span class="n">edges_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edge_weight</span><span class="p">]</span>                
                <span class="c1">#remove edges for the list</span>
                <span class="n">G2</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">edges_to_remove</span><span class="p">)</span>                
                <span class="c1">#get the largest connected component</span>
                <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>                
                <span class="n">contraction_name</span> <span class="o">=</span> <span class="n">contraction_name</span> <span class="o">+</span> <span class="s2">&quot;[RemEdgeWeightLessThan&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edge_weight</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
            

            <span class="c1">#reduce graph based on a percentage of the nodes for each community</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_comty_contract_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">MIN_NO_OF_NODES_TO_REDUCE_GRAPH</span><span class="p">:</span>
                <span class="n">att</span> <span class="o">=</span> <span class="s1">&#39;community_louvain&#39;</span>                
                <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_nodes_commty_per</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_comty_contract_per</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>                
                <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>                
                <span class="n">contraction_name</span> <span class="o">=</span> <span class="n">contraction_name</span> <span class="o">+</span> <span class="s2">&quot;[RemPercOfComty=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_comty_contract_per</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>

                
            <span class="c1">#In case we want to continue to remove until we get to a cutoff number, another level of contraction</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_graph_remove_edges</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">MIN_NO_OF_NODES_TO_REDUCE_GRAPH</span><span class="p">:</span>                                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
                    <span class="n">cutoff_no</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_edges_eithernode</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">cutoff_no</span><span class="p">)</span>
                    <span class="n">contraction_name</span> <span class="o">=</span> <span class="n">contraction_name</span> <span class="o">+</span> <span class="s1">&#39;[RemEdgeEitherNodeDegCutoff=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cutoff_no</span><span class="p">)</span> <span class="o">+</span>  <span class="s1">&#39;]&#39;</span>
                                    
                <span class="n">cutoff_no</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_nodes</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_edges</span><span class="p">):</span>
                    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_nodes</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_edges</span><span class="p">):</span>
                        
                        <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_edges</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">cutoff_no</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">cutoff_no</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span>
                            <span class="n">cutoff_no</span> <span class="o">+=</span> <span class="mi">10</span>
                        <span class="k">elif</span> <span class="n">cutoff_no</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
                            <span class="n">cutoff_no</span> <span class="o">+=</span> <span class="mi">100</span>
                        <span class="k">elif</span> <span class="n">cutoff_no</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
                            <span class="n">cutoff_no</span> <span class="o">+=</span> <span class="mi">500</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">cutoff_no</span> <span class="o">+=</span> <span class="mi">1000</span>
                             
                    <span class="n">contraction_name</span> <span class="o">=</span> <span class="n">contraction_name</span> <span class="o">+</span> <span class="s1">&#39;[RemEdgeBothNodesDegLessThan=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cutoff_no</span><span class="p">)</span> <span class="o">+</span>  <span class="s1">&#39;]&#39;</span>

            <span class="c1">#set up final file name with reduction parameters</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">contraction_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                

            <span class="c1">#get largest connected component after all removals</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>


            <span class="c1">#find best settings for the graphs depending on size. You can change these to get better graphs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">450</span><span class="p">:</span>
                <span class="n">v_scale</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span><span class="mf">0.7</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mi">2</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">:</span>
                <span class="n">v_scale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.8</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="n">v_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.6</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="n">v_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">500</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.6</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Graph to plot after changes: nodes=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; edges=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">)))</span>

            
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_nodes</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_edges</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                    <span class="n">G_to_plot</span><span class="p">,</span> <span class="n">labels2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_louvain_clustering</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotSpringLayoutGraph</span><span class="p">(</span><span class="n">G_to_plot</span><span class="p">,</span> 
                                               <span class="n">file</span><span class="p">,</span> 
                                               <span class="n">v_scale</span><span class="p">,</span> 
                                               <span class="n">v_k</span><span class="p">,</span> 
                                               <span class="n">v_iterations</span><span class="p">,</span> 
                                               <span class="n">cluster_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
                                               <span class="n">v_labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labels2</span><span class="p">)),</span> 
                                               <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </div>



    <span class="c1">#####################################</span>
    <span class="c1"># Method: export_mult_types_edges_for_input</span>
    <span class="c1"># Description: export edges that will be used to create graphs</span>
    <span class="c1"># User can choose only one type of graph to export the edges, or export them all</span>
<div class="viewcode-block" id="TwitterAnalysis.export_mult_types_edges_for_input"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.export_mult_types_edges_for_input.html#ta.TwitterAnalysis.export_mult_types_edges_for_input">[docs]</a>    <span class="k">def</span> <span class="nf">export_mult_types_edges_for_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will export edges from mongoDB data that can be used to create graphs.</span>
<span class="sd">        The user can choose only one type of graph to export the edges, or export them all</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        period_arr : (Optional)</span>
<span class="sd">            An array with showing the different periods to be analyzed separatly in the data.</span>
<span class="sd">            (Default = None)</span>
<span class="sd">            </span>
<span class="sd">        bot_filter_fl : (Optional)</span>
<span class="sd">            A flag to identify if you want to create extra edge files separating tweets by bots or not.</span>
<span class="sd">            This option is only available when the bot flag was updated in mongoDB using method set_bot_flag_based_on_arr.</span>
<span class="sd">            (Default=&#39;N&#39;)</span>
<span class="sd">            </span>
<span class="sd">        type_of_graph : (Optional)</span>
<span class="sd">            the type of graph to export the edges for. </span>
<span class="sd">            Available options: user_conn_all, user_conn_mention, </span>
<span class="sd">            user_conn_retweet, user_conn_reply, user_conn_quote, ht_conn, or all</span>
<span class="sd">            (Default=&#39;all&#39;)</span>
<span class="sd">                </span>
<span class="sd">        Example</span>
<span class="sd">        --------                          </span>
<span class="sd">            &gt;&gt;&gt; # Set up the periods you want to analyse </span>
<span class="sd">            &gt;&gt;&gt; # Set period_arr to None if you don&#39;t want to analyze separate periods</span>
<span class="sd">            &gt;&gt;&gt; # Format: Period Name, Period Start Date, Period End Date</span>
<span class="sd">            &gt;&gt;&gt; period_arr = [[&#39;P1&#39;, &#39;10/08/2017 00:00:00&#39;, &#39;10/15/2017 00:00:00&#39;],             </span>
<span class="sd">            &gt;&gt;&gt;               [&#39;P2&#39;, &#39;01/21/2018 00:00:00&#39;, &#39;02/04/2018 00:00:00&#39;],              </span>
<span class="sd">            &gt;&gt;&gt;               [&#39;P3&#39;, &#39;02/04/2018 00:00:00&#39;, &#39;02/18/2018 00:00:00&#39;],</span>
<span class="sd">            &gt;&gt;&gt;               [&#39;P4&#39;, &#39;02/18/2018 00:00:00&#39;, &#39;03/04/2018 00:00:00&#39;]]</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; ## TYPE OF GRAPH EDGES</span>
<span class="sd">            &gt;&gt;&gt; ########################################################</span>
<span class="sd">            &gt;&gt;&gt; # You can export edges for one type, or for all</span>
<span class="sd">            &gt;&gt;&gt; # Options: user_conn_all,       --All user connections</span>
<span class="sd">            &gt;&gt;&gt; #          user_conn_mention,   --Only Mentions user connections</span>
<span class="sd">            &gt;&gt;&gt; #          user_conn_retweet,   --Only Retweets user connections</span>
<span class="sd">            &gt;&gt;&gt; #          user_conn_reply,     --Only Replies user connections</span>
<span class="sd">            &gt;&gt;&gt; #          user_conn_quote,     --Only Quotes user connections</span>
<span class="sd">            &gt;&gt;&gt; #          ht_conn              --Hashtag connects - (Hashtgs that wereused together)</span>
<span class="sd">            &gt;&gt;&gt; #          all                  --It will export all of the above options</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; TYPE_OF_GRAPH = &#39;all&#39;</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; export_mult_types_edges_for_input(period_arr=period_arr, type_of_graph=TYPE_OF_GRAPH)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_all&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_mention&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_mention&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_retweet&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_retweet&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_reply&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_reply&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_quote&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_quote&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;ht_conn&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;ht_conn&#39;</span><span class="p">)</span></div>


        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: export_all_edges_for_input</span>
    <span class="c1"># Description: export edges that will be used to create graphs</span>
    <span class="k">def</span> <span class="nf">export_all_edges_for_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="s1">&#39;user_conn_all&#39;</span><span class="p">):</span>
                                
        <span class="c1"># Creates path to add the edge files to be used as input</span>
        <span class="n">input_files_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">data_input_files&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">input_files_path</span><span class="p">)</span>                    
        
        <span class="c1"># </span>
        <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">user_conn_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">export_type</span> <span class="o">=</span> <span class="s1">&#39;edges&#39;</span>
        <span class="k">if</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_all&#39;</span><span class="p">:</span>
            <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;UserConnections_&#39;</span>                
        <span class="k">elif</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_mention&#39;</span><span class="p">:</span>
            <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;MentionUserConnections_&#39;</span>
            <span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;mention&#39;</span>
        <span class="k">elif</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_retweet&#39;</span><span class="p">:</span>
            <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;RetweetUserConnections_&#39;</span>
            <span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;retweet&#39;</span>
        <span class="k">elif</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_reply&#39;</span><span class="p">:</span>
            <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;ReplyUserConnections_&#39;</span>
            <span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;reply&#39;</span>
        <span class="k">elif</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;user_conn_quote&#39;</span><span class="p">:</span>
            <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;QuoteUserConnections_&#39;</span>
            <span class="n">user_conn_filter</span> <span class="o">=</span> <span class="s1">&#39;quote&#39;</span>
        <span class="k">elif</span> <span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;ht_conn&#39;</span><span class="p">:</span>
            <span class="n">edge_prefix_str</span> <span class="o">=</span> <span class="s1">&#39;HTConnection_&#39;</span>
            <span class="n">export_type</span> <span class="o">=</span> <span class="s1">&#39;ht_edges&#39;</span>                    

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;** exporting edges - Graph type=&quot;</span> <span class="o">+</span> <span class="n">type_of_graph</span> <span class="p">)</span>        

        <span class="c1"># Export ALL edges for ALL periods</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**   exporting edges for AllPeriods &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="n">export_type</span><span class="p">,</span> 
                        <span class="n">input_files_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;AllPeriods_&#39;</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">,</span> 
                        <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>        
                
            
        <span class="k">if</span> <span class="n">bot_filter_fl</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="c1"># Export edges for ALL periods, excluding edges associated with bots</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**   exporting edges for AllPeriods_ExcludingBots - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="n">export_type</span><span class="p">,</span> 
                            <span class="n">input_files_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;AllPeriods_ExcludingBots_&#39;</span><span class="p">,</span>
                            <span class="mi">0</span><span class="p">,</span> 
                            <span class="n">is_bot_Filter</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> 
                            <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">,</span> 
                            <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Export edges for ALL periods, only edges associated with bots</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**   exporting edges for AllPeriods_BotsOnly - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="n">export_type</span><span class="p">,</span> 
                            <span class="n">input_files_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;AllPeriods_BotsOnly_&#39;</span><span class="p">,</span> 
                            <span class="mi">0</span><span class="p">,</span> 
                            <span class="n">is_bot_Filter</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> 
                            <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">,</span> 
                            <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                        


        <span class="c1"># Export edges by period using the dates set on array period_arr</span>
        <span class="k">if</span> <span class="n">period_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">period_arr</span><span class="p">):</span>

                <span class="c1"># Export ALL edges for this period    </span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**   exporting edges for &quot;</span> <span class="o">+</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="n">export_type</span><span class="p">,</span> 
                                        <span class="n">input_files_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                                        <span class="n">startDate_filter</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                        <span class="n">endDate_filter</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                                        <span class="n">is_bot_Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                        <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">,</span> 
                                        <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">bot_filter_fl</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                    <span class="c1"># Export edges for this period, excluding edges associated with bots</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**   exporting edges for &quot;</span> <span class="o">+</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_ExcludingBots - &quot;</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
                    <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="n">export_type</span><span class="p">,</span> 
                                            <span class="n">input_files_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_ExcludingBots_&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                                            <span class="n">startDate_filter</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                            <span class="n">endDate_filter</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                                            <span class="n">is_bot_Filter</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> 
                                            <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">,</span> 
                                            <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 

                    <span class="c1"># Export edges for this period, only edges associated with bots        </span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**   exporting edges for &quot;</span> <span class="o">+</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_BotsOnly - &quot;</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
                    <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="n">export_type</span><span class="p">,</span> 
                                            <span class="n">input_files_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_BotsOnly_&#39;</span><span class="p">,</span> 
                                            <span class="mi">0</span><span class="p">,</span> 
                                            <span class="n">startDate_filter</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                            <span class="n">endDate_filter</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                                            <span class="n">is_bot_Filter</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> 
                                            <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">,</span> 
                                            <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;** exporting edges - END *** - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>


        
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: nodes_edges_analysis_files</span>
    <span class="c1"># Description: creates nodes and edges files       </span>
<div class="viewcode-block" id="TwitterAnalysis.nodes_edges_analysis_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.nodes_edges_analysis_files.html#ta.TwitterAnalysis.nodes_edges_analysis_files">[docs]</a>    <span class="k">def</span> <span class="nf">nodes_edges_analysis_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a graph G, it exports nodes with they degree, edges with their weight, </span>
<span class="sd">        and word clouds representing the nodes scaled  by their degree</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        G : </span>
<span class="sd">            undirected networkx graph created from the Twitter data                               </span>
<span class="sd">        path :</span>
<span class="sd">            the path where the files should be saved</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Saved node and edges files into path:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; nodes_edges_analysis_files(G, &#39;C:\\Data\\MyFilePath&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Exporting nodes and edges to file - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_nodes_edges_to_file</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">G_NodesWithDegree.txt&quot;</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">G_Edges.txt&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Ploting Nodes Wordcloud - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>        
        <span class="n">node_file_name</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">G_NodesWithDegree.txt&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_freq_list_file</span><span class="p">(</span><span class="n">node_file_name</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_word_cloud</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">G_Nodes_WordCloud.png&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: lda_analysis_files</span>
    <span class="c1"># Description: creates topic model files</span>
    <span class="c1"># tweet texts, lda model visualization</span>
<div class="viewcode-block" id="TwitterAnalysis.lda_analysis_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.lda_analysis_files.html#ta.TwitterAnalysis.lda_analysis_files">[docs]</a>    <span class="k">def</span> <span class="nf">lda_analysis_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates topic model files. Export a files with tweet texts and a lda model visualization.</span>
<span class="sd">        The data comes from the mongoDB database and is filtered based on the parameters.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        path :</span>
<span class="sd">            the path where the files should be saved</span>
<span class="sd">        </span>
<span class="sd">        startDate_filter : (Optional)</span>
<span class="sd">            filter by a certain start date</span>
<span class="sd">            </span>
<span class="sd">        endDate_filter : (Optional)</span>
<span class="sd">            filter by a certain end date</span>
<span class="sd">        </span>
<span class="sd">        arr_edges : (Optional)</span>
<span class="sd">            and array of concatenated edges that will be used to filter certain connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">        </span>
<span class="sd">        arr_ht_edges : (Optional)</span>
<span class="sd">            and array of concatenated hashtag edges that will be used to filter certain ht connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array. </span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Save lda analysis files into path:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; lda_analysis_files(</span>
<span class="sd">            &gt;&gt;&gt;     &#39;D:\\Data\\MyFiles&#39;, </span>
<span class="sd">            &gt;&gt;&gt;     startDate_filter=&#39;09/20/2020 19:00:00&#39;, </span>
<span class="sd">            &gt;&gt;&gt;     endDate_filter=&#39;03/04/2021 00:00:00&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="c1">#export text for topic analysis</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Exporting text for topic analysis - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="s1">&#39;text_for_topics&#39;</span><span class="p">,</span> 
                        <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">startDate_filter</span><span class="p">,</span> 
                        <span class="n">endDate_filter</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> 
                        <span class="n">arr_edges</span><span class="p">,</span> 
                        <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">,</span> 
                        <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Train LDA models and print topics</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Topic discovery analysis (lda model) ****** - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>        
        <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;Topics&quot;</span>
        <span class="n">topics_file_name</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_tweetTextsForTopics.txt&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Topics-(LDA model).png&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_model_from_file</span><span class="p">(</span><span class="n">topics_file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_of_topics</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;lda&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_topics</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Topics-(LDA model).png&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_of_topics</span><span class="p">,</span> <span class="s1">&#39;lda&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
        


    <span class="c1">#####################################</span>
    <span class="c1"># Method: ht_analysis_files</span>
    <span class="c1"># Description: creates hashtag frequency files</span>
    <span class="c1"># frequency file text, wordcloud, and barcharts</span>
<div class="viewcode-block" id="TwitterAnalysis.ht_analysis_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.ht_analysis_files.html#ta.TwitterAnalysis.ht_analysis_files">[docs]</a>    <span class="k">def</span> <span class="nf">ht_analysis_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates hashtag frequency files. Frequency text file, wordcloud, and barcharts.</span>
<span class="sd">        The data comes from the mongoDB database and is filtered based on the parameters.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        path :</span>
<span class="sd">            the path where the files should be saved</span>
<span class="sd">        </span>
<span class="sd">        startDate_filter : (Optional)</span>
<span class="sd">            filter by a certain start date</span>
<span class="sd">            </span>
<span class="sd">        endDate_filter : (Optional)</span>
<span class="sd">            filter by a certain end date</span>
<span class="sd">        </span>
<span class="sd">        arr_edges : (Optional)</span>
<span class="sd">            and array of concatenated edges that will be used to filter certain connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">        </span>
<span class="sd">        arr_ht_edges : (Optional)</span>
<span class="sd">            and array of concatenated hashtag edges that will be used to filter certain ht connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Save hashtag frequency files into path:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; ht_analysis_files(</span>
<span class="sd">            &gt;&gt;&gt;     &#39;D:\\Data\\MyFiles&#39;, </span>
<span class="sd">            &gt;&gt;&gt;     startDate_filter=&#39;09/20/2020 19:00:00&#39;, </span>
<span class="sd">            &gt;&gt;&gt;     endDate_filter=&#39;03/04/2021 00:00:00&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#export ht frequency list         </span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">****** Exporting ht frequency list - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="s1">&#39;ht_frequency_list&#39;</span><span class="p">,</span> 
                        <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">startDate_filter</span><span class="p">,</span> 
                        <span class="n">endDate_filter</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> 
                        <span class="n">arr_edges</span><span class="p">,</span> 
                        <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">,</span> 
                        <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>        
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Ploting HashTags Barchart and Wordcloud - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>                   
        <span class="n">ht_file_name</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_HT_FrequencyList.txt&#39;</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">ht_file_name</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>                        
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_freq_list_file</span><span class="p">(</span><span class="n">ht_file_name</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_top_freq_list</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;HashTag&#39;</span><span class="p">,</span> <span class="n">exclude_top_no</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_HT_Top30_BarChart.png&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_top_freq_list</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;HashTag&#39;</span><span class="p">,</span> <span class="n">exclude_top_no</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_HT_Top30_BarChart-(Excluding Top1).png&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_top_freq_list</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;HashTag&#39;</span><span class="p">,</span> <span class="n">exclude_top_no</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_HT_Top30_BarChart-(Excluding Top2).png&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_word_cloud</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_HT_WordCloud.png&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
        
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: words_analysis_files</span>
    <span class="c1"># Description: creates words frequency files</span>
    <span class="c1"># frequency file text, wordcloud, and barcharts</span>
<div class="viewcode-block" id="TwitterAnalysis.words_analysis_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.words_analysis_files.html#ta.TwitterAnalysis.words_analysis_files">[docs]</a>    <span class="k">def</span> <span class="nf">words_analysis_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates words frequency files. Frequency text file, wordcloud, and barcharts.</span>
<span class="sd">        The data comes from the mongoDB database and is filtered based on the parameters.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        path :</span>
<span class="sd">            the path where the files should be saved</span>
<span class="sd">        </span>
<span class="sd">        startDate_filter : (Optional)</span>
<span class="sd">            filter by a certain start date</span>
<span class="sd">            </span>
<span class="sd">        endDate_filter : (Optional)</span>
<span class="sd">            filter by a certain end date</span>
<span class="sd">        </span>
<span class="sd">        arr_edges : (Optional)</span>
<span class="sd">            and array of concatenated edges that will be used to filter certain connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">        </span>
<span class="sd">        arr_ht_edges : (Optional)</span>
<span class="sd">            and array of concatenated hashtag edges that will be used to filter certain ht connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Save words frequency files into path:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; words_analysis_files(</span>
<span class="sd">            &gt;&gt;&gt;     &#39;D:\\Data\\MyFiles&#39;, </span>
<span class="sd">            &gt;&gt;&gt;     startDate_filter=&#39;09/20/2020 19:00:00&#39;, </span>
<span class="sd">            &gt;&gt;&gt;     endDate_filter=&#39;03/04/2021 00:00:00&#39;)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>                
        <span class="c1">#export words frequency list </span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">****** Exporting words frequency list - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="s1">&#39;word_frequency_list&#39;</span><span class="p">,</span> 
                        <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">startDate_filter</span><span class="p">,</span> 
                        <span class="n">endDate_filter</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> 
                        <span class="n">arr_edges</span><span class="p">,</span> 
                        <span class="n">arr_ht_edges</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">top_no_word_filter</span><span class="p">,</span> 
                        <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Ploting Word Barchart and Wordcloud - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>                   
        <span class="n">word_file_name</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_Words_FrequencyList.txt&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">word_file_name</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_freq_list_file</span><span class="p">(</span><span class="n">word_file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_top_freq_list</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;Word&#39;</span><span class="p">,</span> <span class="n">exclude_top_no</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_Words_Top30_BarChart.png&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_word_cloud</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">T_Words_WordCloud.png&#39;</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
        

    <span class="c1">#####################################</span>
    <span class="c1"># Method: time_series_files</span>
    <span class="c1"># Description: creates time frequency files    </span>
<div class="viewcode-block" id="TwitterAnalysis.time_series_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.time_series_files.html#ta.TwitterAnalysis.time_series_files">[docs]</a>    <span class="k">def</span> <span class="nf">time_series_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates timeseries frequency files. Tweet count by day and hashcount count by day.</span>
<span class="sd">        The data comes from the mongoDB database and is filtered based on the parameters.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        path :</span>
<span class="sd">            the path where the files should be saved</span>
<span class="sd">        </span>
<span class="sd">        startDate_filter : (Optional)</span>
<span class="sd">            filter by a certain start date</span>
<span class="sd">            </span>
<span class="sd">        endDate_filter : (Optional)</span>
<span class="sd">            filter by a certain end date</span>
<span class="sd">        </span>
<span class="sd">        arr_edges : (Optional)</span>
<span class="sd">            and array of concatenated edges that will be used to filter certain connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">        </span>
<span class="sd">        arr_ht_edges : (Optional)</span>
<span class="sd">            and array of concatenated hashtag edges that will be used to filter certain ht connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Save timeseries frequency files into path:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; time_series_files(</span>
<span class="sd">            &gt;&gt;&gt;    &#39;D:\\Data\\MyFiles&#39;, </span>
<span class="sd">            &gt;&gt;&gt;    startDate_filter=&#39;09/20/2020 19:00:00&#39;, </span>
<span class="sd">            &gt;&gt;&gt;    endDate_filter=&#39;03/04/2021 00:00:00&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        
                          
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Exporting time series files - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>           
        <span class="n">tweet_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_series_df</span><span class="p">(</span><span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>
        
        <span class="c1">#plot time series for all tweets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TS_TweetCount.png&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span><span class="n">tweet_df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span> <span class="s1">&#39;tweet_created_at&#39;</span><span class="p">],</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TS_TweetCount.png&#39;</span><span class="p">)</span>   
        
        <span class="c1">#plot time series for top hashtags [1-5]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TS_TweetCountByHT[1-5].png&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_top_ht_timeseries</span><span class="p">(</span><span class="n">top_no_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">top_no_end</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TS_TweetCountByHT[1-5].png&#39;</span><span class="p">,</span> 
                                        <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>
            
        <span class="c1">#plot time series for top hashtags [3-10]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TS_TweetCountByHT[3-10].png&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_top_ht_timeseries</span><span class="p">(</span><span class="n">top_no_start</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">top_no_end</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TS_TweetCountByHT[3-10].png&#39;</span><span class="p">,</span> 
                                        <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span></div>
    
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: ht_connection_files</span>
    <span class="c1"># Description: creates hashags graph connections files</span>
<div class="viewcode-block" id="TwitterAnalysis.ht_connection_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.ht_connection_files.html#ta.TwitterAnalysis.ht_connection_files">[docs]</a>    <span class="k">def</span> <span class="nf">ht_connection_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                                                                       
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Exporting ht connection files - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>        
    
        <span class="c1">#create file with ht edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exportData</span><span class="p">(</span><span class="s1">&#39;ht_edges&#39;</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> <span class="n">arr_edges</span><span class="p">)</span>                
        <span class="n">edge_file_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">ht_edges.txt&quot;</span> 
        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadGraphFromFile</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>    
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">isolates</span><span class="p">(</span><span class="n">G</span><span class="p">)):</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HT graph # of Nodes &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HT graph # of Edges &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_analysis_files</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">gr_prefix_nm</span> <span class="o">=</span> <span class="s1">&#39;HTG_&#39;</span><span class="p">)</span> 


        <span class="c1">#remove top hashtags if we want to ignore the top hashtags</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ht_to_ignore</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">remove_name</span> <span class="o">=</span> <span class="s1">&#39;[WITHOUT(&#39;</span>
            <span class="n">arr_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ht</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="n">arr_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">top_ht_to_ignore</span><span class="p">]:</span>            
                <span class="n">remove_name</span> <span class="o">=</span> <span class="n">remove_name</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">ht</span>
                <span class="n">G2</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">ht</span><span class="p">)</span>
            <span class="n">remove_name</span> <span class="o">=</span> <span class="n">remove_name</span> <span class="o">+</span> <span class="s1">&#39;)]&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">G2</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">G2</span><span class="p">))</span>    
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">isolates</span><span class="p">(</span><span class="n">G2</span><span class="p">)):</span>
                        <span class="n">G2</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>  
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HT graph # of Nodes &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HT graph # of Edges &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph_analysis_files</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">gr_prefix_nm</span> <span class="o">=</span> <span class="s1">&#39;HTG_&#39;</span> <span class="o">+</span> <span class="n">remove_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>                                                                </div>


    <span class="c1">#####################################</span>
    <span class="c1"># Method: graph_analysis_files</span>
    <span class="c1"># Description: creates graphs files</span>
<div class="viewcode-block" id="TwitterAnalysis.graph_analysis_files"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.graph_analysis_files.html#ta.TwitterAnalysis.graph_analysis_files">[docs]</a>    <span class="k">def</span> <span class="nf">graph_analysis_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">gr_prefix_nm</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot graph analysis files for a given graph G. </span>
<span class="sd">        It uses the configuration set on the setConfigs method.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        G : </span>
<span class="sd">            undirected networkx graph created from the Twitter data                               </span>
<span class="sd">        path :</span>
<span class="sd">            the path where the files should be saved</span>
<span class="sd">        </span>
<span class="sd">        gr_prefix_nm: (Optional)</span>
<span class="sd">            a prefix to add to the graph name. (Default=&#39;&#39;)</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">        Create graph visualization files</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; graph_analysis_files(G, &#39;C:\\Data\\MyAnalysis\\&#39;, &#39;MyNameTest&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>      
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        
            <span class="c1">#plot graph</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">****** Ploting graphs... *********** - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>                

            <span class="c1"># if not os.path.exists(path + &#39;\\&#39; + gr_prefix_nm + &#39;G_Graph.png&#39;) </span>
            <span class="c1"># and not os.path.exists(path + &#39;\\&#39; + gr_prefix_nm + &#39;G_Graph(WithoutScale).png&#39;):                        </span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_nodes</span> \
                 <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_plot_cutoff_no_edges</span><span class="p">)</span> \
                 <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> \
                 <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">MIN_NO_OF_NODES_TO_REDUCE_GRAPH</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">450</span><span class="p">:</span>
                    <span class="n">v_scale</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span><span class="mf">0.7</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mi">2</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">:</span>
                    <span class="n">v_scale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.8</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
                    <span class="n">v_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.6</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">:</span>
                    <span class="n">v_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">v_k</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span> <span class="n">v_iterations</span><span class="o">=</span><span class="mi">500</span><span class="p">;</span> <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.6</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_graph_with_node_scale_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                    <span class="n">G_to_plot</span><span class="p">,</span> <span class="n">labels2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_louvain_clustering</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotSpringLayoutGraph</span><span class="p">(</span><span class="n">G_to_plot</span><span class="p">,</span> 
                                               <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">gr_prefix_nm</span> <span class="o">+</span> <span class="s1">&#39;G_Graph.png&#39;</span><span class="p">,</span> 
                                               <span class="n">v_scale</span><span class="p">,</span> 
                                               <span class="n">v_k</span><span class="p">,</span> 
                                               <span class="n">v_iterations</span><span class="p">,</span> 
                                               <span class="n">cluster_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
                                               <span class="n">v_labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labels2</span><span class="p">)),</span> 
                                               <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_graph_without_node_scale_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotSpringLayoutGraph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> 
                                               <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">gr_prefix_nm</span> <span class="o">+</span> <span class="s1">&#39;G_Graph(WithoutScale).png&#39;</span><span class="p">,</span>
                                               <span class="n">v_scale</span><span class="p">,</span> 
                                               <span class="n">v_k</span><span class="p">,</span> 
                                               <span class="n">v_iterations</span><span class="p">,</span> 
                                               <span class="n">cluster_fl</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> 
                                               <span class="n">v_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                               <span class="n">scale_node_size_fl</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> 
                                               <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


            <span class="c1">#plot reduced graph</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_reduced_graph_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_graph_contracted_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">gr_prefix_nm</span> <span class="o">+</span> <span class="s1">&#39;G_Graph-(ReducedGraph).png&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
                        
            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: edge_files_analysis</span>
    <span class="c1"># Description: load graph from edge files and call methods to create all analysis </span>
    <span class="c1"># files for the main graph and for the graph of each period</span>
<div class="viewcode-block" id="TwitterAnalysis.edge_files_analysis"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.edge_files_analysis.html#ta.TwitterAnalysis.edge_files_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">edge_files_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automated way to generate all analysis files. </span>
<span class="sd">        It creates all folders, edge files, and any other files based on given settings. </span>
<span class="sd">        The setting of what files are interesting or not, should be set using the setConfigs method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        output_path :</span>
<span class="sd">            the path where the files should be saved        </span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Create all analysis files and folder based on the configurations set on setConfigs:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; edge_files_analysis(&#39;D:\\Data\\MyFiles&#39;) </span>
<span class="sd">        &quot;&quot;&quot;</span>      
                
        <span class="n">case_ht_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;ht_conn&#39;</span><span class="p">:</span>
            <span class="n">case_ht_str</span> <span class="o">=</span> <span class="s1">&#39;ht_&#39;</span>            

        <span class="c1">#Get the right edges file to import</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;All&#39;</span>
            <span class="n">edge_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">data_input_files</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;AllPeriods_&#39;</span> <span class="o">+</span> <span class="n">case_ht_str</span> <span class="o">+</span> <span class="s1">&#39;edges.txt&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">parent_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;ExcludingBots&#39;</span>
            <span class="n">edge_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">data_input_files</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span><span class="s1">&#39;AllPeriods_ExcludingBots_&#39;</span> <span class="o">+</span> <span class="n">case_ht_str</span> <span class="o">+</span> <span class="s1">&#39;edges.txt&#39;</span>            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">parent_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;Bots_Edges_Only&#39;</span>
            <span class="n">edge_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">data_input_files</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s1">&#39;AllPeriods_BotsOnly_&#39;</span> <span class="o">+</span> <span class="n">case_ht_str</span> <span class="o">+</span> <span class="s1">&#39;edges.txt&#39;</span>            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
            
        <span class="c1"># Load graph from edge file</span>
        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadGraphFromFile</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">)</span>
                
        <span class="c1"># Call method to print all analysis files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_analysis_file</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>                
                                       
          
        <span class="c1"># Run analysis by period using the dates set on array period_arr</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>                                    
            
            <span class="c1"># Creates a text file with the period information. </span>
            <span class="c1"># This is just so that whoever is looking at these folder can know what dates we used for each period</span>
            <span class="n">myFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">PeriodsInfo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">myFile</span><span class="p">:</span>
                <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">myFile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">)</span>
                    
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">):</span>                    

                <span class="c1"># Set the period information variables</span>
                <span class="n">period_name</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">period_start_date</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">period_end_date</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**********************************************************&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;************************** &quot;</span> <span class="o">+</span> <span class="n">period_name</span> <span class="o">+</span> <span class="s2">&quot; ****************************</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">)</span> 

                <span class="c1"># Edge file path </span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parent_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s2">&quot;All_By_Period</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">period_name</span>
                    <span class="n">edge_file_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">data_input_files</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="n">period_name</span> <span class="o">+</span><span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">case_ht_str</span> <span class="o">+</span> <span class="s2">&quot;edges.txt&quot;</span>                        
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span>  <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">parent_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s2">&quot;Excluding_Bots_By_Period</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">period_name</span>
                    <span class="n">edge_file_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">data_input_files</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="n">period_name</span> <span class="o">+</span> <span class="s2">&quot;_ExcludingBots_&quot;</span> <span class="o">+</span> <span class="n">case_ht_str</span> <span class="o">+</span> <span class="s2">&quot;edges.txt&quot;</span>                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span>  <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">parent_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="s2">&quot;Bots_Edges_Only_By_Period</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">period_name</span>                    
                    <span class="n">edge_file_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">data_input_files</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_prefix_str</span> <span class="o">+</span> <span class="n">period_name</span> <span class="o">+</span><span class="s2">&quot;_BotsOnly_&quot;</span> <span class="o">+</span> <span class="n">case_ht_str</span> <span class="o">+</span> <span class="s2">&quot;edges.txt&quot;</span>                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">period_arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_arr</span><span class="p">,</span> <span class="n">bot_filter_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">type_of_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span><span class="p">)</span>

                <span class="c1"># Create new path if it doesn&#39;t exist</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">)</span>

                <span class="c1">#load graph from edge file</span>
                <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadGraphFromFile</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">)</span>                
                
                <span class="c1">#call function to genrate all files for this graph</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_analysis_file</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="n">period_start_date</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="n">period_end_date</span><span class="p">)</span></div>
                                        
        

    <span class="c1">#####################################</span>
    <span class="c1"># Method: all_analysis_file</span>
    <span class="c1"># Description: Calls method to create all files for full dataset, for top degree nodes, and for community graphs</span>
    <span class="k">def</span> <span class="nf">all_analysis_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                                
        <span class="c1">#files for the main graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_analysis_file</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">)</span>
                                        
        <span class="c1">#files for the top nodes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_top_nodes_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">top_nodes_analysis</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">)</span>        
        
        <span class="c1">#files for community nodes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_community_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commty_analysis_files</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span>  <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">)</span>                                

            
            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: create_analysis_file</span>
    <span class="c1"># Description: calls individual methods to create files on the settings             </span>
    <span class="k">def</span> <span class="nf">create_analysis_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">G</span><span class="p">,</span> 
            <span class="n">output_path</span><span class="p">,</span> 
            <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                                
        <span class="c1">#export file with measures</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Graph Measures - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_Measures</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">fileName_to_print</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">G_Measures-(All).txt&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">arr_ht_edges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">==</span> <span class="s1">&#39;ht_conn&#39;</span><span class="p">:</span>
            <span class="n">arr_ht_edges</span> <span class="o">=</span> <span class="n">arr_edges</span>
            <span class="n">arr_edges</span> <span class="o">=</span> <span class="kc">None</span>            

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#get largest connected component and export file with measures</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Largest Component Graph Measures - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_Measures</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">fileName_to_print</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">G_Measures-(LargestCC).txt&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1">#export files with edges and degrees</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes_edges_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_edges_analysis_files</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
            
            <span class="c1">#LDA Model</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_topic_model_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lda_analysis_files</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> 
                                        <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                        <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                        <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> 
                                        <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>

            <span class="c1">#export ht frequency list </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_ht_frequency_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>           
                <span class="bp">self</span><span class="o">.</span><span class="n">ht_analysis_files</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> 
                                       <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                       <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                       <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> 
                                       <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>
                
            <span class="c1">#export words frequency list </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_words_frequency_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">words_analysis_files</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> 
                                          <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                          <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                          <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> 
                                          <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>
                                 
            <span class="c1">#plot graph</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_graphs_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph_analysis_files</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
                
            <span class="c1">#time series</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timeseries_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_series_files</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> 
                                       <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                       <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                       <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> 
                                       <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span> 

            <span class="c1">#hashtag connections</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_ht_conn_files_flag</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_graph</span> <span class="o">!=</span> <span class="s1">&#39;ht_conn&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ht_connection_files</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> 
                                         <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                         <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                         <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">)</span>
            
                           
        
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: top_nodes_analysis</span>
    <span class="c1"># Description: calls methods to create files for each of the top degree nodes</span>
    <span class="k">def</span> <span class="nf">top_nodes_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                      

        <span class="c1"># Choose which graph you want to run this for</span>
        <span class="n">Graph_to_analyze</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="n">top_degree_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_degree_nodes</span><span class="p">(</span><span class="n">Graph_to_analyze</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_end</span><span class="p">)</span>

        <span class="c1">#creates a folder to save the files for this analysis</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Top_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_degree_start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_degree_end</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_degree_end</span>
        <span class="c1"># loops through the top degree nodes, creates a subgraph for them and saves the results in a folder</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">top_degree_nodes</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1">#creates a subgraph for this node</span>
            <span class="n">G_subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_node_subgraph</span><span class="p">(</span><span class="n">Graph_to_analyze</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>    
            <span class="n">G_subgraph_largestComponent</span> <span class="o">=</span> <span class="n">G_subgraph</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">G_subgraph_largestComponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G_subgraph_largestComponent</span><span class="p">)</span>

            <span class="c1">#creates a path to add the files for this node</span>
            <span class="n">path_node</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">path_node</span><span class="p">)</span>
            
            <span class="c1">#get array with all edges for this top degree node                          </span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">arr_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_edges</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_analysis_file</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">,</span> 
                                          <span class="n">output_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">path_node</span><span class="p">,</span>
                                          <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                          <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                          <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">)</span>
    
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: commty_analysis_files</span>
    <span class="c1"># Description: calls methods to create files for each of the communities found </span>
    <span class="k">def</span> <span class="nf">commty_analysis_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">******************************************************&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;******** Louvain Communities ********&quot;</span><span class="p">)</span>
                            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>                                                
            
            <span class="c1"># Choose which graph you want to run this for</span>
            <span class="n">Graph_to_analyze</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>            
            
            <span class="c1">#creates a folder to save the files for this analysis</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Communities_(Louvain)&quot;</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;+&quot;</span>                        
            <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>                        

            <span class="c1">#calculate louvain community for largest connected component</span>
            <span class="n">Graph_to_analyze</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">Graph_to_analyze</span><span class="p">)</span> 
            <span class="n">Graph_to_analyze</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_louvain_clustering</span><span class="p">(</span><span class="n">Graph_to_analyze</span><span class="p">)</span>            
            
            <span class="n">comm_att</span> <span class="o">=</span> <span class="s1">&#39;community_louvain&#39;</span>

            <span class="c1">#find the number of communities in the graph</span>
            <span class="n">no_of_comm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">Graph_to_analyze</span><span class="p">,</span> <span class="n">comm_att</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>    

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;******************************************************&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total # of Communities &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_comm</span><span class="p">))</span>

            <span class="c1">#loop through the communities print they analysis files</span>
            <span class="k">for</span> <span class="n">commty</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_of_comm</span><span class="p">):</span>

                <span class="c1">#find subgraphs of this community</span>
                <span class="n">G_subgraph</span> <span class="o">=</span> <span class="n">Graph_to_analyze</span><span class="o">.</span><span class="n">subgraph</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">attrdict</span> <span class="ow">in</span> <span class="n">Graph_to_analyze</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attrdict</span> <span class="p">[</span><span class="n">comm_att</span><span class="p">]</span> <span class="o">==</span> <span class="n">commty</span> <span class="p">])</span>                                                
                <span class="c1">#only cares about communities with more than 1 node</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_subgraph</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commty_edge_size_cutoff</span><span class="p">:</span>

                    <span class="n">G_subgraph_largestComponent</span> <span class="o">=</span> <span class="n">G_subgraph</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">G_subgraph_largestComponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G_subgraph_largestComponent</span><span class="p">)</span>

                    <span class="c1">#creates a path to add the files for this node</span>
                    <span class="n">path_community</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Community-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commty</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">path_community</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;******************************************************&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****** Printing files for community &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commty</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ******&quot;</span><span class="p">)</span>
                    <span class="c1">#self.print_Measures(G_subgraph, False, False, False, False, fileName_to_print = path_community + &#39;\\G_&#39; + str(commty+1) + &#39;_Measures.txt&#39;)    </span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">arr_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_edges</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_analysis_file</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">,</span> <span class="n">path_community</span><span class="p">,</span>                                               
                                                  <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                                  <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span>                                               
                                                  <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">)</span>
                
                        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: get_time_series_df</span>
    <span class="c1"># Description: query data in mongoDB for timeseries analysis            </span>
<div class="viewcode-block" id="TwitterAnalysis.get_time_series_df"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.get_time_series_df.html#ta.TwitterAnalysis.get_time_series_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_series_df</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">ht_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        Method to query data in mongoDB for timeseries analysis given certain filters.</span>
<span class="sd">        It creates all folders, edge files, and any other files based on given settings. </span>
<span class="sd">        The setting of what files are interesting or not, should be set using the setConfigs method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        ht_arr :</span>
<span class="sd">            array of hashtags to filter the data from</span>
<span class="sd">        </span>
<span class="sd">        startDate_filter : (Optional)</span>
<span class="sd">            filter by a certain start date</span>
<span class="sd">            </span>
<span class="sd">        endDate_filter : (Optional)</span>
<span class="sd">            filter by a certain end date</span>
<span class="sd">        </span>
<span class="sd">        arr_edges : (Optional)</span>
<span class="sd">            and array of concatenated edges that will be used to filter certain connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">        </span>
<span class="sd">        arr_ht_edges : (Optional)</span>
<span class="sd">            and array of concatenated hashtag edges that will be used to filter certain ht connection only.</span>
<span class="sd">            the method concat_edges can be used to create that array.</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------        </span>
<span class="sd">            &gt;&gt;&gt; ...</span>
<span class="sd">        &quot;&quot;&quot;</span>   
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ht_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>        
            <span class="c1">#get timeseries for each of the top hashtags    </span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ht</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">):</span>
                <span class="n">arrData</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;tweet_ids_timeseries&#39;</span><span class="p">,</span> 
                                               <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                                               <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                               <span class="n">ht_to_filter</span><span class="o">=</span><span class="n">ht</span><span class="p">,</span> 
                                               <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                               <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                               <span class="n">is_bot_Filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> 
                                               <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span>
                                               <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>
                <span class="n">tweet_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">arrData</span><span class="p">))</span>
                <span class="n">tweet_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">,</span> <span class="n">ht</span><span class="p">]</span>   
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">tweet_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#get timeseries for all tweets</span>
            <span class="n">arrData</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;tweet_ids_timeseries&#39;</span><span class="p">,</span> 
                                           <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>                                                     
                                           <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                           <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                           <span class="n">is_bot_Filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> 
                                           <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span>
                                           <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">)</span>    
            <span class="n">tweet_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">arrData</span><span class="p">))</span>
            <span class="n">tweet_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;tweet&#39;</span><span class="p">]</span>   
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">tweet_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">df</span></div>


    <span class="c1">#####################################</span>
    <span class="c1"># Method: plot_top_ht_timeseries</span>
    <span class="c1"># Description: get top hashtags and plot their timeseries data</span>
<div class="viewcode-block" id="TwitterAnalysis.plot_top_ht_timeseries"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.plot_top_ht_timeseries.html#ta.TwitterAnalysis.plot_top_ht_timeseries">[docs]</a>    <span class="k">def</span> <span class="nf">plot_top_ht_timeseries</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">top_no_start</span><span class="p">,</span> 
            <span class="n">top_no_end</span><span class="p">,</span> 
            <span class="n">file</span><span class="p">,</span> 
            <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>        
        
        <span class="c1">#get the top hashtags to plot</span>
        <span class="n">ht_arr</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;ht_frequency_list&#39;</span><span class="p">,</span> 
                                   <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                   <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                   <span class="n">endDate_filter</span><span class="o">=</span> <span class="n">endDate_filter</span><span class="p">,</span> 
                                   <span class="n">is_bot_Filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_bot_Filter</span><span class="p">,</span> 
                                   <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">,</span> 
                                   <span class="n">arr_ht_edges</span><span class="o">=</span><span class="n">arr_ht_edges</span><span class="p">,</span>
                                   <span class="n">top_no_filter</span><span class="o">=</span><span class="n">top_no_end</span><span class="p">,</span> 
                                   <span class="n">include_hashsymb_FL</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">top_no_end</span><span class="p">:</span>
            <span class="n">top_no_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">)</span>
                        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">top_no_start</span> <span class="o">&gt;=</span> <span class="n">top_no_end</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">ht_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">)</span>
        <span class="n">ht_arr</span> <span class="o">=</span> <span class="n">ht_arr</span><span class="p">[</span><span class="n">top_no_start</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">top_no_end</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ht_arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">)</span>
        
        <span class="c1">#get the time series data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_series_df</span><span class="p">(</span><span class="n">ht_arr</span><span class="o">=</span><span class="n">ht_arr</span><span class="p">,</span> 
                                     <span class="n">startDate_filter</span><span class="o">=</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                     <span class="n">endDate_filter</span><span class="o">=</span><span class="n">endDate_filter</span><span class="p">,</span> 
                                     <span class="n">arr_edges</span><span class="o">=</span><span class="n">arr_edges</span><span class="p">)</span>

        <span class="c1">#plot timeseries graph</span>
        <span class="n">arr_columns</span> <span class="o">=</span> <span class="n">ht_arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">arr_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">arr_columns</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>


        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: plot_timeseries</span>
    <span class="c1"># Description: plot time series data</span>
<div class="viewcode-block" id="TwitterAnalysis.plot_timeseries"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.plot_timeseries.html#ta.TwitterAnalysis.plot_timeseries">[docs]</a>    <span class="k">def</span> <span class="nf">plot_timeseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">arr_columns</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>                      

        <span class="n">tweet_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">arr_columns</span><span class="p">]</span>
         <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">)</span>      
         <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span> 
         <span class="o">.</span><span class="n">count</span><span class="p">()</span>         
        <span class="p">);</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">tweet_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Tweet Count&quot;</span><span class="p">)</span>
        
        
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1">#plt.show()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span></div>
    
    
       
    <span class="c1">#####################################</span>
    <span class="c1"># Method: eda_analysis</span>
    <span class="c1"># Description: Save EDA files</span>
<div class="viewcode-block" id="TwitterAnalysis.eda_analysis"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.eda_analysis.html#ta.TwitterAnalysis.eda_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">eda_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        Method to print a summary of the initial exploratory data analysis for any dataset.        </span>

<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            &gt;&gt;&gt; # Create Exploratory Data Analysis files</span>
<span class="sd">            &gt;&gt;&gt; eda_analysis()</span>
<span class="sd">            </span>
<span class="sd">        It includes the following metrics:</span>
<span class="sd">        </span>
<span class="sd">        + **Tweet counts**: The number of tweet document in the database, divided by the following categories.</span>
<span class="sd">            </span>
<span class="sd">                + Total Original Tweets: The number of tweet documents in the database that are original tweets.		</span>
<span class="sd">                + Total Replies: The number of tweet documents in the database that are replies to another tweet.		</span>
<span class="sd">                + Total Retweets: The number of tweet documents in the database that are retweets.		</span>
<span class="sd">                + Total Tweets: The total number of tweet documents in the database.</span>
<span class="sd">            </span>
<span class="sd">        + **Tweet counts by language**: The number of tweets document for each language used in the tweets.</span>

<span class="sd">        + **Tweet counts by month**: The number of tweets document for each month/year.</span>

<span class="sd">        + **Tweet counts by file**: The number of tweets document imported from each of the json files.</span>

<span class="sd">        + **User counts**: The number of users in the database, divided by the following categories.</span>
<span class="sd">            </span>
<span class="sd">                + tweet: Users with at least one document in the database.</span>
<span class="sd">                + retweet: Users that were retweeted, but are not part of previous group.</span>
<span class="sd">                + quote: Users that were quoted, but are not part of previous groups.</span>
<span class="sd">                + reply: Users that were replied to, but are not part of previous groups.</span>
<span class="sd">                + mention: Users that were mentioned, but are not part of previous groups.</span>
<span class="sd">                        </span>
<span class="sd">        + **All User Connections Graph**: The metrics for the graph created based on the users connecting by retweets, quotes, mentions, and replies.</span>
<span class="sd">            </span>
<span class="sd">                + # of Nodes: The total number of nodes in the graph.</span>
<span class="sd">                + # of Edges: The total number of edges in the graph.</span>
<span class="sd">                + # of Nodes of the largest connected components: The total number of nodes in the largest connected component of the graph.</span>
<span class="sd">                + # of Edges of the largest connected components: The total number of edges in the largest connected component of the graph.                </span>
<span class="sd">                + # of Disconnected Graphs: The number of sub-graphs within the main graph that are not connected to each other.                </span>
<span class="sd">                + # of Louvain Communities found in the largest connected component: The number of communities found in the largest connected component using the Louvain method.                </span>
<span class="sd">                + Degree of the top 5 most connected users: List of the top 5 users with the highest degree. Shows the user screen name and respective degrees.                </span>
<span class="sd">                + Average Node Degree of largest connected graph: The average degree of all nodes that are part of the largest connected component of the graph.                </span>
<span class="sd">                + Plot of the Louvain community distribution: A barchart showing the node count distribution of the communities found with the Louvain method.</span>
<span class="sd">                + Disconnected graphs distribution: A plot of a graph showing the distribution of the disconnected graphs. It shows the total number of nodes and edges for each of the disconnected graphs. </span>
<span class="sd">                </span>
<span class="sd">        + **Mentions User Connections Graph**: The same metrics as the *All User Connections* graph, but only considering the connections made by mentions.</span>

<span class="sd">        + **Retweets User Connections Graph**: The same metrics as the *All User Connections* graph, but only considering the connections made by retweets.</span>

<span class="sd">        + **Replies User Connections Graph**: The same metrics as the *All User Connections* graph, but only considering the connections made by replies.</span>

<span class="sd">        + **HT Connection Graph**: The same metrics as the *All User Connections* graph, but only considering the connections made by hashtags.           </span>

<span class="sd">        &quot;&quot;&quot;</span>                 
        <span class="n">eda_folder</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>  <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">EDA&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">eda_folder</span><span class="p">)</span>                    
        <span class="n">eda_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">eda_folder</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">EDA.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                    
            
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Tweet counts ******&quot;</span><span class="p">)</span>
        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;**** Tweet counts ******</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;tweetCount&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>           
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Tweet counts by language ******&quot;</span><span class="p">)</span>           
        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Tweet counts by language ******</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;tweetCountByLanguage&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Tweet counts by month ******&quot;</span><span class="p">)</span>    
        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Tweet counts by month ******</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;tweetCountByMonth&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>   
        
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Tweet counts by file ******&quot;</span><span class="p">)</span>    
        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Tweet counts by file ******</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;tweetCountByFile&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                  
 

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** User counts ******&quot;</span><span class="p">)</span>    
        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** User counts ******</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="o">=</span><span class="s1">&#39;userCount&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">arr</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
        

            
        <span class="c1"># Graph EDA</span>
                        
        <span class="c1"># Load graph from main edges file if it does not exist </span>
        <span class="n">edge_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">data_input_files</span><span class="se">\\</span><span class="s1">UserConnections_AllPeriods_edges.txt&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_all_edges_for_input</span><span class="p">(</span><span class="n">type_of_graph</span> <span class="o">=</span> <span class="s1">&#39;user_conn_all&#39;</span><span class="p">)</span>
                    
        <span class="c1"># types of graph</span>
        <span class="n">arr_type_pre</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;UserConnections_&#39;</span><span class="p">,</span> <span class="s1">&#39;edges&#39;</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;MentionUserConnections_&#39;</span><span class="p">,</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;RetweetUserConnections_&#39;</span><span class="p">,</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;ReplyUserConnections_&#39;</span><span class="p">,</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;QuoteUserConnections_&#39;</span><span class="p">,</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;HTConnection_&#39;</span><span class="p">,</span> <span class="s1">&#39;ht_edges&#39;</span><span class="p">]]</span> 
        
        <span class="c1"># Loop through the type of graphs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_type_pre</span><span class="p">)):</span>                        
            
            <span class="c1"># find the edge file name</span>
            <span class="n">edge_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">data_input_files</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">arr_type_pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;AllPeriods_&#39;</span> <span class="o">+</span> <span class="n">arr_type_pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>            
            
            <span class="c1"># if the edge file already exists</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">):</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">*****************************************&#39;</span><span class="p">)</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**** &#39;</span> <span class="o">+</span> <span class="n">arr_type_pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; Graph ******&#39;</span><span class="p">)</span> 
                
                <span class="c1"># Construct the graph based on the edge file</span>
                <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadGraphFromFile</span><span class="p">(</span><span class="n">edge_file_path</span><span class="p">)</span>   
                
                <span class="c1"># if the graph is not empty</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Plot distribution of the separate connected components</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Connected Components - Distribution ******&quot;</span><span class="p">)</span> 
                    <span class="n">no_of_disc_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_disconnected_graph_distr</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">eda_folder</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">arr_type_pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;ConnectedComponents-(Graphs).png&#39;</span><span class="p">)</span>
                    <span class="n">no_of_disc_g_gt50</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_disconnected_graph_distr</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">size_cutoff</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
                    

                    <span class="c1">#calculate louvein community clustering</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Calculating Community Distribution of the Largest Connected Component- (Louvain) ******&quot;</span><span class="p">)</span> 
                    <span class="n">G2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G</span><span class="p">)</span> 
                    <span class="n">G2</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_louvain_clustering</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_graph_att_distr</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> 
                                              <span class="s1">&#39;community_louvain&#39;</span><span class="p">,</span>
                                              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Louvain Community Distribution for Largest Connected Component&#39;</span><span class="p">,</span>
                                              <span class="n">file_name</span><span class="o">=</span><span class="n">eda_folder</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">arr_type_pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;community_louvain_dist.png&#39;</span><span class="p">)</span>        

                    <span class="c1"># Degree arrays</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>                
                    <span class="c1">#deg_mean = np.asarray(arr[:,1], dtype=np.integer).mean()</span>
                    <span class="c1"># get the mean node degree of the nodes</span>
                    <span class="n">deg_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_average_node_degree</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Nodes &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Edges &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Nodes - (Largest Connected Component) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Edges - (Largest Connected Component) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">())))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Disconnected Graphs &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_disc_g</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Disconnected Graphs with 50 or more nodes &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_disc_g_gt50</span><span class="p">))</span>                    
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; # of Communities found in the largest connected component &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Degree of top 1 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Degree of top 2 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Degree of top 3 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Degree of top 4 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Degree of top 5 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Average Node Degree of largest connected graph &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deg_mean</span><span class="p">))</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;**** &#39;</span> <span class="o">+</span> <span class="n">arr_type_pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; Graph ******&#39;</span><span class="p">)</span> 
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# of Nodes &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# of Edges &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())))</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# of Disconnected Graphs &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_disc_g</span><span class="p">))</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# of Louvain Communities found in the largest connected component &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Degree of top 1 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Degree of top 2 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Degree of top 3 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Degree of top 4 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Degree of top 5 most connected user &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                        <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Average Node Degree of largest connected graph &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deg_mean</span><span class="p">))</span>
                    <span class="n">eda_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        
        <span class="c1">#close file</span>
        <span class="n">eda_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*** EDA - END *** - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_now_dt</span><span class="p">())</span></div>
        
        
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: print_top_nodes_cluster_metrics</span>
    <span class="c1"># Description: calculate clustering metrics for top degree nodes</span>
<div class="viewcode-block" id="TwitterAnalysis.print_top_nodes_cluster_metrics"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.print_top_nodes_cluster_metrics.html#ta.TwitterAnalysis.print_top_nodes_cluster_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">print_top_nodes_cluster_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">top_degree_end</span><span class="p">,</span> <span class="n">acc_node_size_cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                      
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates clustering metrics for top degree nodes        </span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        G : </span>
<span class="sd">            undirected networkx graph created from the Twitter data                               </span>
<span class="sd">        </span>
<span class="sd">        top_degree_end :</span>
<span class="sd">            the number of top nodes to use for calculation</span>
<span class="sd">        </span>
<span class="sd">        acc_node_size_cutoff : (Optional)</span>
<span class="sd">            The average clustering coefficient metric can take a long time to run, </span>
<span class="sd">            so users can set a cutoff number in this parameter for the graph size </span>
<span class="sd">            that will decide if that metric will be printed or not depending on the graph size. (Default=None)</span>
<span class="sd">              </span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">        Create graph visualization files</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; print_cluster_metrics(</span>
<span class="sd">            &gt;&gt;&gt; G_Community, </span>
<span class="sd">            &gt;&gt;&gt; G, </span>
<span class="sd">            &gt;&gt;&gt; top_no=3, </span>
<span class="sd">            &gt;&gt;&gt; acc_node_size_cutoff=None</span>
<span class="sd">            &gt;&gt;&gt; )</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        
        <span class="n">exec_tm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="n">top_degree_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_degree_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">top_degree_end</span><span class="p">)</span>        

        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># loops through the top degree nodes, creates a subgraph for them</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_degree_nodes</span><span class="p">:</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;***** Cluster for top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; node&quot;</span><span class="p">)</span>
            
            <span class="n">node</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>            
            
            <span class="c1">#creates a subgraph for this node</span>
            <span class="n">G_subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_node_subgraph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>    
            
            <span class="n">starttime_met</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="c1"># print metrics</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_cluster_metrics</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">top_no</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">acc_node_size_cutoff</span><span class="o">=</span><span class="n">acc_node_size_cutoff</span><span class="p">)</span>
            <span class="n">endtime_met</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">exec_tm</span> <span class="o">=</span> <span class="n">exec_tm</span> <span class="o">+</span> <span class="p">(</span><span class="n">endtime_met</span> <span class="o">-</span> <span class="n">starttime_met</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1">#exec_tm_total = endtime - starttime        </span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution Time:  </span><span class="si">%s</span><span class="s2"> seconds &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endtime</span> <span class="o">-</span> <span class="n">starttime</span> <span class="o">-</span> <span class="n">exec_tm</span><span class="p">))</span></div>
            

    <span class="c1">#####################################</span>
    <span class="c1"># Method: print_commty_cluster_metrics</span>
    <span class="c1"># Description: calls methods to create files for each of the communities found </span>
<div class="viewcode-block" id="TwitterAnalysis.print_commty_cluster_metrics"><a class="viewcode-back" href="../generated/ta.TwitterAnalysis.print_commty_cluster_metrics.html#ta.TwitterAnalysis.print_commty_cluster_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">print_commty_cluster_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">comm_att</span><span class="o">=</span><span class="s1">&#39;community_louvain&#39;</span><span class="p">,</span> <span class="n">ignore_cmmty_lt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">acc_node_size_cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates clustering metrics for top degree nodes        </span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        G : </span>
<span class="sd">            undirected networkx graph created from the Twitter data                               </span>
<span class="sd">        </span>
<span class="sd">        comm_att : (Optional)</span>
<span class="sd">            Possible values: &#39;community_louvain&#39; or &#39;spectral_clustering&#39;. (Default=&#39;community_louvain&#39;)</span>
<span class="sd">        </span>
<span class="sd">        ignore_cmmty_lt : (Optional)</span>
<span class="sd">             Number used to ignore small communitites. </span>
<span class="sd">             The logic will not calculate metrics for communities smaller than this number. (Default=0)</span>

<span class="sd">        acc_node_size_cutoff : (Optional)</span>
<span class="sd">            The average clustering coefficient metric can take a long time to run, </span>
<span class="sd">            so users can set a cutoff number in this parameter for the graph size </span>
<span class="sd">            that will decide if that metric will be printed or not depending on the graph size. (Default=None)</span>
<span class="sd">                         </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; print_commty_cluster_metrics(G, &#39;community_louvain&#39;, &#39;10&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># find the number of communities in the graph</span>
            <span class="n">no_of_comm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">comm_att</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total # of Communities &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_comm</span><span class="p">))</span>            

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;******************************************************&quot;</span><span class="p">)</span>            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*****&quot;</span> <span class="o">+</span> <span class="n">comm_att</span> <span class="o">+</span> <span class="s2">&quot;******&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># loop through the communities print they analysis files</span>
            <span class="n">no_of_comm_gt_cutoff</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">commty</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_of_comm</span><span class="p">):</span>
                                
                <span class="c1"># find subgraphs of this community</span>
                <span class="n">G_subgraph</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">attrdict</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attrdict</span> <span class="p">[</span><span class="n">comm_att</span><span class="p">]</span> <span class="o">==</span> <span class="n">commty</span> <span class="p">])</span>
                
                <span class="c1"># ignore communities that are less than ignore_cmmty_lt</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_subgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="n">ignore_cmmty_lt</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****Community #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commty</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">no_of_comm_gt_cutoff</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_cluster_metrics</span><span class="p">(</span><span class="n">G_subgraph</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">top_no</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">acc_node_size_cutoff</span><span class="o">=</span><span class="n">acc_node_size_cutoff</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
             
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total # of Communities with more than &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ignore_cmmty_lt</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; nodes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_comm_gt_cutoff</span><span class="p">))</span></div>
            
            
            
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="kn">import</span> <span class="nn">pymongo</span>
<span class="kn">from</span> <span class="nn">pymongo.collation</span> <span class="kn">import</span> <span class="n">Collation</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">strptime</span><span class="p">,</span><span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">words</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">,</span> <span class="n">wordnet</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">RegexpTokenizer</span>
<span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">PorterStemmer</span><span class="p">,</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">pos_tag</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">NMF</span><span class="p">,</span> <span class="n">LatentDirichletAllocation</span><span class="p">,</span> <span class="n">TruncatedSVD</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span><span class="p">,</span> <span class="n">CountVectorizer</span>
<span class="kn">import</span> <span class="nn">itertools</span> 
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests_oauthlib</span> <span class="kn">import</span> <span class="n">OAuth1</span>

<span class="n">dictionary_words</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">words</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pyphen</span>
<span class="n">pyphen_dic</span> <span class="o">=</span> <span class="n">pyphen</span><span class="o">.</span><span class="n">Pyphen</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
    
<span class="n">stopWords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">RegexpTokenizer</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+&#39;</span><span class="p">)</span>

<span class="n">stemmer</span> <span class="o">=</span> <span class="n">PorterStemmer</span><span class="p">()</span>
<span class="n">lemmatiser</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>

<span class="n">stop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
<span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span> 
<span class="n">lemma</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>

<span class="n">topic_doc_complete</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">class</span> <span class="nc">TwitterDB</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TwitterDB class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongoDB_database</span><span class="p">):</span>
        <span class="c1">#Inititalizing MongoDB collections        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">mongoDB_database</span>                
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">dc_bSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">adm_dbSettings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_loadedFiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">adm_loadedFiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_twitterSearches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">adm_twitterSearches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">focusedTweet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweetWords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetSentences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweetSentences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_topicsByHashTag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">topicsByHashTag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByFileAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_tweetCountByFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByPeriodAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_tweetCountByMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByLanguageAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_tweetCountByLanguage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByUserAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_tweetCountByUser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_wordCountAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_wordCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_hashTagCountAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_hashTagCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_userLocationCountAgg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">agg_userLocationCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">adm_loadStatus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_htTopics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">htTopics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHashTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweetHashTags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweetConnections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweetHTConnections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tweetHTConnections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_searches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">searches</span>
        <span class="c1">#temp collections to help with query performance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tmpEdges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tmpEdgesTweetIds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesHTFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tmpEdgesHTFreq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesWordFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tmpEdgesWordFreq</span>
                        
        <span class="c1"># Put fields chosen into an array of fields. </span>
        <span class="c1"># These fields will be the ones used in the FocusedTweet collection             </span>
        <span class="n">strFocusedTweetFields</span><span class="o">=</span><span class="s2">&quot;lang;retweet_count;in_reply_to_status_id_str;in_reply_to_screen_name&quot;</span>
        <span class="n">strFocusedTweetUserFields</span><span class="o">=</span><span class="s2">&quot;name;screen_name;description;location;followers_count;friends_count;statuses_count;lang;verified&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetFields</span> <span class="o">=</span> <span class="n">strFocusedTweetFields</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetFieldsArr</span> <span class="o">=</span> <span class="n">strFocusedTweetFields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetUserFieldsArr</span> <span class="o">=</span> <span class="n">strFocusedTweetUserFields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
            
        <span class="c1"># Create unique index on users table to only allow one users with same user_id and screen_name. </span>
        <span class="c1"># (Collation strength=2 garantees case insensitive)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_users</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;user_id_str&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">),</span> 
                                              <span class="p">(</span><span class="s1">&#39;screen_name&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)</span> <span class="p">],</span> 
                                             <span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                             <span class="n">collation</span><span class="o">=</span><span class="n">Collation</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="s2">&quot;en_US&quot;</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Could not create a new index in users&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            
        
        <span class="c1"># Create unique index on tweet table to make sure we don&#39;t store duplicate tweets        </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)],</span> 
                                             <span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
                  


<div class="viewcode-block" id="TwitterDB.setFocusedDataConfigs"><a class="viewcode-back" href="../generated/ta.TwitterDB.setFocusedDataConfigs.html#ta.TwitterDB.setFocusedDataConfigs">[docs]</a>    <span class="k">def</span> <span class="nf">setFocusedDataConfigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strFocusedTweetFields</span><span class="p">,</span> <span class="n">strFocusedTweetUserFields</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Twitter documents have an extensive number of fields. In order to focus only on the interesting pieces of information, this method allows you to choose which fields to keep. </span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        strFocusedTweetFields : fields that you find interesting in the Tweet object</span>
<span class="sd">        </span>
<span class="sd">        strFocusedTweetUserFields : fields that you find interesting in the User object</span>
<span class="sd">                </span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">        Setting configurations to decide which fields to keep:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; focusedTweetFields = &#39;lang;retweet_count;in_reply_to_screen_name&#39;</span>
<span class="sd">            &gt;&gt;&gt; focusedTweetUserFields = &#39;name;description;location;friends_count;verified&#39;</span>
<span class="sd">            &gt;&gt;&gt; setFocusedDataConfigs(focusedTweetFields, focusedTweetUserFields)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Put fields chosen into an array of fields. </span>
        <span class="c1"># These fields will be the ones used in the FocusedTweet collection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetFieldsArr</span> <span class="o">=</span> <span class="n">strFocusedTweetFields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetUserFieldsArr</span> <span class="o">=</span> <span class="n">strFocusedTweetUserFields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span></div>
        
                
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadDocFromFile</span>
    <span class="c1"># Description: This method will load tweet .json files into the DB (tweet collection)</span>
    <span class="c1"># It goes through all .json files in the directory and load them one by one. </span>
    <span class="c1"># It also saves the files already loaded into the &#39;loadedFiles&#39; collection </span>
    <span class="c1"># to make sure we don&#39;t load the same file twice</span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   -directory = the directory where the files are stored</span>
<div class="viewcode-block" id="TwitterDB.loadDocFromFile"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadDocFromFile.html#ta.TwitterDB.loadDocFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadDocFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will load tweet .json files into the DB (tweet collection)</span>
<span class="sd">        It goes through all .json files in the directory and load them one by one. </span>
<span class="sd">        It also saves the files already loaded into the &#39;loadedFiles&#39; collection </span>
<span class="sd">        to make sure we don&#39;t load the same file twice</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        directory :</span>
<span class="sd">            the directory where the files are stored </span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------          </span>
<span class="sd">            Import data from json files into a mongoDB database:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; loadDocFromFile(json_file_path = &#39;C:\\Data\\My_JSON_Files_folder&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="n">seq_no</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">starttime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;loading process started...&quot;</span> <span class="o">+</span> <span class="n">starttime</span><span class="p">)</span>
        
        <span class="c1">#find the current max sequence number</span>
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;seq_agg&quot;</span> <span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$max&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_no&quot;</span> <span class="p">}</span> <span class="p">}}])</span>
        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>                

        <span class="c1">#loops through the files in the dictory</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>                
                <span class="n">strpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>                               

                <span class="c1">#find if file already loaded</span>
                <span class="n">isFileLoaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_loadedFiles</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">})</span>        

                <span class="k">if</span> <span class="n">isFileLoaded</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#if the processing of that file did not finish. Deletes every record for that file so we can start over</span>
                    <span class="n">select_cLoadedFiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_loadedFiles</span><span class="o">.</span><span class="n">find</span><span class="p">({</span> <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)})</span>                
                    <span class="k">if</span> <span class="n">select_cLoadedFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;end_load_time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;loading&quot;</span><span class="p">:</span>            
                        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">c_loadedFiles</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)})</span>            
                        <span class="n">isFileLoaded</span><span class="o">=</span><span class="mi">0</span>

                <span class="c1">#if file has already been loaded, ignores the file</span>
                <span class="k">if</span> <span class="n">isFileLoaded</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="c1">#save path in loaded files collection to track which files have already been processed</span>
                    <span class="n">data_loadedfiles</span> <span class="o">=</span> <span class="s1">&#39;{&quot;start_load_time&quot;:&quot;&#39;</span> \
                                        <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> \
                                        <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;end_load_time&quot;:&quot;&#39;</span> \
                                        <span class="o">+</span> <span class="s2">&quot;loading&quot;</span> \
                                        <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;file_path&quot;:&quot;&#39;</span> \
                                        <span class="o">+</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> \
                                        <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>        
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_loadedFiles</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data_loadedfiles</span><span class="p">))</span>

                    <span class="c1">#open file and goes through each document to insert tweet into DB (inserts into tweet collection)                    </span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">strpath</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>        
                            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                            <span class="c1">#adding extra fields to document to suport future logic (processed_fl, load_time, file_path )</span>
                            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;processed_fl&#39;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> 
                                      <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> 
                                      <span class="s1">&#39;load_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span> 
                                      <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)}</span>    
                            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>                                        

                            <span class="c1">#ignores documents that are just status</span>
                            <span class="k">if</span> <span class="s1">&#39;info&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                                <span class="n">seq_no</span> <span class="o">=</span> <span class="n">seq_no</span><span class="o">+</span><span class="mi">1</span>

                    <span class="c1">#update end load time </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_loadedFiles</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                        <span class="p">{</span> <span class="s2">&quot;file_path&quot;</span> <span class="p">:</span> <span class="n">strpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">},</span>
                        <span class="p">{</span> <span class="s2">&quot;$set&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;end_load_time&quot;</span> <span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="p">}</span> <span class="p">});</span>            

                <span class="k">continue</span>        
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Error loading into tweet collection&quot;</span><span class="p">)</span>        

                
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;seq_no&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>    
            
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;loading process completed &quot;</span> <span class="o">+</span> <span class="n">endtime</span><span class="p">)</span></div>
        
        
    
    <span class="c1"># this method will use Twitter API to extract data and save into DB </span>
    <span class="c1"># Parameters: twitterBearer = Bearer from you Twitter developer account</span>
    <span class="c1">#             apiName = (30day/fullarchive)</span>
    <span class="c1">#             devEnviroment = name of your deve enviroment</span>
    <span class="c1">#             query = query to select data from Twitter API</span>
    <span class="c1">#             dateStart = period start date</span>
    <span class="c1">#             dateEnd = period end date</span>
    <span class="c1">#             nextToken = token to start from </span>
    <span class="c1">#             maxResults = maximum number of results that you want to return</span>
<div class="viewcode-block" id="TwitterDB.extractDocFromAPI"><a class="viewcode-back" href="../generated/ta.TwitterDB.extractDocFromAPI.html#ta.TwitterDB.extractDocFromAPI">[docs]</a>    <span class="k">def</span> <span class="nf">extractDocFromAPI</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">twitterBearer</span><span class="p">,</span> <span class="n">apiName</span><span class="p">,</span> <span class="n">devEnviroment</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">dateStart</span><span class="p">,</span> <span class="n">dateEnd</span><span class="p">,</span> <span class="n">nextToken</span><span class="p">,</span> <span class="n">maxResults</span><span class="p">):</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code for extractDocFromAPI. Details for this code on https://git.txstate.edu/l-n63/CS7311 &quot;</span><span class="p">)</span>        </div>
                  
           
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadCollection_UpdateStatus</span>
    <span class="c1"># Description: This method controls the progress the insertions into other collections. </span>
    <span class="c1"># It calls other methods to load the collections</span>
    <span class="c1"># It keeps the progress stored in the db, so that if something fails, </span>
    <span class="c1">#  we can know where to start back up.</span>
    <span class="c1"># The progress is stored on collections &quot;adm_loadStatus&quot;</span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   -collection_name = the collections you want to load. </span>
    <span class="c1">#    (Options: focusedTweet, tweetWords, tweetHashTags and tweetConnections)</span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#    (Large number may cause memory errors, low number may take too long to run)</span>
    <span class="c1">#   -type_filter = used only for users collections. </span>
    <span class="c1">#    (Options: tweet, retweet, quote, reply or mention) - Default = None</span>
    <span class="k">def</span> <span class="nf">loadCollection_UpdateStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">type_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">starttime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;loading process started (&#39;</span> <span class="o">+</span> <span class="n">collection_name</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">type_filter</span> <span class="k">if</span> <span class="n">type_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="o">+</span>  <span class="s1">&#39;)... &#39;</span> <span class="o">+</span> <span class="n">starttime</span><span class="p">)</span>
            
        <span class="n">last_seq_no</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">max_seq_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">minV</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#get the max sequence number from the tweet collection</span>
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;seq_agg&quot;</span> <span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$max&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_no&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>
            <span class="n">max_seq_no</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>

        <span class="c1">#check if the process has already been run or not. This is to make sure we can restart a process from where we stopped</span>
        <span class="k">if</span> <span class="n">type_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">hasStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span> <span class="s2">&quot;type_filter&quot;</span><span class="p">:</span> <span class="n">type_filter</span> <span class="p">})</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hasStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span> <span class="p">})</span>
            
        <span class="k">if</span> <span class="n">hasStarted</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">select_cLoadStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span> <span class="p">})</span>                
            <span class="k">if</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;loading&quot;</span><span class="p">:</span>
                <span class="n">last_seq_no</span> <span class="o">=</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;min_seq&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;focusedTweet&#39;</span><span class="p">:</span>                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span> <span class="s2">&quot;seq_no&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span> <span class="p">:</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;min_seq&quot;</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
                <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetWords&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span> <span class="s2">&quot;tweet_seq_no&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span> <span class="p">:</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;min_seq&quot;</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
                <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetHashTags&#39;</span><span class="p">:</span>                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHashTags</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span> <span class="s2">&quot;tweet_seq_no&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span> <span class="p">:</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;min_seq&quot;</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
                <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetConnections&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span> <span class="s2">&quot;tweet_seq_no&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span> <span class="p">:</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;min_seq&quot;</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
                <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetHTConnections&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span> <span class="s2">&quot;tweet_seq_no&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span> <span class="p">:</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;min_seq&quot;</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
                                
            <span class="k">elif</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span>
                <span class="n">last_seq_no</span> <span class="o">=</span> <span class="n">select_cLoadStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;max_seq&quot;</span><span class="p">]</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">type_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;collection_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">collection_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;type_filter&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">type_filter</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;collection_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">collection_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>


        <span class="c1"># try:</span>
        <span class="c1"># loop through tweet sequence numbers to insert into DB. </span>
        <span class="c1"># The variable &quot;inc&quot; will dictate how many tweet we will isert at a time int DB</span>
        <span class="n">minV</span> <span class="o">=</span> <span class="n">last_seq_no</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">minV</span> <span class="o">&lt;=</span> <span class="n">max_seq_no</span><span class="p">:</span> 
            
            <span class="k">if</span> <span class="n">type_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span> <span class="s2">&quot;type_filter&quot;</span><span class="p">:</span> <span class="n">type_filter</span> <span class="p">},</span> 
                    <span class="p">{</span> <span class="s2">&quot;$set&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;min_seq&quot;</span> <span class="p">:</span> <span class="n">minV</span><span class="p">,</span> <span class="s2">&quot;max_seq&quot;</span> <span class="p">:</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;loading&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span> <span class="p">},</span> 
                    <span class="p">{</span> <span class="s2">&quot;$set&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;min_seq&quot;</span> <span class="p">:</span> <span class="n">minV</span><span class="p">,</span> <span class="s2">&quot;max_seq&quot;</span> <span class="p">:</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;loading&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
                
            <span class="k">if</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;focusedTweet&#39;</span><span class="p">:</span>                    
                <span class="bp">self</span><span class="o">.</span><span class="n">loadFocusedDataMinMax</span><span class="p">(</span><span class="n">minV</span><span class="p">,</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetWords&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">breakTextIntoWords</span><span class="p">(</span><span class="n">minV</span><span class="p">,</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">)</span>                    
            <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetHashTags&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadTweetHashTagsMinMax</span><span class="p">(</span><span class="n">minV</span><span class="p">,</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetConnections&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadTweetConnectionsMinMax</span><span class="p">(</span><span class="n">minV</span><span class="p">,</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;tweetHTConnections&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadTweetHTConnectionsMinMax</span><span class="p">(</span><span class="n">minV</span><span class="p">,</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="n">collection_name</span> <span class="o">==</span> <span class="s1">&#39;users&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadUsersDataMinMax</span><span class="p">(</span><span class="n">minV</span><span class="p">,</span> <span class="n">minV</span><span class="o">+</span><span class="n">inc</span><span class="p">,</span> <span class="n">type_filter</span><span class="p">)</span>

            <span class="n">minV</span><span class="o">=</span><span class="n">minV</span><span class="o">+</span><span class="n">inc</span>

        <span class="c1">#if everyhting was successfull, saves status as &quot;success&quot;</span>
        <span class="k">if</span> <span class="n">type_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span> <span class="s2">&quot;type_filter&quot;</span><span class="p">:</span> <span class="n">type_filter</span> <span class="p">},</span> 
                <span class="p">{</span> <span class="s2">&quot;$set&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;max_seq&quot;</span> <span class="p">:</span> <span class="n">max_seq_no</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;success&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_loadStatus</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span> <span class="p">},</span> 
                <span class="p">{</span> <span class="s2">&quot;$set&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;max_seq&quot;</span> <span class="p">:</span> <span class="n">max_seq_no</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;success&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
                                  
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;loading process completed (&#39;</span> <span class="o">+</span> <span class="n">collection_name</span> <span class="o">+</span> <span class="s1">&#39;)... &#39;</span> <span class="o">+</span> <span class="n">endtime</span><span class="p">)</span>
        
    
<div class="viewcode-block" id="TwitterDB.cleanTweetText"><a class="viewcode-back" href="../generated/ta.TwitterDB.cleanTweetText.html#ta.TwitterDB.cleanTweetText">[docs]</a>    <span class="k">def</span> <span class="nf">cleanTweetText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to clean the tweet message. Hashtags, user screen names, </span>
<span class="sd">        links, and special characters are removed.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        text :</span>
<span class="sd">            the string to clean</span>
<span class="sd">            </span>
<span class="sd">        Return</span>
<span class="sd">        --------              </span>
<span class="sd">        text_clean :</span>
<span class="sd">            the string after it&#39;s been cleaned</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; cleanTweetText(&#39;re The text to Clean for @Jane!!! :) #python&#39;)</span>
<span class="sd">            The text to Clean for</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>       

        <span class="c1"># removing hashtahs, mentions and links from clean text    </span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot; http&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot; #&quot;</span><span class="p">)</span>        
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot; @&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>            
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>            
            <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;@&#39;</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;http&#39;</span><span class="ow">and</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;rt&#39;</span><span class="p">:</span>
                <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>                                    

        <span class="c1"># removing apecial characters</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_clean</span> <span class="o">=</span> <span class="n">text_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">text_clean</span></div>

    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadFocusedData</span>
    <span class="c1"># Description: This method will call loadCollection_UpdateStatus to load the focusedtweet collection</span>
    <span class="c1"># Parameter:  </span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#   (Large number may cause memory errors, low number may take too long to run)</span>
<div class="viewcode-block" id="TwitterDB.loadFocusedData"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadFocusedData.html#ta.TwitterDB.loadFocusedData">[docs]</a>    <span class="k">def</span> <span class="nf">loadFocusedData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load focused data into mongoDB based on the configurations set on setFocusedDataConfigs. </span>
<span class="sd">        It creates collection tweetFocusedData</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        inc : </span>
<span class="sd">            used to determine how many tweets will be processed at a time.</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">            the string to clean</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadFocusedData(50000)            </span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loadCollection_UpdateStatus</span><span class="p">(</span><span class="s1">&#39;focusedTweet&#39;</span><span class="p">,</span> <span class="n">inc</span> <span class="p">)</span></div>
        
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadFocusedDataMinMax</span>
    <span class="c1"># Description: This method will load the focusedtweet collection with the interesting information we want to study</span>
    <span class="c1"># It filters by a interval number of tweets. </span>
    <span class="c1"># This is because loading everything at once might cause out of memory errors</span>
    <span class="c1"># Parameters:   </span>
    <span class="c1">#   -minV &amp; maxV = the tweet seq_no interval you want to run this analysis for</span>
    <span class="k">def</span> <span class="nf">loadFocusedDataMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span><span class="p">):</span>     

        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;seq_no&quot;</span><span class="p">:{</span> <span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="n">minV</span><span class="p">,</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="n">maxV</span><span class="p">}})</span>
        <span class="c1">#select_cTweet = self.c_tweet.find({&quot;seq_no&quot;:{ &quot;$gt&quot;:2,&quot;$lte&quot;:3}})</span>

        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>    
            
            <span class="c1">#Get all the basic info about the tweet. (These will always be saved independet of configurations)    </span>
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;seq_no&#39;</span><span class="p">]</span>
            <span class="n">id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            <span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%a</span><span class="s2"> %b </span><span class="si">%d</span><span class="s2"> %H:%M:%S +0000 %Y&quot;</span><span class="p">)</span>
            <span class="n">year</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">][</span><span class="mi">26</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>
            <span class="n">month_name</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">month_no</span> <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">strptime</span><span class="p">(</span><span class="n">month_name</span><span class="p">,</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">)</span>
            <span class="n">day</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
            <span class="n">user_id</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            
                        
            <span class="c1">## ***************************************************</span>
            <span class="c1">## *** Getting the text information from differnt fields and different formats ****    </span>

            <span class="c1"># when the tweet is large, the full text is saved ion the field extended_tweet</span>
            <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                   
                <span class="n">text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s1">&#39;full_text&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>                   
                
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>    
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># text from the quoted text</span>
            <span class="n">quote_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;quoted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>
                    <span class="n">quote_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s1">&#39;full_text&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>
                    <span class="n">quote_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">quote_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
                    
            <span class="n">quote_text</span> <span class="o">=</span> <span class="n">quote_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  
            <span class="n">quote_text</span> <span class="o">=</span> <span class="n">quote_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">quote_text</span> <span class="o">=</span> <span class="n">quote_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># text from original tweet if this is a retweet</span>
            <span class="n">retweeted_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;retweeted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                      
                <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">]:</span>
                    <span class="n">retweeted_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s1">&#39;full_text&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">]:</span>
                    <span class="n">retweeted_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">retweeted_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>                       
            
            <span class="n">retweeted_text</span> <span class="o">=</span> <span class="n">retweeted_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">retweeted_text</span> <span class="o">=</span> <span class="n">retweeted_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">retweeted_text</span> <span class="o">=</span> <span class="n">retweeted_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        
            
            <span class="n">text_combined</span> <span class="o">=</span> <span class="n">text_lower</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">quote_text</span>
            
            
            <span class="n">text_combined_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanTweetText</span><span class="p">(</span><span class="n">text_combined</span><span class="p">)</span>
            
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            # removing hashtahs, mentions and links from clean text    </span>
<span class="sd">            text_combined_clean = text_combined.replace(&quot;http&quot;, &quot; http&quot;).replace(&quot;#&quot;, &quot; #&quot;)        </span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;@&quot;, &quot; @&quot;).replace(&quot;  &quot;, &quot; &quot;).strip()</span>
<span class="sd">            words = text_combined_clean.split()</span>
<span class="sd">            text_combined_clean = &#39;&#39;            </span>
<span class="sd">            for word in list(words):            </span>
<span class="sd">                if word[0:1] != &#39;#&#39; and word[0:1] != &#39;@&#39; and word[0:4] != &#39;http&#39;and word[0:2] != &#39;rt&#39;:</span>
<span class="sd">                    text_combined_clean = text_combined_clean + word + &#39; &#39;                                    </span>
<span class="sd">            </span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;\\&quot;, &quot;&quot;).replace(&quot;@&quot;,&quot;&quot;).replace(&quot;!&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;/&quot;, &quot;&quot;).replace(&quot;*&quot;, &quot;&quot;).replace(&quot;&amp;amp;&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;-&quot;, &quot;&quot;).replace(&quot;~&quot;, &quot;&quot;).replace(&quot;`&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;#&quot;, &quot;&quot;).replace(&quot;$&quot;, &quot;&quot;).replace(&quot;&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;%&quot;, &quot;&quot;).replace(&quot;^&quot;, &quot;&quot;).replace(&quot;&amp;&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;(&quot;, &quot;&quot;).replace(&quot;)&quot;, &quot;&quot;).replace(&quot;&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;=&quot;, &quot;&quot;).replace(&quot;+&quot;, &quot;&quot;).replace(&quot;{&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;}&quot;, &quot;&quot;).replace(&quot;[&quot;, &quot;&quot;).replace(&quot;&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;).replace(&quot;|&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;&#39;&quot;, &quot;&quot;).replace(&#39;&quot;&#39;, &quot;&quot;).replace(&quot;?&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;:&quot;, &quot;&quot;).replace(&quot;;&quot;, &quot;&quot;).replace(&quot;&lt;&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;&gt;&quot;, &quot;&quot;).replace(&quot;,&quot;, &quot;&quot;).replace(&quot;.&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;_&quot;, &quot;&quot;).replace(&quot;\\\\&quot;, &quot;&quot;)</span>
<span class="sd">            text_combined_clean = text_combined_clean.replace(&quot;  &quot;, &quot; &quot;).strip()</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="c1">## ***************************************************************************</span>
            
            
            
                                    
            <span class="c1">## ***************************************************************************</span>
            <span class="c1">## *** Getting the hashtag information - (original tweets, and quotes)</span>

            <span class="n">ht_children</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">addHTToList</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">type_ht</span><span class="p">):</span>                    

                <span class="n">ht_children</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;ht&#39;</span><span class="p">:</span> <span class="n">ht</span><span class="p">,</span> <span class="s1">&#39;ht_lower&#39;</span><span class="p">:</span> <span class="n">ht</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;type_ht&#39;</span> <span class="p">:</span> <span class="n">type_ht</span>
                <span class="p">})</span>


            <span class="c1"># get Hashtags            </span>
            <span class="n">type_ht</span> <span class="o">=</span> <span class="s1">&#39;original&#39;</span>             
            <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>
                    <span class="n">ht</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> 
                    <span class="n">addHTToList</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span><span class="n">type_ht</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>        
                <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>                    
                    <span class="n">ht</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
                    <span class="n">addHTToList</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span><span class="n">type_ht</span><span class="p">)</span>                                    

            <span class="k">if</span> <span class="s1">&#39;quoted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                
                <span class="n">type_ht</span> <span class="o">=</span> <span class="s1">&#39;quote&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>     
                    <span class="k">if</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>
                            <span class="n">ht</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
                            <span class="n">addHTToList</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span><span class="n">type_ht</span><span class="p">)</span>

                <span class="k">elif</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>
                        <span class="n">ht</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>     
                        <span class="n">addHTToList</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span><span class="n">type_ht</span><span class="p">)</span>

            <span class="c1">## ***************************************************************************</span>
    
                

            <span class="c1"># creating the json doc</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;text&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;text_lower&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">text_lower</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;quote_text&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">quote_text</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;retweeted_text&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">retweeted_text</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;text_combined&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">text_combined</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;text_combined_clean&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">text_combined_clean</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;year&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;month_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;month_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">month_no</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;day&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">user_id</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;hashtags&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht_children</span>
            

            
            <span class="c1"># ***** adding other fields to collection based on the list of fields from configuration - </span>
            <span class="c1"># (configuration is set on the instantiation of the class object)</span>
            <span class="k">def</span> <span class="nf">addFieldToDoc</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field_content</span><span class="p">):</span>
                <span class="c1">#if it is a string, clean tab and enter characters</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_content</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">field_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">field_content</span> <span class="o">=</span> <span class="n">field_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">field_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">field_content</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>            

                <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field_name</span> <span class="p">:</span> <span class="n">field_content</span><span class="p">}</span>    
                <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>     

            <span class="c1"># go through the list of fields from configuration and add to the document</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetFieldsArr</span><span class="p">:</span>         
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">field_content</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">addFieldToDoc</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field_content</span><span class="p">)</span>

            <span class="c1">#go through the list of user fields from configuration and add to the document</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">strFocusedTweetUserFieldsArr</span><span class="p">:</span>         
                <span class="n">field_name</span> <span class="o">=</span> <span class="s1">&#39;user_&#39;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">field_content</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">addFieldToDoc</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field_content</span><span class="p">)</span>                        
            
            <span class="c1"># **************************</span>
            

            <span class="c1"># add created_at</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">:</span> <span class="n">created_at</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>     
                
            <span class="c1"># add seq number to the end</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>    
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>  

            <span class="c1"># Add this tweet doc to the array. the array of all </span>
            <span class="c1"># tweets will be used to insertMany into mongoDB </span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="c1"># insert records into collection</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error loading focused tweet | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>  

        
        <span class="c1"># Create indexes in collection. This will help performance later</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;seq_no&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in focusedTweet&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;id_str&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in focusedTweet&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            

 

    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadUsersData</span>
    <span class="c1"># Description: This method will call loadCollection_UpdateStatus to load the users collection</span>
    <span class="c1"># Users are store in different part of the tweet. </span>
    <span class="c1"># In the tweet itself, in the retweet branch, in the quote branch, in the field in_reply_to_user and in the mention branch. </span>
    <span class="c1"># Use parameter &quot;user_type_filter&quot; to select which type you want to load. </span>
    <span class="c1"># IMPORTANT: Types reply and mention do not contain full user information</span>
    <span class="c1"># This method also creates a index to prevent duplicate user information. </span>
    <span class="c1"># If a user already exists, it just rejects the insertion. </span>
    <span class="c1"># Parameters:  </span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#    (Large number may cause memory errors, low number may take too long to run)</span>
    <span class="c1">#   -user_type_filter = the type of user you want to load - </span>
    <span class="c1">#    (Options: tweet, retweet, quote, reply and mention)</span>
<div class="viewcode-block" id="TwitterDB.loadUsersData"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadUsersData.html#ta.TwitterDB.loadUsersData">[docs]</a>    <span class="k">def</span> <span class="nf">loadUsersData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">user_type_filter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load user data into mongoDB. </span>
<span class="sd">        It creates collection users</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        inc : </span>
<span class="sd">            used to determine how many tweets will be processed at a time.</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">            the string to clean</span>
<span class="sd">        user_type_filter :</span>
<span class="sd">            the type of user you want to load - </span>
<span class="sd">            (Options: tweet, retweet, quote, reply and mention)</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadUsersData(50000, &#39;tweet&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loadCollection_UpdateStatus</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">user_type_filter</span><span class="p">)</span></div>
        

    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadUsersDataMinMax</span>
    <span class="c1"># Description: This method will load the users collection </span>
    <span class="c1"># It filters by a interval number of tweets. </span>
    <span class="c1"># This is because loading everything at once might cause out of memory errors</span>
    <span class="c1"># Parameters:   </span>
    <span class="c1">#   -minV &amp; maxV = the tweet seq_no interval you want to run this analysis for</span>
    <span class="c1">#   -user_type_filter = the type of user you want to to load - </span>
    <span class="c1">#    (Options: tweet, retweet, quote, reply and mention) </span>
    <span class="k">def</span> <span class="nf">loadUsersDataMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span><span class="p">,</span> <span class="n">user_type_filter</span><span class="p">):</span>
        
        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>        
        
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;seq_no&quot;</span><span class="p">:{</span> <span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="n">minV</span><span class="p">,</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="n">maxV</span><span class="p">}})</span>

        <span class="c1"># add another json record to the array of records to insert</span>
        <span class="k">def</span> <span class="nf">addToList</span><span class="p">(</span><span class="n">user_type</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> 
                      <span class="n">description</span><span class="p">,</span> <span class="n">created_at</span><span class="p">,</span> <span class="n">protected</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">followers_count</span><span class="p">,</span> 
                      <span class="n">friends_count</span><span class="p">,</span> <span class="n">listed_count</span><span class="p">,</span> <span class="n">favourites_count</span><span class="p">,</span> <span class="n">statuses_count</span><span class="p">):</span>

            <span class="n">location_clean</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">description_clean</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">location_clean</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">location_clean</span> <span class="o">=</span> <span class="n">location_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">description_clean</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">description_clean</span> <span class="o">=</span> <span class="n">description_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">screen_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">screen_name</span> <span class="o">=</span> <span class="n">user_id_str</span>  
                
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;screen_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">screen_name</span>  <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_id_str&#39;</span><span class="p">:</span> <span class="n">user_id_str</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_created_at&#39;</span><span class="p">:</span> <span class="n">created_at</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">location</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location_clean&#39;</span><span class="p">:</span> <span class="n">location_clean</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description_clean&#39;</span><span class="p">:</span> <span class="n">description_clean</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;protected&#39;</span><span class="p">:</span> <span class="n">protected</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;verified&#39;</span><span class="p">:</span> <span class="n">verified</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;followers_count&#39;</span><span class="p">:</span> <span class="n">followers_count</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;friends_count&#39;</span><span class="p">:</span> <span class="n">friends_count</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;listed_count&#39;</span><span class="p">:</span> <span class="n">listed_count</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;favourites_count&#39;</span><span class="p">:</span> <span class="n">favourites_count</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;statuses_count&#39;</span><span class="p">:</span> <span class="n">statuses_count</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>  
            <span class="n">add_col</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_type&#39;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_col</span><span class="p">)</span>

            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            
            
        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>    

            <span class="k">if</span> <span class="n">user_type_filter</span> <span class="o">==</span> <span class="s1">&#39;tweet&#39;</span><span class="p">:</span>                
                <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">screen_name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
                <span class="n">description</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
                <span class="n">protected</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;protected&#39;</span><span class="p">]</span>
                <span class="n">followers_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;followers_count&#39;</span><span class="p">]</span>
                <span class="n">friends_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;friends_count&#39;</span><span class="p">]</span>
                <span class="n">listed_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;listed_count&#39;</span><span class="p">]</span>
                <span class="n">created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
                <span class="n">favourites_count</span> <span class="o">=</span><span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;favourites_count&#39;</span><span class="p">]</span>
                <span class="n">verified</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;verified&#39;</span><span class="p">]</span>
                <span class="n">statuses_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;statuses_count&#39;</span><span class="p">]</span>        
                <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> 
                          <span class="n">description</span><span class="p">,</span> <span class="n">created_at</span><span class="p">,</span> <span class="n">protected</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">followers_count</span><span class="p">,</span> 
                          <span class="n">friends_count</span><span class="p">,</span> <span class="n">listed_count</span><span class="p">,</span> <span class="n">favourites_count</span><span class="p">,</span> <span class="n">statuses_count</span><span class="p">)</span>


            <span class="c1">#user from the retweet original tweet</span>
            <span class="k">if</span> <span class="n">user_type_filter</span> <span class="o">==</span> <span class="s1">&#39;retweet&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;retweeted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                      
                    <span class="k">if</span> <span class="s1">&#39;user&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">]:</span>                        
                        <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                        <span class="n">screen_name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                        <span class="n">location</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
                        <span class="n">description</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
                        <span class="n">protected</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;protected&#39;</span><span class="p">]</span>
                        <span class="n">followers_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;followers_count&#39;</span><span class="p">]</span>
                        <span class="n">friends_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;friends_count&#39;</span><span class="p">]</span>
                        <span class="n">listed_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;listed_count&#39;</span><span class="p">]</span>
                        <span class="n">created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
                        <span class="n">favourites_count</span> <span class="o">=</span><span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;favourites_count&#39;</span><span class="p">]</span>
                        <span class="n">verified</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;verified&#39;</span><span class="p">]</span>
                        <span class="n">statuses_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;statuses_count&#39;</span><span class="p">]</span>
                        <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> 
                                  <span class="n">description</span><span class="p">,</span> <span class="n">created_at</span><span class="p">,</span> <span class="n">protected</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">followers_count</span><span class="p">,</span> 
                                  <span class="n">friends_count</span><span class="p">,</span> <span class="n">listed_count</span><span class="p">,</span> <span class="n">favourites_count</span><span class="p">,</span> <span class="n">statuses_count</span><span class="p">)</span>


            <span class="c1">#user from the quoted tweet</span>
            <span class="k">if</span> <span class="n">user_type_filter</span> <span class="o">==</span> <span class="s1">&#39;quote&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;quoted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                      
                    <span class="k">if</span> <span class="s1">&#39;user&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>                        
                        <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                        <span class="n">screen_name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                        <span class="n">location</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
                        <span class="n">description</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
                        <span class="n">protected</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;protected&#39;</span><span class="p">]</span>
                        <span class="n">followers_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;followers_count&#39;</span><span class="p">]</span>
                        <span class="n">friends_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;friends_count&#39;</span><span class="p">]</span>
                        <span class="n">listed_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;listed_count&#39;</span><span class="p">]</span>
                        <span class="n">created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
                        <span class="n">favourites_count</span> <span class="o">=</span><span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;favourites_count&#39;</span><span class="p">]</span>
                        <span class="n">verified</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;verified&#39;</span><span class="p">]</span>
                        <span class="n">statuses_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;statuses_count&#39;</span><span class="p">]</span>
                        <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> 
                                  <span class="n">description</span><span class="p">,</span> <span class="n">created_at</span><span class="p">,</span> <span class="n">protected</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">followers_count</span><span class="p">,</span> 
                                  <span class="n">friends_count</span><span class="p">,</span> <span class="n">listed_count</span><span class="p">,</span> <span class="n">favourites_count</span><span class="p">,</span> <span class="n">statuses_count</span><span class="p">)</span>

            <span class="c1">#in reply to user</span>
            <span class="k">if</span> <span class="n">user_type_filter</span> <span class="o">==</span> <span class="s1">&#39;reply&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_user_id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>                            
                    <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_user_id_str&#39;</span><span class="p">]</span>        
                    <span class="n">screen_name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_screen_name&#39;</span><span class="p">]</span>
                    <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                              <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                              <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>



            <span class="c1">#find mentioned user</span>
            <span class="k">if</span> <span class="n">user_type_filter</span> <span class="o">==</span> <span class="s1">&#39;mention&#39;</span><span class="p">:</span>                
                <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                
                    <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                    
                        <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>        
                        <span class="n">screen_name</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                        <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>                       
                    <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                                        
                        <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>        
                        <span class="n">screen_name</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                        <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

                <span class="c1">#find retweets mentions</span>
                <span class="k">if</span> <span class="s1">&#39;retweeted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">]:</span>     
                        <span class="k">if</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">]:</span>                        
                            <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                            
                                <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>        
                                <span class="n">screen_name</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                                <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                          <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                          <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                       
                            <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>        
                            <span class="n">screen_name</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                            <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                      <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                      <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

                <span class="c1">#find quote mentions</span>
                <span class="k">if</span> <span class="s1">&#39;quoted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                                              
                    <span class="c1">#find mentions in a quote</span>
                    <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>     
                        <span class="k">if</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">]:</span>                        
                            <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                            
                                <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>        
                                <span class="n">screen_name</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                                <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                          <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                          <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>
                            <span class="n">user_id_str</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>        
                            <span class="n">screen_name</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                            <span class="n">addToList</span><span class="p">(</span><span class="n">user_type_filter</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">,</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                      <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verified</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">followers_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                      <span class="n">friends_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">listed_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">favourites_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statuses_count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                                
            
        <span class="c1"># insert user into  db</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_users</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;BulkWriteError&quot;</span><span class="p">:</span>  <span class="c1">#igones if just failed when trying to insert duplicate users</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in insert many user - &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>        
        
        
        
            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadTweetHashTags</span>
    <span class="c1"># Description: This method will call loadCollection_UpdateStatus to load the hashtag collection    </span>
    <span class="c1"># Parameter:  </span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#    (Large number may cause memory errors, low number may take too long to run)        </span>
<div class="viewcode-block" id="TwitterDB.loadTweetHashTags"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadTweetHashTags.html#ta.TwitterDB.loadTweetHashTags">[docs]</a>    <span class="k">def</span> <span class="nf">loadTweetHashTags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load hashthas in a separate collection in mongoDB. </span>
<span class="sd">        It creates the tweetHashTags collection.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        inc : </span>
<span class="sd">            used to determine how many tweets will be processed at a time.</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">            the string to clean</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadTweetHashTags(50000)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loadCollection_UpdateStatus</span><span class="p">(</span><span class="s1">&#39;tweetHashTags&#39;</span><span class="p">,</span> <span class="n">inc</span> <span class="p">)</span>        </div>
        
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadTweetHashTagsMinMax</span>
    <span class="c1"># Description: This method will load the hashtags associated to each tweet</span>
    <span class="c1"># It filters by a interval number of tweets. </span>
    <span class="c1"># This is because loading everything at once might cause out of memory errors</span>
    <span class="c1"># Parameters:   </span>
    <span class="c1">#   -minV &amp; maxV = the tweet seq_no interval you want to run this analysis for    </span>
    <span class="k">def</span> <span class="nf">loadTweetHashTagsMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span><span class="p">):</span>     

        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;seq_no&quot;</span><span class="p">:{</span> <span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="n">minV</span><span class="p">,</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="n">maxV</span><span class="p">}})</span>
        
        <span class="c1"># add another json record to the array of records to insert</span>
        <span class="k">def</span> <span class="nf">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_ht</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">ht_lower</span><span class="p">,</span> <span class="n">created_at</span><span class="p">):</span>                                 

            <span class="c1">#creating the json doc</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;type_ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">type_ht</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;ht_lower&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht_lower</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1">#add created_at</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">:</span> <span class="n">created_at</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>
            
            <span class="c1">#add seq number to the end</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

            <span class="c1"># Add this tweet doc to the array. the array of all tweets </span>
            <span class="c1"># will be used to insertMany into mongoDB </span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>


        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>
            
            <span class="n">id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;seq_no&#39;</span><span class="p">]</span>
            <span class="n">created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">]</span>
                        
            <span class="c1">#get Hashtags            </span>
            <span class="k">if</span> <span class="s1">&#39;hashtags&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>
                    
                    <span class="n">ht</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;ht&#39;</span><span class="p">]</span>
                    <span class="n">ht_lower</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;ht_lower&#39;</span><span class="p">]</span>                    
                    <span class="n">type_ht</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;type_ht&#39;</span><span class="p">]</span>             
                    
                    <span class="c1">#creating the json doc</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;type_ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">type_ht</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;ht_lower&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht_lower</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                    <span class="c1">#add created_at</span>
                    <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">:</span> <span class="n">created_at</span><span class="p">}</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

                    <span class="c1">#add seq number to the end</span>
                    <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

                    <span class="c1"># Add this tweet doc to the array. the array of all </span>
                    <span class="c1"># tweets will be used to insertMany into mongoDB </span>
                    <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                    

        <span class="c1"># insert hashtags into db</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHashTags</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error loading c_tweetHashTags &quot;</span><span class="p">)</span>
            
                                
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadTweetConnections</span>
    <span class="c1"># Description: This method will call loadCollection_UpdateStatus to load the tweetConnections collection    </span>
    <span class="c1"># Parameter:  </span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#    (Large number may cause memory errors, low number may take too long to run)     </span>
<div class="viewcode-block" id="TwitterDB.loadTweetConnections"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadTweetConnections.html#ta.TwitterDB.loadTweetConnections">[docs]</a>    <span class="k">def</span> <span class="nf">loadTweetConnections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load tweet connection in a separate collection in mongoDB. </span>
<span class="sd">        It creates the tweetConnections collection.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        inc : </span>
<span class="sd">            used to determine how many tweets will be processed at a time.</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">            the string to clean</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadTweetConnections(50000)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loadCollection_UpdateStatus</span><span class="p">(</span><span class="s1">&#39;tweetConnections&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span></div>
                

    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadTweetConnectionsMinMax</span>
    <span class="c1"># Description: This method will load the tweet connections (edges) associated to each tweet        </span>
    <span class="c1"># It filters by a interval number of tweets. </span>
    <span class="c1"># This is because loading everything at once might cause out of memory errors</span>
    <span class="c1"># Parameters:  </span>
    <span class="c1">#   -minV &amp; maxV = the tweet seq_no interval you want to run this analysis for      </span>
    <span class="k">def</span> <span class="nf">loadTweetConnectionsMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span><span class="p">):</span>

        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>     
        <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;seq_no&quot;</span><span class="p">:{</span> <span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="n">minV</span><span class="p">,</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="n">maxV</span><span class="p">}})</span>
                        
        <span class="c1"># add another json record to the array of records to insert</span>
        <span class="k">def</span> <span class="nf">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> <span class="n">screen_name_a</span><span class="p">,</span> 
                      <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">tweet_created_dt</span><span class="p">,</span> 
                      <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_reply_to_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">user_id_str_a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">user_id_str_a</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
            <span class="k">if</span> <span class="n">user_id_str_b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">retweeted_status_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">retweeted_status_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">quoted_status_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">quoted_status_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">in_reply_to_status_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_reply_to_status_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">screen_name_a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">screen_name_a</span> <span class="o">=</span> <span class="n">user_id_str_a</span>
            <span class="k">if</span> <span class="n">screen_name_b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">user_id_str_b</span>
                
             
            <span class="c1">#to set the edge_screen_name_directed_key</span>
            <span class="k">if</span> <span class="n">screen_name_a</span> <span class="o">&gt;</span> <span class="n">screen_name_b</span><span class="p">:</span>
                <span class="n">screen_name_a_un</span> <span class="o">=</span> <span class="n">screen_name_a</span>
                <span class="n">screen_name_b_un</span> <span class="o">=</span> <span class="n">screen_name_b</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">screen_name_a_un</span> <span class="o">=</span> <span class="n">screen_name_b</span>
                <span class="n">screen_name_b_un</span> <span class="o">=</span> <span class="n">screen_name_a</span>
                
            <span class="c1">#creating the json doc</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;type_of_connection&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">type_conn</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;user_id_str_a&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">user_id_str_a</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;screen_name_a&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">screen_name_a</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;user_id_str_b&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">user_id_str_b</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;screen_name_b&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">screen_name_b</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;desc&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;retweeted_status_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">retweeted_status_id</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;quoted_status_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">quoted_status_id</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;in_reply_to_status_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_reply_to_status_id</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;edge_screen_name_directed_key&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">screen_name_a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">screen_name_b</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;edge_screen_name_undirected_key&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">screen_name_a_un</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">screen_name_b_un</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                    
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>            
            
            <span class="c1">#add tweet_created_dt</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">:</span> <span class="n">tweet_created_dt</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>
            
            <span class="c1">#add seq number to the end</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>  

            <span class="c1">#add this tweet doc to the array. the array of all tweets will be used to insertMany into mongoDB </span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        
        
        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>    

            <span class="c1">#Get all the basic info about the tweet. </span>
            <span class="n">id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            <span class="n">user_id_str_a</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            <span class="n">screen_name_a</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;seq_no&#39;</span><span class="p">]</span>            
            <span class="n">tweet_created_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%a</span><span class="s2"> %b </span><span class="si">%d</span><span class="s2"> %H:%M:%S +0000 %Y&quot;</span><span class="p">)</span>
                 
            <span class="c1">#find replies</span>
            <span class="n">type_conn</span> <span class="o">=</span> <span class="s1">&#39;reply&#39;</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;user a replied to user b&#39;</span>
            <span class="k">if</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_status_id&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_user_id_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_reply_to_status_id</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_status_id_str&#39;</span><span class="p">]</span>
                <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_user_id_str&#39;</span><span class="p">]</span>
                <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;in_reply_to_screen_name&#39;</span><span class="p">]</span>                                
                <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                          <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                          <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                          <span class="n">in_reply_to_status_id</span><span class="o">=</span><span class="n">in_reply_to_status_id</span><span class="p">)</span>
                                
            <span class="c1">#find mentions</span>
            <span class="n">type_conn</span> <span class="o">=</span> <span class="s1">&#39;mention&#39;</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;user a mentioned user b&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                
                <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                    
                    <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                    <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                    <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                              <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                              <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>                       
                <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                                        
                    <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                    <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                    <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                              <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                              <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                       
            <span class="c1">#find retweets</span>
            <span class="k">if</span> <span class="s1">&#39;retweeted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
                <span class="n">type_conn</span> <span class="o">=</span> <span class="s1">&#39;retweet&#39;</span>      
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;user a retweeted a tweet from user b&#39;</span>                
                
                <span class="n">retweeted_status_id</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;retweeted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>                
                <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                          <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                          <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="n">retweeted_status_id</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                                 
            <span class="c1">#find quotes</span>
            <span class="k">if</span> <span class="s1">&#39;quoted_status&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>                                
                <span class="n">type_conn</span> <span class="o">=</span> <span class="s1">&#39;quote&#39;</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;user a quoted a tweet from user b&#39;</span>
                
                <span class="n">quote_status_id</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>                
                <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                          <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                          <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="n">quote_status_id</span><span class="p">)</span>                     
                    
                <span class="c1">#find mentions in a quote</span>
                <span class="n">type_conn</span> <span class="o">=</span> <span class="s1">&#39;mention_quote&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;extended_tweet&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>     
                    <span class="k">if</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">]:</span>                        
                        <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;extended_tweet&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>                            
                            <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                            <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                            <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                                      <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                                      <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="n">quote_status_id</span><span class="p">)</span>
                            
                <span class="k">elif</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;quoted_status&#39;</span><span class="p">][</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>
                        <span class="n">user_id_str_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                        <span class="n">screen_name_b</span> <span class="o">=</span> <span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                        <span class="n">addToList</span><span class="p">(</span><span class="n">id_str</span><span class="p">,</span> <span class="n">type_conn</span><span class="p">,</span> <span class="n">user_id_str_a</span><span class="p">,</span> 
                                  <span class="n">screen_name_a</span><span class="p">,</span> <span class="n">user_id_str_b</span><span class="p">,</span> <span class="n">screen_name_b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> 
                                  <span class="n">tweet_created_dt</span><span class="p">,</span> <span class="n">retweeted_status_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quoted_status_id</span><span class="o">=</span><span class="n">quote_status_id</span><span class="p">)</span>
            
        <span class="c1"># insert connections(directed edges) into db</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error loading tweetConnections &quot;</span><span class="p">)</span>
            

        <span class="c1"># create indexes to improve performance</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetConnections&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;edge_screen_name_directed_key&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetConnections&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;edge_screen_name_undirected_key&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetConnections&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>             
                                
            

            
            
            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadTweetHTConnections</span>
    <span class="c1"># Description: This method will call loadCollection_UpdateStatus to load the tweetHTConnections collection        </span>
    <span class="c1"># Parameter:  </span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#    (Large number may cause memory errors, low number may take too long to run)     </span>
<div class="viewcode-block" id="TwitterDB.loadTweetHTConnections"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadTweetHTConnections.html#ta.TwitterDB.loadTweetHTConnections">[docs]</a>    <span class="k">def</span> <span class="nf">loadTweetHTConnections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load hashtag connection in a separate collection in mongoDB. </span>
<span class="sd">        It creates the tweetHTConnections collection.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        inc : </span>
<span class="sd">            used to determine how many tweets will be processed at a time.</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">            the string to clean</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadTweetHTConnections(50000)</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loadCollection_UpdateStatus</span><span class="p">(</span><span class="s1">&#39;tweetHTConnections&#39;</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span></div>
                

    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadTweetHTConnectionsMinMax</span>
    <span class="c1"># Description: This method will load the tweet hashtags connections (edges) associated to each hashtag for each tweet        </span>
    <span class="c1"># It filters by a interval number of tweets. This is because loading everything at once might cause out of memory errors</span>
    <span class="c1"># Parameters:  </span>
    <span class="c1">#   -minV &amp; maxV = the tweet seq_no interval you want to run this analysis for      </span>
    <span class="k">def</span> <span class="nf">loadTweetHTConnectionsMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span><span class="p">):</span>

        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;seq_no&quot;</span><span class="p">:{</span> <span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="n">minV</span><span class="p">,</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="n">maxV</span><span class="p">}})</span>
                        
        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>

            <span class="n">id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;seq_no&#39;</span><span class="p">]</span>
            <span class="n">created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">]</span>

            <span class="c1">#get Hashtags            </span>
            <span class="k">if</span> <span class="s1">&#39;hashtags&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>

                <span class="c1">#build array with all hashtags for this one tweet</span>
                <span class="n">ht_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">gt_tweet</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>
                    <span class="n">ht_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gt_tweet</span><span class="p">[</span><span class="s1">&#39;ht_lower&#39;</span><span class="p">])</span>

                <span class="c1">#loops through the combinations between the hashtags and insert one records for each combination</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">ht_arr</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>   

                    <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">ht_a</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">ht_b</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ht_a</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">ht_b</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>            
                    <span class="n">ht_key</span> <span class="o">=</span> <span class="n">ht_a</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span>  <span class="o">+</span> <span class="n">ht_b</span>

                    <span class="c1">#creating the json doc</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;ht_a&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht_a</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;ht_b&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht_b</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;ht_key&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht_key</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                    <span class="c1">#add created_at</span>
                    <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">:</span> <span class="n">created_at</span><span class="p">}</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

                    <span class="c1">#add seq number to the end</span>
                    <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

                    <span class="c1">#add this tweet doc to the array. the array of all tweets will be used to insertMany into mongoDB </span>
                    <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>


        <span class="c1">#insert hashtags into db</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error loading tweetHTConnections &quot;</span><span class="p">)</span>                            

        <span class="c1"># create indexes to improve performance</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetHTConnections&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;ht_key&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetHTConnections&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  


            
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadWordsData</span>
    <span class="c1"># Description: This method will call loadCollection_UpdateStatus to load the tweetWords collection        </span>
    <span class="c1"># Parameters:  </span>
    <span class="c1">#   -inc = how many tweet records you want to load at the time. </span>
    <span class="c1">#          (Large number may cause memory errors, low number may take too long to run)    </span>
<div class="viewcode-block" id="TwitterDB.loadWordsData"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadWordsData.html#ta.TwitterDB.loadWordsData">[docs]</a>    <span class="k">def</span> <span class="nf">loadWordsData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load the tweet words in a separate collection in mongoDB. </span>
<span class="sd">        It creates the tweetWords collection.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        inc : </span>
<span class="sd">            used to determine how many tweets will be processed at a time.</span>
<span class="sd">            A large number may cause out of memory errors, and a low number may take a long time to run, </span>
<span class="sd">            so the decision of what number to use should be made based on the hardware specification.</span>
<span class="sd">            the string to clean</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadWordsData(50000)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loadCollection_UpdateStatus</span><span class="p">(</span><span class="s1">&#39;tweetWords&#39;</span><span class="p">,</span> <span class="n">inc</span> <span class="p">)</span>        </div>
            
           
    <span class="c1">#####################################</span>
    <span class="c1"># Method: breakTextIntoWords</span>
    <span class="c1"># Description: This method will break text from tweet into words and tag them        </span>
    <span class="c1"># It filters by a interval number of tweets. </span>
    <span class="c1"># This is because loading everything at once might cause out of memory errors</span>
    <span class="c1"># Parameters:  minV &amp; maxV = the tweet seq_no interval you want to run this analysis for    </span>
    <span class="k">def</span> <span class="nf">breakTextIntoWords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span><span class="p">):</span>

        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seq_no</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">select_cTweetWords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;seq_agg&quot;</span> <span class="p">,</span> <span class="s2">&quot;maxSeqNo&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$max&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_no&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweetWords</span><span class="p">:</span>
            <span class="n">max_seq_no</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;maxSeqNo&quot;</span><span class="p">]</span> 
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">max_seq_no</span>                                
        
        <span class="n">select_cFocusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;seq_no&quot;</span><span class="p">:{</span> <span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="n">minV</span><span class="p">,</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="n">maxV</span><span class="p">}})</span>        
        
        
        
        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cFocusedTweet</span><span class="p">:</span>
            
            <span class="c1">#Get all the basic info about the tweet. </span>
            <span class="c1"># (These will always be saved independet of configurations)    </span>
            <span class="n">id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
            <span class="n">text</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;text_combined_clean&#39;</span><span class="p">]</span>           
            <span class="n">year</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">month_name</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;month_name&#39;</span><span class="p">]</span>
            <span class="n">month_no</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;month_no&#39;</span><span class="p">]</span>
            <span class="n">day</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span>
            <span class="n">user_id</span> <span class="o">=</span>  <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
            <span class="n">seq_no_tweet</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;seq_no&#39;</span><span class="p">]</span>                       
            <span class="n">created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">]</span>            

            <span class="k">try</span><span class="p">:</span>                            
                
                <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)):</span>                                                                                                                                

                    <span class="n">cleanWordLw</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                    
                    
                    <span class="n">stop_word_fl</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
                    <span class="k">if</span> <span class="n">cleanWordLw</span> <span class="ow">in</span> <span class="n">stopWords</span><span class="p">:</span>
                        <span class="n">stop_word_fl</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>                                            
                    
                    <span class="n">en_word_fl</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">dictionary_words</span><span class="p">[</span><span class="n">cleanWordLw</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">en_word_fl</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>                           
                                            
                    <span class="n">word_syl</span> <span class="o">=</span> <span class="n">pyphen_dic</span><span class="o">.</span><span class="n">inserted</span><span class="p">(</span><span class="n">cleanWordLw</span><span class="p">)</span>
                                            
                    <span class="n">seq_no</span> <span class="o">=</span> <span class="n">seq_no</span><span class="o">+</span><span class="mi">1</span>                                                            

                    <span class="c1">#lemmatize word</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>                    

                    <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;j&#39;</span><span class="p">:</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="n">wordnet</span><span class="o">.</span><span class="n">ADJ</span>
                    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="n">wordnet</span><span class="o">.</span><span class="n">VERB</span>
                    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="n">wordnet</span><span class="o">.</span><span class="n">NOUN</span>
                    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="n">wordnet</span><span class="o">.</span><span class="n">ADV</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tag</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>                    
                        
                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
                        <span class="n">lemm_word</span> <span class="o">=</span> <span class="n">lemmatiser</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">cleanWordLw</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lemm_word</span> <span class="o">=</span> <span class="n">lemmatiser</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">cleanWordLw</span><span class="p">)</span>
                                            
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;word&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">cleanWordLw</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;,&quot;word_tag&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> \
                            <span class="s1">&#39;&quot;,&quot;word_lemm&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">lemm_word</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;,&quot;word_syl&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">word_syl</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;,&quot;stop_word_fl&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">stop_word_fl</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;,&quot;en_word_fl&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">en_word_fl</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;,&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span>  <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;text&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;year&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;month_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;month_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">month_no</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;day&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">user_id</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                    
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>                                                                        
                    
                    <span class="c1">#add created_at</span>
                    <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">:</span> <span class="n">created_at</span><span class="p">}</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>  

                    <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tweet_seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no_tweet</span><span class="p">,</span> <span class="s1">&#39;seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>    
                    <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>
                    
                    <span class="c1">#add this tweet doc to the array. the array of all tweets will be used to insertMany into mongoDB </span>
                    <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>                                               

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error on loadWordsData. &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; | err tweet_id: &quot;</span> <span class="o">+</span> <span class="n">id_str</span><span class="p">)</span>

        
        <span class="c1">#insert words into db</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error on loadWordsData | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span> 
            
        
        <span class="c1"># create index to improve performance</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;tweet_seq_no&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetWords&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create index in tweetWords&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            

                
    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadAggregations</span>
    <span class="c1"># Description: load aggregations</span>
    <span class="c1"># Parameters:  </span>
    <span class="c1">#  -aggType = the type of aggreagation you want to run - </span>
    <span class="c1">#   (Options: tweetCountByFile, hashtagCount, tweetCountByLanguageAgg, </span>
    <span class="c1">#             tweetCountByMonthAgg, tweetCountByUser)</span>
<div class="viewcode-block" id="TwitterDB.loadAggregations"><a class="viewcode-back" href="../generated/ta.TwitterDB.loadAggregations.html#ta.TwitterDB.loadAggregations">[docs]</a>    <span class="k">def</span> <span class="nf">loadAggregations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to load addtional aggregated collection to MongoDB</span>
<span class="sd">        It creates the tweetWords collection.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------                                       </span>
<span class="sd">        aggType : </span>
<span class="sd">            the type of aggreagation you want to run.</span>
<span class="sd">            (Options: tweetCountByFile, hashtagCount, tweetCountByLanguageAgg, </span>
<span class="sd">            tweetCountByMonthAgg, tweetCountByUser)</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; loadAggregations(&#39;tweetCountByFile&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
    
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;loading &quot;</span> <span class="o">+</span> <span class="n">aggType</span> <span class="o">+</span> <span class="s2">&quot; process started....&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">aggType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByFile&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tweetCountByFileAgg</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">aggType</span> <span class="o">==</span> <span class="s1">&#39;hashtagCount&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hashtagCountAgg</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">aggType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByLanguageAgg&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tweetCountByLanguageAgg</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">aggType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByMonthAgg&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tweetCountByPeriodAgg</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">aggType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByUser&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tweetCountByUser</span><span class="p">()</span>    
            
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;loading &quot;</span> <span class="o">+</span> <span class="n">aggType</span> <span class="o">+</span> <span class="s2">&quot; process completed.&quot;</span><span class="p">)</span></div>


    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: tweetCountByFileAgg</span>
    <span class="c1"># Description: load aggregation on tweetCountByFileAgg collection</span>
    <span class="k">def</span> <span class="nf">tweetCountByFileAgg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
        <span class="c1">#delete everything from the collection because we will repopulate it</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByFileAgg</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span> 
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;$file_path&quot;</span><span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>

        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>            
            <span class="k">try</span><span class="p">:</span>        
                <span class="k">if</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;file_path&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>                

                    <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByFileAgg</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error running aggregation: tweetCountByFile | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">continue</span>                 
                
                
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: hashtagCountAgg</span>
    <span class="c1"># Description: load aggregation on hashTagCountAgg collection</span>
    <span class="k">def</span> <span class="nf">hashtagCountAgg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>     

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_hashTagCountAgg</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span> 
        <span class="n">select_cfocusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s1">&#39;$hashtags&#39;</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;hashtags&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ht&quot;</span><span class="p">:</span> <span class="s1">&#39;$hashtags.ht&#39;</span><span class="p">}</span> <span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;ht&quot;</span><span class="p">:</span> <span class="s1">&#39;$hashtags.ht_lower&#39;</span> <span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>

        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cfocusedTweet</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>    
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;hashtag&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;ht&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>        

                <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]}</span>    
                <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_hashTagCountAgg</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error running aggregation: hashtagCount | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">continue</span>   
            
                    

    <span class="c1">#####################################</span>
    <span class="c1"># Method: tweetCountByLanguageAgg</span>
    <span class="c1"># Description: load aggregation on tweetCountByLanguageAgg collection</span>
    <span class="k">def</span> <span class="nf">tweetCountByLanguageAgg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByLanguageAgg</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span> 
        <span class="n">select_cfocusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;$lang&quot;</span><span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>

        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cfocusedTweet</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>        
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;lang&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>                

                <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByLanguageAgg</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error running aggregation: tweetCountByLanguageAgg | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">continue</span>
                
                    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: tweetCountByPeriodAgg</span>
    <span class="c1"># Description: load aggregation on tweetCountByPeriodAgg collection </span>
    <span class="k">def</span> <span class="nf">tweetCountByPeriodAgg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByPeriodAgg</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span> 
        <span class="n">select_cfocusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;$year&quot;</span><span class="p">,</span> <span class="s2">&quot;month_no&quot;</span><span class="p">:</span> <span class="s2">&quot;$month_no&quot;</span><span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>

        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cfocusedTweet</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>        
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;year&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s1">&#39;&quot;,&quot;month_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;month_no&quot;</span><span class="p">]</span>  <span class="o">+</span> \
                      <span class="s1">&#39;&quot;, &quot;count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>                

                <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByPeriodAgg</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error running aggreagation: tweetCountByPeriodAgg | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">continue</span>                                         

    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: tweetCountByUser</span>
    <span class="c1"># Description: load aggregation on tweetCountByUserAgg collection</span>
    <span class="k">def</span> <span class="nf">tweetCountByUser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByUserAgg</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>         
        <span class="n">select_cfocusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> 
            <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;$user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;user_screen_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;$user_screen_name&quot;</span><span class="p">},</span> 
                         <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">],</span>
            <span class="n">allowDiskUse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="n">Collation</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="s2">&quot;en_US&quot;</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cfocusedTweet</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>        
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;user_screen_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_screen_name&quot;</span><span class="p">]</span>  <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>                        

                <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByUserAgg</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error running aggregation: tweetCountByUser | &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">continue</span>
                  

                    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: create_tmp_edge_collections</span>
    <span class="c1"># Description: This method will create temporary collections to help improve </span>
    <span class="c1"># query performance when filtering data by a list of edges</span>
    <span class="c1"># Creating some temp collections, we can create indexes that will increase the lookup performance</span>
    <span class="c1"># This method was created to allow performance improvements</span>
    <span class="c1"># Parameters:  </span>
    <span class="c1">#  -arr_edges = the list of edges you want to search for - </span>
    <span class="c1">#   (format &quot;screen_name&quot;-&quot;screen_name&quot;)</span>
    <span class="c1">#  -startDate_filter &amp; endDate_filter = if you want to filter your query by a period - (Default=None)</span>
    <span class="c1">#  -is_bot_Filter = if you want to filter by a connections being for a bot or not</span>
    <span class="k">def</span> <span class="nf">create_tmp_edge_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="p">,</span> <span class="n">query_filter</span><span class="p">):</span>
                                
        <span class="k">if</span> <span class="n">arr_ht_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr_edges</span> <span class="o">=</span> <span class="n">arr_ht_edges</span>                                     
        
        <span class="n">arr_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdges</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>

        <span class="c1"># *** creating tmp collection with given edges</span>
        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr_edges</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;edge&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>                                               

        <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdges</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdges</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span>  <span class="c1">#creating index on tmp collection</span>
        <span class="c1"># **********************</span>


        <span class="c1"># *** creating tmp collection for tweet ids for the given edges            </span>
        <span class="k">if</span> <span class="n">arr_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="s2">&quot;tweetConnections&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;edge_screen_name_undirected_key&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;as&quot;</span><span class="p">:</span><span class="s2">&quot;fromItems&quot;</span><span class="p">}},</span>
                         <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$fromItems&quot;</span> <span class="p">},</span>
                         <span class="p">{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="n">query_filter</span> <span class="p">},</span>
                         <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">:</span> <span class="s2">&quot;$fromItems.tweet_id_str&quot;</span><span class="p">}</span> <span class="p">}]</span>
        <span class="k">if</span> <span class="n">arr_ht_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="s2">&quot;tweetHTConnections&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;ht_key&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;fromItems&quot;</span><span class="p">}},</span>
                         <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$fromItems&quot;</span> <span class="p">},</span>
                         <span class="p">{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="n">query_filter</span> <span class="p">},</span>
                         <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">:</span> <span class="s2">&quot;$fromItems.tweet_id_str&quot;</span><span class="p">}</span> <span class="p">}]</span>
        
        <span class="n">select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdges</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>                             
            <span class="n">arr_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">])</span>


        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arr_no_dups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">arr_ids</span><span class="p">))</span> 

        <span class="k">for</span> <span class="n">id_str</span> <span class="ow">in</span> <span class="n">arr_no_dups</span> <span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">id_str</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="c1"># insert data into tmp collection</span>
        <span class="k">if</span> <span class="n">file_data</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)])</span> 

        <span class="c1"># ******************************</span>
            

    <span class="c1">#####################################</span>
    <span class="c1"># Method: set_bot_flag_based_on_arr</span>
    <span class="c1"># Description: This method will update collections focusedTweet, users,</span>
    <span class="c1"># and tweetConnections to identify is a user or tweet connections are from bots.</span>
    <span class="c1"># The bot list is passed as parameter</span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   -bots_list_id_str = a list of user_ids that are bots</span>
    <span class="c1">#   -inc = how many tweets we want to update at the time for field is_bot_connection.</span>
    <span class="c1">#    Default=10000 (High number might take too long to run)</span>
<div class="viewcode-block" id="TwitterDB.set_bot_flag_based_on_arr"><a class="viewcode-back" href="../generated/ta.TwitterDB.set_bot_flag_based_on_arr.html#ta.TwitterDB.set_bot_flag_based_on_arr">[docs]</a>    <span class="k">def</span> <span class="nf">set_bot_flag_based_on_arr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bots_list_id_str</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to update MongoDb collection with a flag identifieng </span>
<span class="sd">        is a user is a bot or not. </span>
<span class="sd">        It updates the records based on a given list of user_ids.        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------      </span>
<span class="sd">        bots_list_id_str :</span>
<span class="sd">            and array with a list of Twitter user ids that are bots</span>
<span class="sd">            </span>
<span class="sd">        inc : (Optional)</span>
<span class="sd">            how many tweets we want to update at the time for field is_bot_connection.</span>
<span class="sd">            Default=10000 (High number might take too long to run)</span>
<span class="sd">                   </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; arr_bots = [&#39;123456&#39;, &#39;1231654&#39;]</span>
<span class="sd">            &gt;&gt;&gt; set_bot_flag_based_on_arr(arr_bots, 20000)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updating bot flag...&quot;</span><span class="p">)</span>
        
        <span class="c1"># set all records to be is_bot = 0 at first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_users</span><span class="o">.</span><span class="n">update_many</span><span class="p">({},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;is_bot&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">update_many</span><span class="p">({},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;is_bot&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">update_many</span><span class="p">({},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;is_bot&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">update_many</span><span class="p">({},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;is_bot&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;is_bot_connection&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">update_many</span><span class="p">({},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;is_bot&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;is_bot_connection&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}})</span>        

        <span class="c1">#updates collections based on the given list of bots user_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_users</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;user_id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">bots_list_id_str</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">bots_list_id_str</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">bots_list_id_str</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;user_id_str_a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">bots_list_id_str</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>        
                
        <span class="c1"># **** Updating the tweets that are bots or connected to bots                </span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">arr_bot_conn</span> <span class="o">=</span> <span class="p">[]</span>                
        
        <span class="c1">#find all the ids that are connected to bots (replies, retweets, quotes or mentions)</span>
        <span class="n">select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;is_bot&quot;</span> <span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">arr_bot_conn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">])</span>
            <span class="c1"># updating records using the $in operator can take a long time if the array is too big. That is why we do it in increments</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">inc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">arr_bot_conn</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot_connection&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">arr_bot_conn</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot_connection&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">arr_bot_conn</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot_connection&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
                <span class="n">arr_bot_conn</span><span class="o">=</span> <span class="p">[];</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">arr_bot_conn</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot_connection&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">arr_bot_conn</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot_connection&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s1">&#39;id_str&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="n">arr_bot_conn</span><span class="p">}},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_bot&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">}})</span>
        <span class="c1"># **************************** </span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updating bot flag completed&quot;</span><span class="p">)</span></div>
        
       
    <span class="c1"># Method: build_filter</span>
    <span class="c1"># Description: Build filter for queries. </span>
    <span class="c1"># This is called by method queryData to create the filter that will by used in method</span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#  -startDate_filter &amp; endDate_filter: coming from method queryData</span>
    <span class="c1">#  -is_bot_Filter: coming from method queryData</span>
    <span class="c1">#  -ht_to_filter: coming from method queryData </span>
    <span class="c1">#  -user_conn_filter: coming from method queryData</span>
    <span class="c1">#  -exportType: coming from method queryData</span>
    <span class="k">def</span> <span class="nf">build_filter</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">is_bot_Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">ht_to_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">user_conn_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">exportType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                                      

        <span class="c1"># set correct format for start and end dates</span>
        <span class="k">if</span> <span class="n">startDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">endDate_filter</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>  
        
        <span class="c1">#set the comparison operator for bots queries    </span>
        <span class="k">if</span> <span class="n">is_bot_Filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>            
            <span class="k">if</span> <span class="n">is_bot_Filter</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">bot_filter_comp_operator</span> <span class="o">=</span> <span class="s2">&quot;$and&quot;</span>                
            <span class="k">elif</span> <span class="n">is_bot_Filter</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">bot_filter_comp_operator</span> <span class="o">=</span> <span class="s2">&quot;$or&quot;</span>
                
        <span class="c1">#set up the query filter base on the given parameters</span>
        <span class="n">date_filter</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="n">bot_filter</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="n">ht_filter</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="n">conn_filter</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">date_filter_for_edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">bot_filter_for_edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ht_filter_for_edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">conn_filter_edges</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#date filter</span>
        <span class="k">if</span> <span class="n">startDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_filter</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;tweet_created_at&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="n">end_date</span> <span class="p">}</span> <span class="p">}</span>
            <span class="n">date_filter_for_edges</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;fromItems.tweet_created_at&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="n">end_date</span> <span class="p">}</span> <span class="p">}</span>
        <span class="c1">#bot filter</span>
        <span class="k">if</span> <span class="n">is_bot_Filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bot_filter</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;$or&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;is_bot&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">is_bot_Filter</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span> <span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;is_bot_connection&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">is_bot_Filter</span><span class="p">)</span> <span class="p">}</span> <span class="p">}]}</span>
            <span class="n">bot_filter_for_edges</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;fromItems.is_bot&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">is_bot_Filter</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
        <span class="c1">#ht filter</span>
        <span class="k">if</span> <span class="n">ht_to_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ht_filter</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hashtags.ht_lower&quot;</span><span class="p">:</span> <span class="n">ht_to_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
            <span class="n">ht_filter_for_edges</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">##### ***need to address this later            </span>
        <span class="k">if</span> <span class="n">user_conn_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="n">conn_filter</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type_of_connection&quot;</span><span class="p">:</span> <span class="n">user_conn_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
            <span class="n">conn_filter_edges</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type_of_connection&quot;</span><span class="p">:</span> <span class="n">user_conn_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
                
        <span class="n">query_filter</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;$and&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="n">date_filter</span><span class="p">,</span> <span class="n">bot_filter</span><span class="p">,</span> <span class="n">ht_filter</span><span class="p">,</span> <span class="n">conn_filter</span> <span class="p">]}</span>
        <span class="n">query_filter_for_edges</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;$and&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="n">date_filter_for_edges</span><span class="p">,</span> <span class="n">bot_filter_for_edges</span><span class="p">,</span> <span class="n">ht_filter_for_edges</span><span class="p">,</span> <span class="n">conn_filter_edges</span> <span class="p">]}</span>
        
        <span class="k">return</span> <span class="n">query_filter</span><span class="p">,</span> <span class="n">query_filter_for_edges</span>
                            
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: exportData</span>
    <span class="c1"># Description: Exports data into \t delimited file</span>
<div class="viewcode-block" id="TwitterDB.exportData"><a class="viewcode-back" href="../generated/ta.TwitterDB.exportData.html#ta.TwitterDB.exportData">[docs]</a>    <span class="k">def</span> <span class="nf">exportData</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">exportType</span><span class="p">,</span> 
            <span class="n">filepath</span><span class="p">,</span> 
            <span class="n">inc</span><span class="p">,</span> 
            <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">is_bot_Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">top_no_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">ht_to_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">include_hashsymb_FL</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>  
            <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">user_conn_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to export the data from MongoDb into text files based on certain filters.        </span>
<span class="sd">               </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; ...</span>
<span class="sd">        &quot;&quot;&quot;</span>  
                
        
        <span class="c1">#export edges   </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">):</span>        
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;edges.txt&#39;</span>
        <span class="c1">#export text for topic analysis</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;text_for_topics&#39;</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_tweetTextsForTopics.txt&#39;</span>
        <span class="c1">#export ht frequency list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;ht_frequency_list&#39;</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_HT_FrequencyList.txt&#39;</span>
        <span class="c1">#export words frequency list - (TOP 5000)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;word_frequency_list&#39;</span><span class="p">):</span>                            
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_Words_FrequencyList.txt&#39;</span>            
        <span class="c1">#export text for topic analysis</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweet_ids_timeseries&#39;</span><span class="p">):</span>                                                                              
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_tweetIdswithDates.txt&#39;</span>                        
        <span class="c1">#export tweetCountByUser</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCount&#39;</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCount.txt&#39;</span>                                    
        <span class="c1">#export tweetCountByUser</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;userCount&#39;</span><span class="p">):</span>            
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;userCount.txt&#39;</span>
        <span class="c1">#export tweetCountByUser</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByUser&#39;</span><span class="p">):</span>            
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCountByUser.txt&#39;</span>                                
        <span class="c1">#export tweetCountByLanguage</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByLanguage&#39;</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">tweetCountByLanguage.txt&#39;</span>                                        
        <span class="c1">#export tweetCountByFile</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByFile&#39;</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCountByFile.txt&#39;</span>
        <span class="c1">#export tweetCountByMonth</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByMonth&#39;</span><span class="p">):</span>          
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCountByMonth.txt&#39;</span>        
        <span class="c1">#export hashtagCount</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;hashtagCount&#39;</span><span class="p">):</span> 
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;hashtagCount.txt&#39;</span>
        <span class="c1">#export topics by hashtag</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;topicByHashtag&#39;</span><span class="p">):</span> 
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;topicByHashtag.txt&#39;</span>        
        <span class="k">elif</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;ht_edges&#39;</span><span class="p">):</span> 
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;ht_edges.txt&#39;</span>
            
        <span class="c1">#export tweetTextAndPeriod</span>
        <span class="c1">#if (exportType == &#39;tweetTextAndPeriod&#39;):                                </span>
        <span class="c1">#export tweetDetails</span>
        <span class="c1">#if (exportType == &#39;tweetDetails&#39;):                </span>
        <span class="c1">#export words</span>
        <span class="c1">#if (exportType == &#39;wordsOnEachTweet&#39;):  </span>
        <span class="c1">#user details on Each Tweet</span>
        <span class="c1">#if (exportType == &#39;userDetailsOnEachTweet&#39;):        </span>
        
        <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="n">arr</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryData</span><span class="p">(</span><span class="n">exportType</span><span class="p">,</span> 
                                       <span class="n">filepath</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> 
                                       <span class="n">startDate_filter</span><span class="p">,</span> 
                                       <span class="n">endDate_filter</span><span class="p">,</span> 
                                       <span class="n">is_bot_Filter</span><span class="p">,</span> 
                                       <span class="n">arr_edges</span><span class="p">,</span> 
                                       <span class="n">arr_ht_edges</span><span class="p">,</span> 
                                       <span class="n">top_no_filter</span><span class="p">,</span> 
                                       <span class="n">ht_to_filter</span><span class="p">,</span> 
                                       <span class="n">user_conn_filter</span><span class="o">=</span><span class="n">user_conn_filter</span><span class="p">)</span>
    
            <span class="c1">#export in array into txt file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exportToFile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>
        
        

    <span class="c1">#####################################</span>
    <span class="c1"># Method: set_bot_flag_based_on_arr</span>
    <span class="c1"># Description: Exports data into \t delimited file</span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   -exportType: (Options: edges, </span>
    <span class="c1">#                          text_for_topics, </span>
    <span class="c1">#                          ht_frequency_list, </span>
    <span class="c1">#                          word_frequency_list </span>
    <span class="c1">#                          tweetCountByUser </span>
    <span class="c1">#                          tweetCountByLanguage, </span>
    <span class="c1">#                          tweetCountByFile, </span>
    <span class="c1">#                          tweetCountByMonth, </span>
    <span class="c1">#                          hashtagCount, </span>
    <span class="c1">#                          tweetTextAndPeriod, </span>
    <span class="c1">#                          wordsOnEachTweet </span>
    <span class="c1">#                          userDetailsOnEachTweet)    </span>
    <span class="c1">#   -filepath: the file path where the files will be saved  </span>
    <span class="c1">#   -inc: To set how many lines per files we want to save. </span>
    <span class="c1">#    This is for collection that have too many records to be saved. </span>
    <span class="c1">#    Memory issues can happens if this number is too big</span>
    <span class="c1">#    Only works when exporting for types tweetTextAndPeriod, wordsOnEachTweet,</span>
    <span class="c1">#    userDetailsOnEachTweet, we can set how many lines per file    </span>
    <span class="c1">#   -startDate_filter &amp; endDate_filter: Date period you want to filter the tweets by.</span>
    <span class="c1">#    Only available for options &quot;edges&quot;, &quot;text_for_topics&quot;, </span>
    <span class="c1">#    and &quot;ht_frequency_list&quot;. (Defaul=None)    </span>
    <span class="c1">#   -is_bot_Filter: Filter tweets and connections by being bots or not.</span>
    <span class="c1">#    Only available for options &quot;edges&quot;, &quot;text_for_topics&quot;,</span>
    <span class="c1">#    and &quot;ht_frequency_list&quot;. (Defaul=None)    </span>
    <span class="c1">#   -arr_edges: Filter tweet connections by this array of edges. </span>
    <span class="c1">#    Only available for options &quot;text_for_topics&quot;, </span>
    <span class="c1">#    and &quot;ht_frequency_list&quot;. (Defaul=None)    </span>
    <span class="c1">#   -top_no_filter: Filter top frequent words based on the number of this parameter.</span>
    <span class="c1">#    Only available for option &quot;word_frequency_list&quot; (Defaul=None)</span>
<div class="viewcode-block" id="TwitterDB.queryData"><a class="viewcode-back" href="../generated/ta.TwitterDB.queryData.html#ta.TwitterDB.queryData">[docs]</a>    <span class="k">def</span> <span class="nf">queryData</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">exportType</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> 
            <span class="n">startDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">endDate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">is_bot_Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">arr_ht_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">top_no_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">ht_to_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">include_hashsymb_FL</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
            <span class="n">user_conn_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to query the data from MongoDb. </span>
<span class="sd">        The method return an array with the data retrieved from MongoDB.</span>
<span class="sd">               </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                              </span>
<span class="sd">            &gt;&gt;&gt; ...</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        

        <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># set correct format for start and end dates</span>
        <span class="k">if</span> <span class="n">startDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">startDate_filter</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">endDate_filter</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>
            
        
        <span class="c1">#build a variable with all filter based on parameters        </span>
        <span class="n">query_filter</span><span class="p">,</span> <span class="n">query_filter_for_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_filter</span><span class="p">(</span><span class="n">startDate_filter</span><span class="p">,</span> 
                                                                 <span class="n">endDate_filter</span><span class="p">,</span> 
                                                                 <span class="n">is_bot_Filter</span><span class="p">,</span> 
                                                                 <span class="n">ht_to_filter</span><span class="p">,</span> 
                                                                 <span class="n">user_conn_filter</span><span class="p">,</span> 
                                                                 <span class="n">exportType</span><span class="p">)</span>

                
        <span class="c1">#export edges</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">):</span>
                
            <span class="n">pipeline</span> <span class="o">=</span>  <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="n">query_filter</span> <span class="p">},</span>
                          <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;screen_name_a&quot;</span><span class="p">:</span> <span class="s2">&quot;$screen_name_a&quot;</span><span class="p">,</span> 
                                              <span class="s2">&quot;screen_name_b&quot;</span><span class="p">:</span> <span class="s2">&quot;$screen_name_b&quot;</span><span class="p">},</span>
                                      <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}}}</span> <span class="p">]</span>
                            
            <span class="c1">#get data from database, loop through records and insert into array</span>
            <span class="n">select_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetConnections</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> 
                                                             <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                                             <span class="n">collation</span><span class="o">=</span><span class="n">Collation</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="s2">&quot;en_US&quot;</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_edges</span><span class="p">:</span>                
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s1">&#39;screen_name_a&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s1">&#39;screen_name_b&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>
                                
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;edges.txt&#39;</span>
            
            
            
        <span class="c1">#export hashtag edges</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;ht_edges&#39;</span><span class="p">):</span>                        
                
            <span class="c1">#in case we don&#39;t have an array of edges to filter by</span>
            <span class="k">if</span> <span class="n">arr_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pipeline</span> <span class="o">=</span>  <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="n">query_filter</span> <span class="p">},</span>
                              <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ht_a&quot;</span><span class="p">:</span> <span class="s2">&quot;$ht_a&quot;</span><span class="p">,</span> <span class="s2">&quot;ht_b&quot;</span><span class="p">:</span> <span class="s2">&quot;$ht_b&quot;</span><span class="p">},</span>
                                          <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}}}</span> 
                            <span class="p">]</span>              
                <span class="n">select_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetHTConnections</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>                
                
                <span class="c1">#create temp collection for edges                </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_tmp_edge_collections</span><span class="p">(</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="p">,</span> <span class="n">query_filter_for_edges</span><span class="p">)</span>                                
                
                <span class="c1">#create temp collection for ht</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesHTFreq</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span>
                                       <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;tweetHTConnections&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;tweetHTConnections&quot;</span><span class="p">}},</span>
                              <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$tweetHTConnections&quot;</span><span class="p">},</span>
                              <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ht_a&quot;</span><span class="p">:</span> <span class="s2">&quot;$tweetHTConnections.ht_a&quot;</span><span class="p">,</span> <span class="s2">&quot;ht_b&quot;</span><span class="p">:</span> <span class="s2">&quot;$tweetHTConnections.ht_b&quot;</span><span class="p">},</span>
                                          <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}}}</span>
                           <span class="p">]</span>
                <span class="n">select_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            
            <span class="c1">#get data from database, loop through records and insert into array            </span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_edges</span><span class="p">:</span>                                
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s1">&#39;ht_a&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s1">&#39;ht_b&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>
                                
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;ht_edges.txt&#39;</span>



        <span class="c1">#export text for topic analysis</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;text_for_topics&#39;</span><span class="p">):</span>                                                                  
                
            <span class="c1">#in case we don&#39;t have an array of edges to filter by</span>
            <span class="k">if</span> <span class="n">arr_edges</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arr_ht_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                         
                <span class="n">select_texts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query_filter</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;text_combined_clean&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="p">)</span>                                

            <span class="c1">#in case we have an array of edges to filter by</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">create_tmp_edge_collections</span><span class="p">(</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="p">,</span> <span class="n">query_filter_for_edges</span><span class="p">)</span>
                
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span>
                                       <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">}},</span>    
                              <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet&quot;</span> <span class="p">},</span>                              
                              <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;text_combined_clean&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet.text_combined_clean&quot;</span> <span class="p">}}]</span>
                
                <span class="n">select_texts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                


            <span class="c1">#get data from database, loop through records and insert into array</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_texts</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;text_combined_clean&#39;</span><span class="p">]])</span>
            
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_tweetTextsForTopics.txt&#39;</span>


                        
        <span class="c1">#export ht frequency list</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;ht_frequency_list&#39;</span><span class="p">):</span>                
                                    
            <span class="c1">#in case we don&#39;t have an array of edges to filter by</span>
            <span class="k">if</span> <span class="n">arr_edges</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arr_ht_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="n">query_filter</span> <span class="p">},</span>
                              <span class="p">{</span> <span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s1">&#39;$hashtags&#39;</span> <span class="p">},</span>                                                                    
                              <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;ht&quot;</span><span class="p">:</span> <span class="s1">&#39;$hashtags.ht&#39;</span> <span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}]</span>

                <span class="n">select_ht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="n">Collation</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="s2">&quot;en_US&quot;</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>


            <span class="c1">#in case we have an array of edges to filter by</span>
            <span class="k">else</span><span class="p">:</span>
                
                
                <span class="c1">#*************************************************************************************</span>
                <span class="c1"># Creating a temporary collection with all hashtags for each tweet for the given edges</span>
                <span class="c1"># This is possible without creating temp collections, </span>
                <span class="c1">#   but it was done this way to improve performance. </span>
                <span class="c1"># Running with a different Collation can take a LONG time - </span>
                <span class="c1">#  (We need to run with Collation strength=2 to get canse insensitive counts )</span>
                
                <span class="c1">#create temp collection for edges                </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_tmp_edge_collections</span><span class="p">(</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="p">,</span> <span class="n">query_filter_for_edges</span><span class="p">)</span>                                
                
                <span class="c1">#create temp collection for ht</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesHTFreq</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span>
                                       <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">}},</span>
                              <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet&quot;</span> <span class="p">},</span>
                              <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s1">&#39;$focusedTweet.hashtags&#39;</span> <span class="p">},</span>
                              <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;ht&quot;</span><span class="p">:</span> <span class="s1">&#39;$focusedTweet.hashtags.ht&#39;</span><span class="p">,</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">:</span> <span class="s1">&#39;$tweet_id_str&#39;</span>  <span class="p">}</span> <span class="p">}]</span>
                <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">select_ht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_ht</span><span class="p">:</span>    
                    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tweet_id_str&#39;</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="s1">&#39;&quot;, &quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ht&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file_data</span> <span class="o">!=</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesHTFreq</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
                <span class="c1">#**************************************************************************************</span>
                
                
                <span class="c1">#getting counts for each hashtag</span>
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;ht&quot;</span><span class="p">:</span> <span class="s1">&#39;$ht&#39;</span> <span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}]</span>                                
                <span class="n">select_ht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesHTFreq</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="n">Collation</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="s2">&quot;en_US&quot;</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                
                

            <span class="n">hash_symbol</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
            <span class="k">if</span> <span class="n">include_hashsymb_FL</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="n">hash_symbol</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

            <span class="c1">#get data from database, loop through records and insert into array</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_ht</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">hash_symbol</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">][</span><span class="s1">&#39;ht&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>

            <span class="c1">#sort array in count descending order</span>
            <span class="k">def</span> <span class="nf">sortSecond</span><span class="p">(</span><span class="n">val</span><span class="p">):</span> 
                <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">arr</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sortSecond</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

            <span class="k">if</span> <span class="n">top_no_filter</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:</span><span class="n">top_no_filter</span><span class="p">]</span>
                
                
                                    
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_HT_FrequencyList.txt&#39;</span>
            
            
        <span class="c1">#export words frequency list - (TOP 5000)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;word_frequency_list&#39;</span><span class="p">):</span>                
                                                       
            <span class="c1"># This variable will get set to True for options where we want to create </span>
            <span class="c1">#  a separate tmp collection to save the words. </span>
            <span class="c1">#  (This was done this way to allow some performance improvements)</span>
            <span class="n">bln_GetWords_From_Text</span> <span class="o">=</span> <span class="kc">False</span>             
            
            <span class="c1">#in case we don&#39;t have an array of edges to filter by</span>
            <span class="k">if</span> <span class="n">arr_edges</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arr_ht_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                                                                                     
                <span class="c1">#if we are filtering by period and by is_bot</span>
                <span class="k">if</span> <span class="n">startDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_bot_Filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">bln_GetWords_From_Text</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">select_texts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query_filter</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;text_combined_clean&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;id_str&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="p">)</span>
                                        

                <span class="c1">#if we are filtering by period only</span>
                <span class="k">elif</span> <span class="n">startDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endDate_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$and&quot;</span><span class="p">:</span> 
                                            <span class="p">[{</span><span class="s2">&quot;tweet_created_at&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">}},</span>
                                             <span class="p">{</span><span class="s2">&quot;stop_word_fl&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="s2">&quot;F&quot;</span><span class="p">}</span> <span class="p">}</span> <span class="p">]}},</span>
                                <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="s1">&#39;$word&#39;</span><span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}]</span>
                    <span class="n">select_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    

                <span class="c1">#if we are filtering by is_bot</span>
                <span class="k">elif</span> <span class="n">is_bot_Filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1">#wrong                                      </span>
                    <span class="n">bln_GetWords_From_Text</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">select_texts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query_filter</span><span class="p">,</span> 
                                                            <span class="p">{</span> <span class="s2">&quot;text_combined_clean&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;id_str&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
                

                <span class="c1">#if there is no filter</span>
                <span class="k">else</span><span class="p">:</span>                        
                    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;stop_word_fl&quot;</span> <span class="p">:</span>  <span class="p">{</span> <span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="s2">&quot;F&quot;</span> <span class="p">}}},</span> 
                                <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="s1">&#39;$word&#39;</span><span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}]</span>
                    
                    <span class="n">select_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                                                                                    

            <span class="c1">#in case we have an array of edges to filter by</span>
            <span class="k">else</span><span class="p">:</span>                
                
                <span class="c1">#**************************************************************************************</span>
                <span class="c1"># Creating a temporary collection with all hashtags for each tweet for the given edges</span>
                <span class="c1"># This is possible without creating temp collections, but it was done this way to improve performance. </span>
                <span class="c1"># Running with a different Collation can take a LONG time - </span>
                <span class="c1"># (We need to run with Collation strength=2 to get canse insensitive counts )</span>
                                
                <span class="c1">#create temp collection for edges                </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_tmp_edge_collections</span><span class="p">(</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="p">,</span> <span class="n">query_filter_for_edges</span><span class="p">)</span>
                
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span>
                                       <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;id_str&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">}},</span>
                              <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet&quot;</span> <span class="p">},</span>
                              <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id_str&quot;</span><span class="p">:</span> <span class="s2">&quot;$tweet_id_str&quot;</span><span class="p">,</span> 
                                            <span class="s2">&quot;text_combined_clean&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet.text_combined_clean&quot;</span> <span class="p">}}]</span>
                <span class="n">select_texts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
                <span class="n">bln_GetWords_From_Text</span> <span class="o">=</span> <span class="kc">True</span>
                


            <span class="c1"># If we want to create a tmp collection to save the words after spliting the words from text. </span>
            <span class="c1"># (This was done this way to allow some performance improvements)</span>
            <span class="c1"># this option is being used when we are filtering by is_bot or by edges</span>
            <span class="k">if</span> <span class="n">bln_GetWords_From_Text</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesWordFreq</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>                
                <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>                
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_texts</span><span class="p">:</span>                         
                    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;text_combined_clean&#39;</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopWords</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;tweet_id_str&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                    <span class="s1">&#39;&quot;, &quot;word&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                            <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                                            
                <span class="k">if</span> <span class="n">file_data</span> <span class="o">!=</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesWordFreq</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
                <span class="c1">#**************************************************************************************                </span>

                <span class="c1">#getting counts for each word</span>
                <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="s1">&#39;$word&#39;</span> <span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}]</span>                
                <span class="n">select_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesWordFreq</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
                

            <span class="c1">#get data from database, loop through records and insert into array            </span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_word</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">][</span><span class="s1">&#39;word&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>

            <span class="c1">#sort array in count descending order</span>
            <span class="k">def</span> <span class="nf">sortSecond</span><span class="p">(</span><span class="n">val</span><span class="p">):</span> 
                <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">arr</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sortSecond</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:</span><span class="n">top_no_filter</span><span class="p">]</span>
            
   
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_Words_FrequencyList.txt&#39;</span>            
            
          
        
        <span class="c1">#export text for topic analysis</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweet_ids_timeseries&#39;</span><span class="p">):</span>                                                                  
                
            <span class="c1">#in case we don&#39;t have an array of edges to filter by</span>
            <span class="k">if</span> <span class="n">arr_edges</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arr_ht_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                         
                <span class="n">select_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query_filter</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;id_str&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;tweet_created_at&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="p">)</span>                                

            <span class="c1">#in case we have an array of edges to filter by</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">create_tmp_edge_collections</span><span class="p">(</span><span class="n">arr_edges</span><span class="p">,</span> <span class="n">arr_ht_edges</span><span class="p">,</span> <span class="n">query_filter_for_edges</span><span class="p">)</span>                                
                
                <span class="k">if</span> <span class="n">ht_to_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>                
                    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span>
                                           <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;id_str&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">}},</span>    
                                  <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet&quot;</span> <span class="p">},</span>   
                                  <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id_str&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet.id_str&quot;</span><span class="p">,</span> 
                                                <span class="s2">&quot;tweet_created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet.tweet_created_at&quot;</span> <span class="p">}}]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;$lookup&quot;</span><span class="p">:{</span>
                                           <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;localField&quot;</span><span class="p">:</span> <span class="s2">&quot;tweet_id_str&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;foreignField&quot;</span><span class="p">:</span> <span class="s2">&quot;id_str&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;as&quot;</span> <span class="p">:</span> <span class="s2">&quot;focusedTweet&quot;</span><span class="p">}},</span>    
                                  <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet&quot;</span> <span class="p">},</span>   
                                  <span class="p">{</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;focusedTweet.hashtags.ht_lower&quot;</span><span class="p">:</span> <span class="n">ht_to_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span> <span class="p">},</span>
                                  <span class="p">{</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id_str&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet.id_str&quot;</span><span class="p">,</span> 
                                                <span class="s2">&quot;tweet_created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;$focusedTweet.tweet_created_at&quot;</span> <span class="p">}}]</span>
                    
                <span class="n">select_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tmpEdgesTweetIds</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


            <span class="c1">#get data from database, loop through records and insert into array</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_ids</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;tweet_created_at&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]])</span> 
                
            
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;T_tweetIdswithDates.txt&#39;</span>
            
            
        <span class="c1">#export tweetCountByUser</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCount&#39;</span><span class="p">):</span>
            
            <span class="n">total_tweets</span> <span class="o">=</span> <span class="mi">0</span>    
            <span class="n">total_retweets</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_replies</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([{</span><span class="s2">&quot;$match&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;retweeted_text&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ne&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span> <span class="p">}},</span> 
                                                           <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;seq_agg&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_agg&quot;</span><span class="p">},</span> 
                                                                       <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
            <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>   
                <span class="n">total_retweets</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>     


            <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;seq_agg&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_agg&quot;</span><span class="p">},</span> 
                                                                       <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
            <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>            
                <span class="n">total_tweets</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>


            <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([{</span><span class="s2">&quot;$match&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;in_reply_to_screen_name&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ne&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span> <span class="p">}},</span> 
                                                           <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;seq_agg&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_agg&quot;</span><span class="p">},</span> 
                                                                       <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
            <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>            
                <span class="n">total_replies</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>

            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;Total Original Tweets&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_tweets</span><span class="o">-</span><span class="n">total_retweets</span><span class="o">-</span><span class="n">total_replies</span><span class="p">)])</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;Total Replies&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_replies</span><span class="p">)])</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;Total Retweets&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_retweets</span><span class="p">)])</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;Total Tweets&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_tweets</span><span class="p">)])</span>

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCount.txt&#39;</span>
            
            
            
        <span class="c1">#export tweetCountByUser</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;userCount&#39;</span><span class="p">):</span>
                                   
            <span class="n">tweet_user_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">reply_user_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">quote_user_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">retweet_user_count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_users</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="s2">&quot;$user_type&quot;</span><span class="p">},</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
            <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>                   
                <span class="k">if</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;tweet&#39;</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">],</span> <span class="s1">&#39;Users with at least one document in this db&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="p">])</span>                                
                <span class="k">elif</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;retweet&#39;</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">],</span> <span class="s1">&#39;Users that were retweeted, but are not part of previous group&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="p">])</span>
                <span class="k">elif</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quote&#39;</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">],</span> <span class="s1">&#39;Users that were quoted, but are not part of previous groups&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="p">])</span>                
                <span class="k">elif</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reply&#39;</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">],</span> <span class="s1">&#39;Users that were replied to, but are not part of previous groups&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="p">])</span>
                <span class="k">elif</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mention&#39;</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">],</span> <span class="s1">&#39;Users that were mentioned, but are not part of previous groups&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="s2">&quot;user_type&quot;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span> <span class="p">])</span>    
            
            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;userCount.txt&#39;</span>
            
        

        <span class="c1">#export tweetCountByUser</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByUser&#39;</span><span class="p">):</span>

            <span class="c1">#set header of txt file</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_screen_name&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_tweetCountByUser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByUserAgg</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>        
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_tweetCountByUser</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;user_screen_name&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>        

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCountByUser.txt&#39;</span>
            
            

        
        <span class="c1">#export tweetCountByLanguage</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByLanguage&#39;</span><span class="p">):</span>

            <span class="c1">#set header of txt file</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;lang&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_tweetCountByLang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByLanguageAgg</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>        
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_tweetCountByLang</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">tweetCountByLanguage.txt&#39;</span>
            
                    

        
        <span class="c1">#export tweetCountByFile</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByFile&#39;</span><span class="p">):</span>

            <span class="c1">#set header of txt file</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;file_path&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_tweetCountByFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByFileAgg</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>        
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_tweetCountByFile</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>        

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCountByFile.txt&#39;</span>



        <span class="c1">#export tweetCountByMonth</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetCountByMonth&#39;</span><span class="p">):</span>

            <span class="c1">#set header of txt file</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month_no&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>   

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_tCountByPeriod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetCountByPeriodAgg</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>        
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_tCountByPeriod</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;month_no&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>         

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetCountByMonth.txt&#39;</span>        



        <span class="c1">#export hashtagCount</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;hashtagCount&#39;</span><span class="p">):</span> 

            <span class="c1">#set header of txt file</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;hashtag&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>            

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_hashtagCountByDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_hashTagCountAgg</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>        
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_hashtagCountByDay</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;hashtag&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]])</span>

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;hashtagCount.txt&#39;</span>


            
        <span class="c1">#export topics by hashtag</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;topicByHashtag&#39;</span><span class="p">):</span> 

            <span class="c1">#set header of txt file</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;ht&#39;</span><span class="p">,</span> <span class="s1">&#39;ht_count&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;no_words&#39;</span><span class="p">,</span> <span class="s1">&#39;topic_no&#39;</span><span class="p">,</span> <span class="s1">&#39;topic&#39;</span><span class="p">])</span>       

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_cHTTopics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_htTopics</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>        
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_cHTTopics</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ht&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ht_count&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span>  
                             <span class="n">x</span><span class="p">[</span><span class="s1">&#39;no_tweets&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;topic_no&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;topic&#39;</span><span class="p">]])</span>

            <span class="c1">#set file path</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;topicByHashtag.txt&#39;</span>


        <span class="c1">#export tweetTextAndPeriod</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetTextAndPeriod&#39;</span><span class="p">):</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>                

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_focusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">()</span> 
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_focusedTweet</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">inc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>                                                
                    <span class="bp">self</span><span class="o">.</span><span class="n">exportToFile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="c1">#export in array into txt file</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="n">inc</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetTextAndPeriod_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span> <span class="c1">#set file path</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;text_lower&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month_no&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">])</span>

                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;text_lower&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span>  
                             <span class="n">x</span><span class="p">[</span><span class="s1">&#39;month_no&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]])</span>

                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>
                
                
        <span class="c1">#export tweetDetails</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;tweetDetails&#39;</span><span class="p">):</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>                

            <span class="c1">#get data from database and loop through records and insert into array</span>
            <span class="n">select_focusedTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">()</span> 
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_focusedTweet</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">inc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>                                                
                    <span class="bp">self</span><span class="o">.</span><span class="n">exportToFile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="c1">#export in array into txt file</span>


                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="n">inc</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>                
                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;tweetTextAndPeriod_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span> <span class="c1">#set file path</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;text_lower&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month_no&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">])</span>

                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;text_lower&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span>
                             <span class="n">x</span><span class="p">[</span><span class="s1">&#39;month_no&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]])</span>

                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>   
                


        <span class="c1">#export words</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;wordsOnEachTweet&#39;</span><span class="p">):</span>  

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>                

            <span class="c1">#get data from database</span>
            <span class="n">select_tweetWords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweetWords</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">select_tweetWords</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">inc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>                                                
                    <span class="bp">self</span><span class="o">.</span><span class="n">exportToFile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="c1">#export in array into txt file                </span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="n">inc</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>                
                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;wordsOnEachTweet_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span> <span class="c1">#set file path</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;word_orig&#39;</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="s1">&#39;word_lower&#39;</span><span class="p">,</span> <span class="s1">&#39;word_tag&#39;</span><span class="p">,</span> <span class="s1">&#39;word_lemm&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;id_str&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;seq_no_tweet&#39;</span><span class="p">,</span> <span class="s1">&#39;seq_no&#39;</span><span class="p">])</span>


                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;word_orig&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;word_lower&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;word_tag&#39;</span><span class="p">],</span>  
                             <span class="n">x</span><span class="p">[</span><span class="s1">&#39;word_lemm&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;seq_no_tweet&#39;</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;seq_no&#39;</span><span class="p">]])</span>

                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>



        <span class="c1">#user details on Each Tweet</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exportType</span> <span class="o">==</span> <span class="s1">&#39;userDetailsOnEachTweet&#39;</span><span class="p">):</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>                

            <span class="c1">#get data from database</span>
            <span class="n">select_Tweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_Tweet</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">inc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>                                                
                    <span class="bp">self</span><span class="o">.</span><span class="n">exportToFile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="c1">#export in array into txt file                </span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="n">inc</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;userDetailsOnEachTweet_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span> <span class="c1">#set file path</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;id_str&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_location&#39;</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;user_screen_name&#39;</span><span class="p">,</span> <span class="s1">&#39;user_description&#39;</span><span class="p">,</span> <span class="s1">&#39;user_verified&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;user_followers_count&#39;</span><span class="p">,</span> <span class="s1">&#39;user_friends_count&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;user_statuses_count&#39;</span><span class="p">,</span> <span class="s1">&#39;user_created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;user_time_zone&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;user_lang&#39;</span><span class="p">,</span> <span class="s1">&#39;user_geo_enabled&#39;</span><span class="p">])</span>


                <span class="c1">#get relevant information from tweet</span>
                <span class="n">id_str</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span> 
                <span class="n">user_id</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
                <span class="n">user_location</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
                <span class="n">user_name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">user_screen_name</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
                <span class="n">user_description</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>                                
                <span class="n">user_verified</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;verified&#39;</span><span class="p">]</span>
                <span class="n">user_followers_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;followers_count&#39;</span><span class="p">]</span>
                <span class="n">user_friends_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;friends_count&#39;</span><span class="p">]</span>
                <span class="n">user_statuses_count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;statuses_count&#39;</span><span class="p">]</span>
                <span class="n">user_created_at</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
                <span class="n">user_time_zone</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;time_zone&#39;</span><span class="p">]</span>
                <span class="n">user_lang</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span>        
                <span class="n">user_geo_enabled</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;geo_enabled&#39;</span><span class="p">]</span>        

                <span class="k">if</span> <span class="n">user_description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>            
                    <span class="n">user_description</span> <span class="o">=</span> <span class="n">user_description</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">user_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>            
                    <span class="n">user_location</span> <span class="o">=</span> <span class="n">user_location</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">user_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>        
                    <span class="n">user_name</span> <span class="o">=</span> <span class="n">user_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">user_screen_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">user_screen_name</span> <span class="o">=</span> <span class="n">user_screen_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>


                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">id_str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user_location</span><span class="p">,</span> <span class="n">user_name</span><span class="p">,</span> <span class="n">user_screen_name</span><span class="p">,</span> 
                            <span class="n">user_description</span><span class="p">,</span> <span class="n">user_verified</span><span class="p">,</span> <span class="n">user_followers_count</span><span class="p">,</span> 
                            <span class="n">user_friends_count</span><span class="p">,</span> <span class="n">user_statuses_count</span><span class="p">,</span> 
                            <span class="n">user_created_at</span><span class="p">,</span> <span class="n">user_time_zone</span><span class="p">,</span> <span class="n">user_lang</span><span class="p">,</span> <span class="n">user_geo_enabled</span><span class="p">])</span>  

                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>    

        <span class="c1">#export in array into txt file</span>
        <span class="c1">#self.exportToFile(arr, file)</span>
        <span class="k">return</span> <span class="n">arr</span><span class="p">,</span> <span class="n">file</span></div>
    
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: exportToFile</span>
    <span class="c1"># Description: Method used to export an array to a t\ delimited file</span>
    <span class="c1"># Parameters: arrData = the array with the data you want to export</span>
    <span class="c1"># file = the path and name of the file you want to export</span>
    <span class="k">def</span> <span class="nf">exportToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrData</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>         
        
        <span class="n">myFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">myFile</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">myFile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">arrData</span><span class="p">)</span>
                                    
        
    
    
    <span class="c1">######### Topic Analysis ###############################################</span>
    <span class="c1"># *This was just an initital analysis. refer to pyTwitterTopics for more.</span>
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: get_docs</span>
    <span class="c1"># Description: create one array with all tweets of one hashtag for topic analysis</span>
    <span class="k">def</span> <span class="nf">get_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">max_doc_ctn</span><span class="p">):</span>    
        
        <span class="n">ctn</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">topic_doc_complete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_focusedTweet</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;hashtags.ht_lower&quot;</span> <span class="p">:</span> <span class="n">ht</span> <span class="p">})</span> 
        <span class="c1">#loop through tweets</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>     
            <span class="k">if</span> <span class="n">ctn</span> <span class="o">&lt;</span> <span class="n">max_doc_ctn</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;text_lower&#39;</span><span class="p">]</span>
                <span class="n">topic_doc_complete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="n">ctn</span><span class="o">=</span><span class="n">ctn</span><span class="o">+</span><span class="mi">1</span>    
            
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: clean_1</span>
    <span class="c1"># Description: clean documents for topic analysis</span>
    <span class="k">def</span> <span class="nf">clean_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span> 
        <span class="n">stop_free</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop</span><span class="p">])</span>
        <span class="n">punc_free</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">stop_free</span> <span class="k">if</span> <span class="n">ch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lemma</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">punc_free</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">normalized</span>
    
    
    <span class="c1">#topic analysis using gensim model </span>
    <span class="k">def</span> <span class="nf">gensim_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">num_topics_lsi</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>

        <span class="kn">import</span> <span class="nn">gensim</span>
        <span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span>

        <span class="n">doc_clean</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_1</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">topic_doc_complete</span><span class="p">]</span>   

        <span class="c1"># Creating the term dictionary of our courpus, where every unique term is assigned an index. dictionary = corpora.Dictionary(doc_clean)</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">doc_clean</span><span class="p">)</span>            

        <span class="c1"># Converting list of documents (corpus) into Document Term Matrix using dictionary prepared above.</span>
        <span class="n">doc_term_matrix</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_clean</span><span class="p">]</span>

        <span class="c1"># Creating the object for LDA model using gensim library</span>
        <span class="n">Lda</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ldamodel</span><span class="o">.</span><span class="n">LdaModel</span>    

        <span class="c1"># Build the LDA model</span>
        <span class="n">lda_model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="n">doc_term_matrix</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>    

        <span class="c1"># Build the LSI model</span>
        <span class="n">lsi_model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">LsiModel</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="n">doc_term_matrix</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="n">num_topics_lsi</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>    


        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>     
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_topics_lda</span><span class="p">):</span>                
            <span class="n">topic</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">strtopic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;ht_count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;lib&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;gensim&quot;</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;model&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;lda&quot;</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">strtopic</span> <span class="o">+</span> \
                    <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lda_model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">num_topics_lda</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>



        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_topics_lsi</span><span class="p">):</span>        
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;ht_count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;lib&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;gensim&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;model&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;lsi&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>\
                <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lsi_model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">num_topics_lsi</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">c_htTopics</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>        
        

            
    <span class="c1">#topic analysis using sklearn model </span>
    <span class="k">def</span> <span class="nf">skl_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">num_topics_lsi</span><span class="p">,</span> <span class="n">num_topics_nmf</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>    

        <span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span><span class="o">=</span><span class="mf">0.009</span><span class="p">,</span> <span class="n">max_df</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">lowercase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">token_pattern</span><span class="o">=</span><span class="s1">&#39;[a-zA-Z\-][a-zA-Z\-]{2,}&#39;</span><span class="p">)</span>

        <span class="n">data_vectorized</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">topic_doc_complete</span><span class="p">)</span>

        <span class="c1"># Build a Latent Dirichlet Allocation Model</span>
        <span class="n">lda_model</span> <span class="o">=</span> <span class="n">LatentDirichletAllocation</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">learning_method</span><span class="o">=</span><span class="s1">&#39;online&#39;</span><span class="p">,</span><span class="n">learning_offset</span><span class="o">=</span><span class="mf">50.</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lda_Z</span> <span class="o">=</span> <span class="n">lda_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_vectorized</span><span class="p">)</span>

        <span class="c1"># Build a Non-Negative Matrix Factorization Model</span>
        <span class="n">nmf_model</span> <span class="o">=</span> <span class="n">NMF</span><span class="p">(</span><span class="n">num_topics_nmf</span><span class="p">)</span>
        <span class="n">nmf_Z</span> <span class="o">=</span> <span class="n">nmf_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_vectorized</span><span class="p">)</span>

        <span class="c1"># Build a Latent Semantic Indexing Model</span>
        <span class="n">lsi_model</span> <span class="o">=</span> <span class="n">TruncatedSVD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lsi_Z</span> <span class="o">=</span> <span class="n">lsi_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_vectorized</span><span class="p">)</span>


        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lda_model</span><span class="o">.</span><span class="n">components_</span><span class="p">):</span>  
            <span class="n">topic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">([(</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span> <span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topic</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="o">-</span><span class="n">num_topics_lda</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;ht_count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tc</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;lib&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;sklearn&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;model&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;lda&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>\
                <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">topic</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>



        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lsi_model</span><span class="o">.</span><span class="n">components_</span><span class="p">):</span>  
            <span class="n">topic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">([(</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span> <span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topic</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="o">-</span><span class="n">num_topics_lsi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;ht_count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tc</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;lib&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;sklearn&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;model&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;lsi&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>\
                <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">topic</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>




        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nmf_model</span><span class="o">.</span><span class="n">components_</span><span class="p">):</span>  
            <span class="n">topic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">([(</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topic</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="o">-</span><span class="n">num_topics_nmf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;ht&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;ht_count&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">tc</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;lib&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;sklearn&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;model&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;nmf&quot;</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>\
                <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">topic</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>        


        <span class="bp">self</span><span class="o">.</span><span class="n">c_htTopics</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>            
        
        

    <span class="c1">#find topics for each hashtag  </span>
    <span class="k">def</span> <span class="nf">findTopics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">num_topics_lsi</span><span class="p">,</span> <span class="n">num_topics_nmf</span><span class="p">,</span> <span class="n">max_no_tweets_perHT</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

        <span class="n">starttime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;loading process started....&quot;</span> <span class="o">+</span> <span class="n">starttime</span><span class="p">)</span>
        
        <span class="c1">#find all hashtag and their count</span>
        <span class="n">select_cHashtagCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_hashTagCountAgg</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#loop through hashtags</span>
            <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span>  <span class="n">select_cHashtagCount</span><span class="p">:</span> 

                <span class="n">ht</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;hashtag&#39;</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">tweet</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">ht</span> <span class="o">!=</span> <span class="s2">&quot;metoo&quot;</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>                                

                    <span class="c1">#get all tweets for that hashtag</span>
                    <span class="n">topic_doc_complete</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_docs</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">max_no_tweets_perHT</span><span class="p">)</span> 

                    <span class="c1">#run topic models</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;gensim&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">gensim_model</span><span class="p">(</span><span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">num_topics_lsi</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>        
                        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;sklearn&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">skl_model</span><span class="p">(</span><span class="n">num_topics_lda</span><span class="p">,</span> <span class="n">num_topics_lsi</span><span class="p">,</span> <span class="n">num_topics_nmf</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>                 
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                                      
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error finding topics for hashtag &quot;</span> <span class="o">+</span> <span class="n">ht</span> <span class="o">+</span> <span class="s2">&quot;, using model &quot;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span><span class="s2">&quot;. Err msg: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
                        <span class="k">continue</span>  
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error finding topics. Err msg: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>             
                    

        <span class="n">endtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;loading process completed. &quot;</span> <span class="o">+</span> <span class="n">endtime</span><span class="p">)</span>
        
     
    <span class="c1"># search7dayapi</span>
<div class="viewcode-block" id="TwitterDB.search7dayapi"><a class="viewcode-back" href="../generated/ta.TwitterDB.search7dayapi.html#ta.TwitterDB.search7dayapi">[docs]</a>    <span class="k">def</span> <span class="nf">search7dayapi</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">consumer_key</span><span class="p">,</span> 
            <span class="n">consumer_secret</span><span class="p">,</span> 
            <span class="n">access_token</span><span class="p">,</span> 
            <span class="n">access_token_secret</span><span class="p">,</span> 
            <span class="n">query</span><span class="p">,</span> 
            <span class="n">result_type</span><span class="o">=</span> <span class="s1">&#39;mixed&#39;</span><span class="p">,</span> 
            <span class="n">max_count</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> 
            <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send requests to the 7-Day search API and save data into MongoDB</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        consumer_key : </span>
<span class="sd">            User&#39;s consumer key               </span>
<span class="sd">            </span>
<span class="sd">        consumer_secret :</span>
<span class="sd">            User&#39;s consumer secret</span>
<span class="sd">        </span>
<span class="sd">        access_token : </span>
<span class="sd">            User&#39;s access token</span>

<span class="sd">        access_token_secret : </span>
<span class="sd">            User&#39;s access token secret</span>

<span class="sd">        query :</span>
<span class="sd">            The query that will be used to filter the tweets</span>
<span class="sd">            </span>
<span class="sd">        result_type : </span>
<span class="sd">            Options: recent, popular, or mixed</span>
<span class="sd">            </span>
<span class="sd">        max_count : </span>
<span class="sd">            The number of tweets to be returned at a time</span>
<span class="sd">            </span>
<span class="sd">        lang :     </span>
<span class="sd">            Language to filter the tweets</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response </span>
<span class="sd">            the response received from Twitter, which will contain either the tweets retrieved from the search, or the error message if any      </span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                  </span>
<span class="sd">            &gt;&gt;&gt; # send request to 7-day search API</span>
<span class="sd">            &gt;&gt;&gt; response = myAnalysisObj.search7dayapi(</span>
<span class="sd">            &gt;&gt;&gt;     consumer_key = &#39;[key]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     consumer_secret = &#39;[secret]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     access_token = &#39;[token]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     access_token_secret = &#39;[token_secret]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     query = &#39;austintexas OR atx OR austintx OR atxlife&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     result_type = &#39;mixed&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     max_count = &#39;100&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     lang = &#39;en&#39;)    </span>
<span class="sd">        &quot;&quot;&quot;</span>       
        
        
        <span class="n">aut</span> <span class="o">=</span> <span class="n">OAuth1</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
        
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/search/tweets.json?q=&#39;</span> <span class="o">+</span> <span class="n">query</span> <span class="o">+</span> <span class="s1">&#39;&amp;count=&#39;</span> <span class="o">+</span> <span class="n">max_count</span> <span class="o">+</span> <span class="s1">&#39;&amp;lang=&#39;</span> <span class="o">+</span> <span class="n">lang</span> <span class="o">+</span> <span class="s1">&#39;&amp;include_entities=true&amp;tweet_mode=extended&amp;result_type=&#39;</span> <span class="o">+</span> <span class="n">result_type</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">aut</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>        
        
        <span class="c1"># if there was an error, print error and end method</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>            
            <span class="nb">print</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        
        <span class="n">tweets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="s1">&#39;search_metadata&#39;</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;search_metadata&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="p">{}</span>
            
        <span class="c1"># insert tweets into DB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insertTweetToDBFromAPI</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="s1">&#39;statuses&#39;</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="s1">&#39;7day&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">response</span></div>
    
    
    
    <span class="c1"># searchPremiumAPI</span>
<div class="viewcode-block" id="TwitterDB.searchPremiumAPI"><a class="viewcode-back" href="../generated/ta.TwitterDB.searchPremiumAPI.html#ta.TwitterDB.searchPremiumAPI">[docs]</a>    <span class="k">def</span> <span class="nf">searchPremiumAPI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">twitter_bearer</span><span class="p">,</span> 
            <span class="n">api_name</span><span class="p">,</span> 
            <span class="n">dev_environment</span><span class="p">,</span>
            <span class="n">query</span><span class="p">,</span> 
            <span class="n">date_start</span><span class="p">,</span> 
            <span class="n">date_end</span><span class="p">,</span> 
            <span class="n">next_token</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">max_count</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">):</span>
            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send requests to the Premium search API and save data into MongoDB</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------               </span>
<span class="sd">        twitter_bearer : </span>
<span class="sd">            bearer authentication token created from the consumer_key and consumer_secret</span>
<span class="sd">        </span>
<span class="sd">        api_name :</span>
<span class="sd">            the options are either 30day or FullArchive</span>
<span class="sd">        </span>
<span class="sd">        dev_environment :</span>
<span class="sd">            the name of the environment created on the Twitter&#39;s developer account</span>
<span class="sd">        </span>
<span class="sd">        query :</span>
<span class="sd">            the query that will be used to filter the tweets</span>
<span class="sd">            </span>
<span class="sd">        date_start : </span>
<span class="sd">            the start date that will be used to filter the tweets.</span>
<span class="sd">        </span>
<span class="sd">        date_end :            </span>
<span class="sd">            the end date that will be used to filter the tweets.</span>
<span class="sd">            </span>
<span class="sd">        next_token :             </span>
<span class="sd">            then token that points to the previous search done with the same query.</span>
<span class="sd">            </span>
<span class="sd">        max_count : </span>
<span class="sd">            the number of tweets to be returned at a time</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response </span>
<span class="sd">            the response received from Twitter, which will contain either the tweets retrieved from the search, or the error message if any      </span>
<span class="sd">        </span>
<span class="sd">        next_token</span>
<span class="sd">            token value that can be used for the next request, that way it is possible to avoid searches for the same records</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                  </span>
<span class="sd">            &gt;&gt;&gt; # send request to premium API</span>
<span class="sd">            &gt;&gt;&gt; response, next_token = myAnalysisObj.searchPremiumAPI(</span>
<span class="sd">            &gt;&gt;&gt;     twitter_bearer = &#39;[bearer]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     api_name = &#39;30day&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     dev_environment = &#39;myDevEnv.json&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     query = &#39;(coronavirus OR COVID19) lang:en&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     date_start = &#39;202002150000&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     date_end = &#39;202002160000&#39;,</span>
<span class="sd">            &gt;&gt;&gt;     next_token = None,</span>
<span class="sd">            &gt;&gt;&gt;     max_count = &#39;100&#39;</span>
<span class="sd">            &gt;&gt;&gt; )   </span>
<span class="sd">        &quot;&quot;&quot;</span>              
        
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span><span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">twitter_bearer</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>  
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://api.twitter.com/1.1/tweets/search/&quot;</span> <span class="o">+</span> <span class="n">api_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">dev_environment</span>
      
        <span class="k">if</span> <span class="n">next_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;query&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">query</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;fromDate&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">date_start</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;toDate&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">date_end</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;maxResults&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">max_count</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;query&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">query</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;fromDate&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">date_start</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;toDate&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">date_end</span> <span class="o">+</span><span class="s1">&#39;&quot;, &quot;next&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">next_token</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;maxResults&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">max_count</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
            
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="c1"># if there was an error, print error and end method</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>            
            <span class="nb">print</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    
        <span class="c1"># load tweets into a json variable</span>
        <span class="n">tweets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span> 
                
        <span class="c1">#Get &quot;next&quot;token</span>
        <span class="k">if</span> <span class="s1">&#39;next&#39;</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
            <span class="n">next_token</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;next&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>            

        <span class="c1"># save what information was used for this search</span>
        <span class="n">search</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;next&#39;</span><span class="p">:</span> <span class="n">next_token</span><span class="p">}</span>                
        <span class="n">search</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>                
            
        <span class="c1"># insert tweets into DB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insertTweetToDBFromAPI</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">api_name</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">next_token</span></div>

            
    <span class="c1"># insertTweetToDB</span>
    <span class="k">def</span> <span class="nf">insertTweetToDBFromAPI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tweets</span><span class="p">,</span> <span class="n">parent_field</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">api</span><span class="p">):</span>
         
        <span class="n">seq_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">select_cTweet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span> <span class="p">[{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;seq_agg&quot;</span> <span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;$max&quot;</span><span class="p">:</span> <span class="s2">&quot;$seq_no&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
        <span class="k">for</span> <span class="n">tweetCount</span> <span class="ow">in</span> <span class="n">select_cTweet</span><span class="p">:</span>
            <span class="n">seq_no</span> <span class="o">=</span> <span class="n">tweetCount</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
    
        <span class="k">if</span> <span class="n">parent_field</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
            
            <span class="c1">#Insert into searches table</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;search_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span> <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="n">api</span><span class="p">}</span>                
            <span class="n">search</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>            
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_searches</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>

            <span class="c1">#Insert into tblTweet table</span>
            <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">[</span><span class="n">parent_field</span><span class="p">]:</span>

                <span class="n">seq_no</span> <span class="o">=</span> <span class="n">seq_no</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1">#adding extra fields to document to suport future logic (processed_fl, load_time, file_path )</span>
                <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;processed_fl&#39;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;seq_no&#39;</span><span class="p">:</span> <span class="n">seq_no</span><span class="p">,</span> <span class="s1">&#39;seq_agg&#39;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s1">&#39;load_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)}</span>                
                <span class="n">tweet</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tweet</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> 
                    
                    

    <span class="c1"># create python script and .bat file for scheduled processing</span>
<div class="viewcode-block" id="TwitterDB.create_bat_file_apisearch"><a class="viewcode-back" href="../generated/ta.TwitterDB.create_bat_file_apisearch.html#ta.TwitterDB.create_bat_file_apisearch">[docs]</a>    <span class="k">def</span> <span class="nf">create_bat_file_apisearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">mongoDBServer</span><span class="p">,</span>
            <span class="n">mongoDBName</span><span class="p">,</span>
            <span class="n">file_path</span><span class="p">,</span>
            <span class="n">python_path</span><span class="p">,</span>
            <span class="n">consumer_key</span><span class="p">,</span>
            <span class="n">consumer_secret</span><span class="p">,</span>
            <span class="n">access_token</span><span class="p">,</span>
            <span class="n">access_token_secret</span><span class="p">,</span>
            <span class="n">query</span><span class="p">,</span>
            <span class="n">result_type</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> 
            <span class="n">max_count</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span>
            <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">):</span>
            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The method will create two files, one python script containing the code necessary to make the requests, </span>
<span class="sd">        and a *.bat* file that can be used to schedule the call of the python script.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------  </span>
<span class="sd">        mongoDBServer :</span>
<span class="sd">            the mongoDB server that will be used to save the tweets</span>
<span class="sd">        </span>
<span class="sd">        mongoDBName :</span>
<span class="sd">            the mongoDB name that will be used to save the tweets</span>
<span class="sd">        </span>
<span class="sd">        file_path :</span>
<span class="sd">            the folder path where the files will be saved</span>
<span class="sd">        </span>
<span class="sd">        python_path :        </span>
<span class="sd">            the path where the python.exe is installed</span>
<span class="sd">            </span>
<span class="sd">        consumer_key : </span>
<span class="sd">            User&#39;s consumer key               </span>
<span class="sd">            </span>
<span class="sd">        consumer_secret :</span>
<span class="sd">            User&#39;s consumer secret</span>
<span class="sd">        </span>
<span class="sd">        access_token : </span>
<span class="sd">            User&#39;s access token</span>

<span class="sd">        access_token_secret : </span>
<span class="sd">            User&#39;s access token secret</span>

<span class="sd">        query :</span>
<span class="sd">            The query that will be used to filter the tweets</span>
<span class="sd">            </span>
<span class="sd">        result_type : </span>
<span class="sd">            Options: recent, popular, or mixed</span>
<span class="sd">            </span>
<span class="sd">        max_count : </span>
<span class="sd">            The number of tweets to be returned at a time</span>
<span class="sd">            </span>
<span class="sd">        lang :     </span>
<span class="sd">            Language to filter the tweets                  </span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------                  </span>
<span class="sd">            &gt;&gt;&gt; create python script and .bat file for scheduled processing</span>
<span class="sd">            &gt;&gt;&gt; create_bat_file_apisearch( </span>
<span class="sd">            &gt;&gt;&gt;         mongoDBServer=&#39;mongodb://localhost:27017&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         mongoDBName=&#39;myDBName&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         file_path=&#39;C:\\Data\\myScriptsFolder\\MyScriptName.py&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         python_path=&#39;C:\\Users\\Me\Anaconda3\envs\myEnv\python.exe&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         consumer_key = &#39;[key]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         consumer_secret = &#39;[secret]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;          access_token = &#39;[token]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         access_token_secret = &#39;[token_secret]&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         query = &#39;austintexas OR atx OR austintx OR atxlife&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         result_type = &#39;mixed&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         max_count = &#39;100&#39;,</span>
<span class="sd">            &gt;&gt;&gt;         lang = &#39;en&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
    
        <span class="c1"># create path is does not exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                        
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>        
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;import json</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;import requests</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;from pymongo import MongoClient</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;from requests_oauthlib import OAuth1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;import datetime</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mongoDBServer = &#39;&quot;</span> <span class="o">+</span> <span class="n">mongoDBServer</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;client = MongoClient(mongoDBServer)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;db = client.&quot;</span> <span class="o">+</span> <span class="n">mongoDBName</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Create unique index on tweet table to make sure we don&#39;t store duplicate tweets</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;try:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    resp = self.c_tweet.create_index([(&#39;id&#39;, pymongo.ASCENDING)],unique = True)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;except:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    pass</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>        
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;aut = OAuth1(&quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">consumer_key</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>  <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">consumer_secret</span>  <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>  <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">access_token</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>  <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">access_token_secret</span>  <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/search/tweets.json?q=&#39;</span> <span class="o">+</span> <span class="n">query</span> <span class="o">+</span> <span class="s1">&#39;&amp;count=&#39;</span> <span class="o">+</span> <span class="n">max_count</span> <span class="o">+</span> <span class="s1">&#39;&amp;lang=&#39;</span> <span class="o">+</span> <span class="n">lang</span> <span class="o">+</span> <span class="s1">&#39;&amp;include_entities=true&amp;tweet_mode=extended&amp;result_type=&#39;</span> <span class="o">+</span> <span class="n">result_type</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;endpoint = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;response = requests.get(endpoint, auth=aut).json()&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# if there was an error, print error and end method</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;if &#39;error&#39; in response:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    print (response)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;tweets = json.loads(json.dumps(response, indent = 2))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;search = tweets[&#39;search_metadata&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>       
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;seq_no = 0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;select_cTweet = db.tweet.aggregate( [{&#39;$group&#39;: {&#39;_id&#39;: &#39;seq_agg&#39; , &#39;count&#39;: { &#39;$max&#39;: &#39;$seq_no&#39; } } } ])</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;for tweetCount in select_cTweet:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    seq_no = tweetCount[&#39;count&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;if &#39;statuses&#39; in tweets:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    #Insert into searches table</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    a_dict = {&#39;search_time&#39;: datetime.datetime.now().strftime(&#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;), &#39;api&#39;: &#39;7day&#39;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    search.update(a_dict)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>   
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    result = db.searches.insert_one(search)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    #Insert into tblTweet table</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    for tweet in tweets[&#39;statuses&#39;]:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        seq_no = seq_no + 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        #adding extra fields to document to suport future logic (processed_fl, load_time, file_path )</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        a_dict = {&#39;processed_fl&#39;: &#39;N&#39;, &#39;seq_no&#39;: seq_no, &#39;seq_agg&#39;: &#39;A&#39;, &#39;load_time&#39;: datetime.datetime.now().strftime(&#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;)}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        tweet.update(a_dict)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        try:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;            result = db.tweet.insert_one(tweet)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        except:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;            result = &#39;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">python_path</span><span class="p">)</span>
        <span class="n">fbat</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">twitter_request_script.bat&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>        
        <span class="n">fbat</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;start &#39;</span> <span class="o">+</span> <span class="n">python_path</span> <span class="o">+</span> <span class="s1">&#39; &quot;&#39;</span> <span class="o">+</span> <span class="n">file_path</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>               
        <span class="n">fbat</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">community</span> <span class="k">as</span> <span class="nn">community_louvain</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">networkx</span> <span class="kn">import</span> <span class="n">algorithms</span>
<span class="kn">from</span> <span class="nn">networkx.algorithms</span> <span class="kn">import</span> <span class="n">distance_measures</span>
<span class="kn">from</span> <span class="nn">networkx.algorithms.components</span> <span class="kn">import</span> <span class="n">is_connected</span>
<span class="kn">from</span> <span class="nn">networkx.algorithms.dominance</span>  <span class="kn">import</span> <span class="n">immediate_dominators</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">SpectralClustering</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csgraph</span>
<span class="kn">import</span> <span class="nn">scipy.cluster.vq</span> <span class="k">as</span> <span class="nn">vq</span>
<span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">as</span> <span class="nn">SLA</span>
    
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    
    
<span class="k">class</span> <span class="nc">TwitterGraphs</span><span class="p">:</span>   

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
        
        <span class="c1">#creates path if does not exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder_path</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_details_file</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">log_graph_plots.txt&quot;</span>
        
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_details_file</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;graph_name</span><span class="se">\t</span><span class="s1"> scale</span><span class="se">\t</span><span class="s1"> k</span><span class="se">\t</span><span class="s1"> iteration</span><span class="se">\t</span><span class="s1"> kmeans_k</span><span class="se">\t</span><span class="s1"> starttime</span><span class="se">\t</span><span class="s1"> endtime</span><span class="se">\t</span><span class="s1">&#39;</span>  <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            

    <span class="c1">#####################################</span>
    <span class="c1"># Method: loadGraphFromFile</span>
    <span class="c1"># Description: method receives nodes and edges files and returns an nwtworkx </span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   -nodes_file = file path and file name for netwrok nodes</span>
    <span class="c1">#   -edge_file = file path and file name for netwrok edges with weight</span>
<div class="viewcode-block" id="TwitterGraphs.loadGraphFromFile"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.loadGraphFromFile.html#ta.TwitterGraphs.loadGraphFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadGraphFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_file</span><span class="p">):</span>
        
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_edgelist</span><span class="p">(</span><span class="n">edge_file</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),))</span>

        <span class="k">return</span> <span class="n">G</span></div>

        
    <span class="c1"># function to plot network graph</span>
    <span class="c1"># Parameters: G - NetworkX graph</span>
    <span class="c1">#             v_graph_name - The name of your graph</span>
    <span class="c1">#             v_scale - Scale factor for positions. The nodes are positioned in a box of size [0,scale] x [0,scale].</span>
    <span class="c1">#             v_k - Optimal distance between nodes - Increase this value to move nodes farther apart.</span>
    <span class="c1">#             v_iterations - Number of iterations of spring-force relaxation</span>
    <span class="c1">#             cluster_fl - determines if you are sending labels for clusters or not</span>
    <span class="c1">#             v_labels - cluster labels</span>
    <span class="c1">#             kmeans_k - k_means k used for clustering</span>
    <span class="c1">#             node_color - node color, default &#39;#A0CBE2&#39;</span>
    <span class="c1">#             edge_color - edge color, default &#39;#A79894&#39;</span>
    <span class="c1">#             width - with, default 0.05</span>
    <span class="c1">#             node_size - node size, default 0.6</span>
    <span class="c1">#             font_size - font size, default 1</span>
    <span class="c1">#             dpi - size of the image in dpi, default 800</span>
    <span class="c1"># More details at: https://networkx.github.io/documentation/networkx-1.9/reference/generated/networkx.drawing.layout.spring_layout.html</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def plotSpringLayoutGraph(self, G, v_graph_name, v_scale, v_k, v_iterations, </span>
<span class="sd">                              cluster_fl=&#39;N&#39;, v_labels=None, kmeans_k=&#39;&#39;, v_node_color=&#39;#A0CBE2&#39;, v_edge_color=&#39;#A79894&#39;, </span>
<span class="sd">                              v_width=0.05, v_node_size=0.6, v_font_size=1, v_dpi=900):</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
        

    <span class="c1">#####################################</span>
    <span class="c1"># Method: plot_graph_att_distr</span>
    <span class="c1"># Description: Plot distribution of nodes based on graph attribute (e.g. communitiy)</span>
<div class="viewcode-block" id="TwitterGraphs.plot_graph_att_distr"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.plot_graph_att_distr.html#ta.TwitterGraphs.plot_graph_att_distr">[docs]</a>    <span class="k">def</span> <span class="nf">plot_graph_att_distr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Community Counts&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Community ID&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1">#create dataframe based on the given attribute</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">att</span><span class="p">),</span>  <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">att</span><span class="p">]</span> 
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;node&#39;</span> <span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">att</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1">#if file name was give, save file in default folder</span>
        <span class="k">if</span> <span class="n">file_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span></div>
        

        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: plot_disconnected_graph_distr</span>
    <span class="c1"># Description: plot the distribution of disconnected graphs</span>
<div class="viewcode-block" id="TwitterGraphs.plot_disconnected_graph_distr"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.plot_disconnected_graph_distr.html#ta.TwitterGraphs.plot_disconnected_graph_distr">[docs]</a>    <span class="k">def</span> <span class="nf">plot_disconnected_graph_distr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size_cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
        <span class="n">sub_conn_graphs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_component_subgraphs</span><span class="p">(</span><span class="n">G</span><span class="p">)),</span> <span class="n">key</span> <span class="o">=</span> <span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">size_cutoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub_conn_graphs2</span> <span class="o">=</span> <span class="n">sub_conn_graphs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">sub_conn_graphs</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sub_conn_graphs2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">size_cutoff</span><span class="p">:</span>
                    <span class="n">sub_conn_graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                
                
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sub_conn_graphs</span><span class="p">):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">edges</span><span class="p">()))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;All subgraphs&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Excluding top1&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Excluding top2&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Excluding top3&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Excluding top4&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Excluding top5&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: could not plot all 6  - &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">pass</span> 
        
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Nodes&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Edges&#39;</span><span class="p">)</span>
            
        <span class="c1">#if file name was give, save file in default folder</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span>
        
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_conn_graphs</span><span class="p">)</span></div>

    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: contract_nodes_commty_per</span>
    <span class="c1"># Description: reduce graph based on a percentage given for each community found</span>
<div class="viewcode-block" id="TwitterGraphs.contract_nodes_commty_per"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.contract_nodes_commty_per.html#ta.TwitterGraphs.contract_nodes_commty_per">[docs]</a>    <span class="k">def</span> <span class="nf">contract_nodes_commty_per</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">G</span><span class="p">,</span> 
            <span class="n">perc</span><span class="p">,</span> 
            <span class="n">comm_att</span><span class="o">=</span><span class="s1">&#39;community_louvain&#39;</span><span class="p">,</span> 
            <span class="n">enforce_ext_nodes_conn_fl</span> <span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> 
            <span class="n">commty_already_calculated</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>

        <span class="n">G_to_contract</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>        
        <span class="n">all_nodes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#if we need to calculate the communities because the original report doesn&#39;t have the community labels</span>
        <span class="k">if</span> <span class="n">commty_already_calculated</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
            <span class="n">G_to_contract</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_louvain_clustering</span><span class="p">(</span><span class="n">G_to_contract</span><span class="p">)</span>


        <span class="c1">#find the number of communities in the graph</span>
        <span class="n">no_of_comm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G_to_contract</span><span class="p">,</span> <span class="n">comm_att</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>    

        <span class="c1">#loop through the communities and get the top nodes for each communities based on the given percentage</span>
        <span class="k">for</span> <span class="n">commty</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_of_comm</span><span class="p">):</span>

            <span class="c1">#find subgraphs of this community</span>
            <span class="n">com_sub_graph</span> <span class="o">=</span> <span class="n">G_to_contract</span><span class="o">.</span><span class="n">subgraph</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">attrdict</span> <span class="ow">in</span> <span class="n">G_to_contract</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attrdict</span> <span class="p">[</span><span class="n">comm_att</span><span class="p">]</span> <span class="o">==</span> <span class="n">commty</span> <span class="p">])</span>
            <span class="n">arr_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">com_sub_graph</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

            <span class="c1">#get the comunity size and calculate how many top nodes we want to use based on the given percentage</span>
            <span class="n">comm_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">com_sub_graph</span><span class="p">)</span>        
            <span class="n">top_nodes</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">comm_size</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">perc</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">top_nodes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">top_nodes</span><span class="o">=</span><span class="n">top_nodes</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">arr_top_nodes</span> <span class="o">=</span> <span class="n">arr_nodes</span><span class="p">[:</span><span class="n">top_nodes</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">enforce_ext_nodes_conn_fl</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="c1">#create subgraph including external edges</span>
                <span class="n">G_W_Ext_Edges</span> <span class="o">=</span> <span class="n">G_to_analyze</span><span class="o">.</span><span class="n">edge_subgraph</span><span class="p">(</span><span class="n">G_to_analyze</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">com_sub_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span>    
                <span class="c1">#find the nodes in this community with external edges</span>
                <span class="n">G_edges_Rem</span> <span class="o">=</span> <span class="n">G_W_Ext_Edges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">G_edges_Rem</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">com_sub_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
                <span class="n">nodes_w_ext_edges</span> <span class="o">=</span> <span class="n">G_edges_Rem</span><span class="o">.</span><span class="n">edge_subgraph</span><span class="p">(</span><span class="n">G_edges_Rem</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>                            
                <span class="n">arr_top_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">arr_top_nodes</span><span class="p">,</span> <span class="n">nodes_w_ext_edges</span><span class="p">))</span>

            <span class="n">all_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">all_nodes</span><span class="p">,</span> <span class="n">arr_top_nodes</span><span class="p">))</span>

        <span class="c1">#Create graph with only the contracted nodes</span>
        <span class="n">G_Contracted</span> <span class="o">=</span> <span class="n">G_to_contract</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">)</span>
        <span class="n">G_Contracted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_component_no_self_loops</span><span class="p">(</span><span class="n">G_Contracted</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">G_Contracted</span></div>


    <span class="c1">#####################################</span>
    <span class="c1"># Method: draw_scaled_labels</span>
    <span class="c1"># Description: draw labels in the graphs</span>
    <span class="k">def</span> <span class="nf">draw_labels_for_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>  
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="c1">#set the node name as the key and the label as its value </span>
                <span class="n">labels</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>


    <span class="c1">#####################################</span>
    <span class="c1"># Method: draw_scaled_labels</span>
    <span class="c1"># Description: draw labels in the graph scaled by node degree</span>
    <span class="k">def</span> <span class="nf">draw_scaled_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">default_font_size</span><span class="p">,</span> <span class="n">font_size_multiplier</span><span class="p">):</span>
        <span class="c1">#get array of nodes in sorted order</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>    
        <span class="c1">#get the value of the highest degree. We will use this as reference to calculate the fonte sizes</span>
        <span class="n">top_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">nodes_with_same_font_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>    

            <span class="c1">#calculate the font size for this node</span>
            <span class="n">size_scale</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">top_value</span>
            <span class="n">new_font_size</span> <span class="o">=</span> <span class="n">size_scale</span><span class="o">*</span><span class="n">font_size_multiplier</span>

            <span class="c1">#if the calculate font size is greater than the parameter give, print that label. If not add to the array of nodes with the default size.</span>
            <span class="k">if</span> <span class="n">new_font_size</span> <span class="o">&gt;</span> <span class="n">default_font_size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_labels_for_node</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">new_font_size</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodes_with_same_font_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1">#Print labels for all nodes with the default size.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_labels_for_node</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">nodes_with_same_font_size</span><span class="p">,</span> <span class="n">default_font_size</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>


    <span class="c1">#####################################</span>
    <span class="c1"># Method: plotSpringLayoutGraph</span>
    <span class="c1"># Description: plot graph</span>
<div class="viewcode-block" id="TwitterGraphs.plotSpringLayoutGraph"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.plotSpringLayoutGraph.html#ta.TwitterGraphs.plotSpringLayoutGraph">[docs]</a>    <span class="k">def</span> <span class="nf">plotSpringLayoutGraph</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">G</span><span class="p">,</span>  
            <span class="n">v_graph_name</span><span class="p">,</span>  
            <span class="n">v_scale</span><span class="p">,</span>  
            <span class="n">v_k</span><span class="p">,</span>  
            <span class="n">v_iterations</span><span class="p">,</span> 
            <span class="n">cluster_fl</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>  
            <span class="n">v_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
            <span class="n">kmeans_k</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  
            <span class="n">v_node_color</span><span class="o">=</span><span class="s1">&#39;#A0CBE2&#39;</span><span class="p">,</span>  
            <span class="n">v_edge_color</span><span class="o">=</span><span class="s1">&#39;#A79894&#39;</span><span class="p">,</span> 
            <span class="n">v_width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>  
            <span class="n">v_node_size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  
            <span class="n">v_font_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>  
            <span class="n">v_dpi</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>  
            <span class="n">v_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  
            <span class="n">v_linewidths</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
            <span class="n">scale_node_size_fl</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>  
            <span class="n">draw_in_mult_steps_fl</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>  
            <span class="n">node_size_multiplier</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>  
            <span class="n">font_size_multiplier</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> 
            <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>


        <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">v_graph_name</span><span class="p">):</span>
            
            <span class="n">v_with_labels</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">scale_node_size_fl</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
                <span class="n">v_node_size</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span> <span class="o">*</span> <span class="n">node_size_multiplier</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                <span class="n">v_with_labels</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1">#node_color=v_labels,</span>
            <span class="c1">#node_color=v_node_color,</span>
            <span class="c1">#draw graph</span>
            <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">v_scale</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">v_k</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="n">v_iterations</span><span class="p">)</span>   <span class="c1">#G is my graph</span>
            <span class="k">if</span> <span class="n">cluster_fl</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>                    
                <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>                 
                        <span class="n">width</span><span class="o">=</span><span class="n">v_width</span><span class="p">,</span>                          
                        <span class="n">edge_color</span><span class="o">=</span><span class="n">v_edge_color</span><span class="p">,</span>
                        <span class="n">node_color</span><span class="o">=</span><span class="n">v_node_color</span><span class="p">,</span>
                        <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> 
                        <span class="n">with_labels</span><span class="o">=</span><span class="n">v_with_labels</span><span class="p">,</span> 
                        <span class="n">node_size</span><span class="o">=</span><span class="n">v_node_size</span><span class="p">,</span> 
                        <span class="n">font_size</span><span class="o">=</span><span class="n">v_font_size</span><span class="p">,</span>                  
                        <span class="n">linewidths</span><span class="o">=</span><span class="n">v_linewidths</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">v_alpha</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>         
                <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
                        <span class="n">node_color</span><span class="o">=</span><span class="n">v_labels</span><span class="p">,</span>
                        <span class="n">edge_color</span><span class="o">=</span><span class="n">v_edge_color</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="n">v_width</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span>
                        <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Purples</span><span class="p">,</span>
                        <span class="n">with_labels</span><span class="o">=</span><span class="n">v_with_labels</span><span class="p">,</span>
                        <span class="n">node_size</span><span class="o">=</span><span class="n">v_node_size</span><span class="p">,</span>
                        <span class="n">font_size</span><span class="o">=</span><span class="n">v_font_size</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="n">v_linewidths</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">v_alpha</span><span class="p">)</span>


            <span class="c1"># draw labels - logic to print labels in nodes in case we </span>
            <span class="c1"># want to change the font size to match the scale of the node size</span>
            <span class="k">if</span> <span class="n">scale_node_size_fl</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_scaled_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">v_font_size</span><span class="p">,</span> <span class="n">font_size_multiplier</span><span class="p">)</span>           


            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">v_graph_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">v_dpi</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span></div>
   


        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: largest_component_no_self_loops</span>
    <span class="c1"># Description: remove self loops nodes, isolate nodes and exclude smaller components</span>
<div class="viewcode-block" id="TwitterGraphs.largest_component_no_self_loops"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.largest_component_no_self_loops.html#ta.TwitterGraphs.largest_component_no_self_loops">[docs]</a>    <span class="k">def</span> <span class="nf">largest_component_no_self_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>           
                
        <span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="n">G2</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">G2</span><span class="p">))</span>    
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">isolates</span><span class="p">(</span><span class="n">G2</span><span class="p">)):</span>
            <span class="n">G2</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
         
        <span class="n">graphs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_component_subgraphs</span><span class="p">(</span><span class="n">G2</span><span class="p">)),</span> <span class="n">key</span> <span class="o">=</span> <span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">#G = max(nx.connected_components(G), key=len)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graphs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">G2</span></div>
        
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: export_nodes_edges_to_file</span>
    <span class="c1"># Description: export nodes and edges of a graph into a file</span>
<div class="viewcode-block" id="TwitterGraphs.export_nodes_edges_to_file"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.export_nodes_edges_to_file.html#ta.TwitterGraphs.export_nodes_edges_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">export_nodes_edges_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">node_f_name</span><span class="p">,</span> <span class="n">edge_f_name</span><span class="p">):</span>
                        
        <span class="n">nx</span><span class="o">.</span><span class="n">write_edgelist</span><span class="p">(</span><span class="n">G</span><span class="p">,</span>  <span class="n">edge_f_name</span><span class="p">)</span>               
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">node_f_name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span></div>
        
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: create_node_subgraph</span>
    <span class="c1"># Description: creates a subgraph for one node. </span>
    <span class="c1"># subgraph contains all nodes connected to that node and their edges to each other</span>
<div class="viewcode-block" id="TwitterGraphs.create_node_subgraph"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.create_node_subgraph.html#ta.TwitterGraphs.create_node_subgraph">[docs]</a>    <span class="k">def</span> <span class="nf">create_node_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">G_subgraph_edges</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">G_subgraph_edges</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">edge_subgraph</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="n">G_subgraph</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">G_subgraph_edges</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        
        <span class="k">return</span> <span class="n">G_subgraph</span></div>
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: get_top_degree_nodes</span>
    <span class="c1"># Description: returns a array of the top degree nodes based on parameter passed by user    </span>
<div class="viewcode-block" id="TwitterGraphs.get_top_degree_nodes"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.get_top_degree_nodes.html#ta.TwitterGraphs.get_top_degree_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_degree_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">top_degree_start</span><span class="p">,</span> <span class="n">top_degree_end</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))[</span><span class="n">top_degree_start</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">top_degree_end</span><span class="p">]</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_spectral_clustering_labels</span>
    <span class="c1"># Description: calculate cluster labels for a graph</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_spectral_clustering_labels"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_spectral_clustering_labels.html#ta.TwitterGraphs.calculate_spectral_clustering_labels">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_spectral_clustering_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">affinity</span> <span class="o">=</span> <span class="s1">&#39;precomputed&#39;</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="c1">#adj_mat = nx.to_numpy_matrix(G)</span>
        <span class="n">adj_mat</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">to_scipy_sparse_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>        
        <span class="n">sc</span> <span class="o">=</span> <span class="n">SpectralClustering</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">affinity</span><span class="o">=</span><span class="n">affinity</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="n">n_init</span><span class="p">)</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">adj_mat</span><span class="p">)</span>
               
        <span class="k">return</span>  <span class="n">sc</span><span class="o">.</span><span class="n">labels_</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_spectral_clustering</span>
    <span class="c1"># Description: calculate cluster labels for a graph</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_spectral_clustering"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_spectral_clustering.html#ta.TwitterGraphs.calculate_spectral_clustering">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_spectral_clustering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">affinity</span> <span class="o">=</span> <span class="s1">&#39;precomputed&#39;</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        
        <span class="c1">#calculate adjacent matrix</span>
        <span class="n">adj_mat</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">to_scipy_sparse_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>  
        
        <span class="c1">#get number of clusters if None was given</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nb_clusters</span><span class="p">,</span> <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenDecomposition</span><span class="p">(</span><span class="n">adj_mat</span><span class="p">)</span>            
            <span class="n">k</span> <span class="o">=</span> <span class="n">nb_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
              
        <span class="c1">#calculate spectral clustering labels</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">SpectralClustering</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">affinity</span><span class="o">=</span><span class="n">affinity</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="n">n_init</span><span class="p">)</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">adj_mat</span><span class="p">)</span>
        
        <span class="c1">#update graph with the communitites</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">sc</span><span class="o">.</span><span class="n">labels_</span><span class="p">))</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">dic</span><span class="p">,</span> <span class="s1">&#39;community_spectral&#39;</span><span class="p">)</span>        
               
        <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">labels_</span><span class="p">),</span> <span class="n">k</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_louvain_clustering</span>
    <span class="c1"># Description: calculate cluster labels for a graph using community_louvain</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_louvain_clustering"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_louvain_clustering.html#ta.TwitterGraphs.calculate_louvain_clustering">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_louvain_clustering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
        
        <span class="c1"># compute the best partition</span>
        <span class="n">partition</span> <span class="o">=</span> <span class="n">community_louvain</span><span class="o">.</span><span class="n">best_partition</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

        <span class="c1">#get number of clusters</span>
        <span class="n">partition_arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">partition</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">partition_arr_no_dups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">partition_arr</span><span class="p">))</span> 
        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition_arr_no_dups</span><span class="p">)</span> <span class="c1">#number of clusters</span>

        <span class="c1">#update graph with the communitites</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">partition</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">dic</span><span class="p">,</span> <span class="s1">&#39;community_louvain&#39;</span><span class="p">)</span>
               
        <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">partition</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">k</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_separability</span>
    <span class="c1"># Description: calculates the separability score for a community</span>
    <span class="c1"># Parameters:</span>
    <span class="c1">#   -G_Community: the subgraph with of nodes that belong to the same commty</span>
    <span class="c1">#   -G_All: The entire graph</span>
    <span class="c1">#   -dens: separability score</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_separability"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_separability.html#ta.TwitterGraphs.calculate_separability">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_separability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G_Community</span><span class="p">,</span> <span class="n">G_All</span><span class="p">):</span>            
        
        <span class="c1"># #of edges for that community - (internal nodes)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span>
        
        <span class="c1"># #of edges edges pointing outside of the community - (external nodes)        </span>
        <span class="n">cs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_All</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span> <span class="o">-</span> <span class="n">ms</span>
        
        <span class="c1"># ratio between internal and external nodes</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">ms</span><span class="o">/</span><span class="n">cs</span>
        
        <span class="k">return</span> <span class="n">sep</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_density</span>
    <span class="c1"># Description: calculates the density score for a community</span>
    <span class="c1"># Parameters:</span>
    <span class="c1">#   -G_Community: the subgraph with of nodes that belong to the same commty    </span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   -dens: density score</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_density"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_density.html#ta.TwitterGraphs.calculate_density">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G_Community</span><span class="p">):</span>            
        
        <span class="c1"># #of edges for that community </span>
        <span class="n">ms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
        
        <span class="c1"># #of nodes for that community </span>
        <span class="n">ns</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        
        <span class="c1"># fraction of the edges that appear between the nodes in G_Community</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">/</span> <span class="p">(</span><span class="n">ns</span> <span class="o">*</span> <span class="p">(</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">dens</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_average_clustering_coef</span>
    <span class="c1"># Description: calculates the average clustering coefficient of a graph</span>
    <span class="c1"># Parameters:</span>
    <span class="c1">#   -G_Community: the subgraph with of nodes that belong to the same commty    </span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   -acc: the average clustering coefficient</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_average_clustering_coef"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_average_clustering_coef.html#ta.TwitterGraphs.calculate_average_clustering_coef">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_average_clustering_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G_Community</span><span class="p">):</span>
        
        <span class="c1"># calculates the average clustering coefficient number</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">average_clustering</span><span class="p">(</span><span class="n">G_Community</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">acc</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_cliques</span>
    <span class="c1"># Description: calculates the clique number of the graph and </span>
    <span class="c1"># the number of maximal cliques in the graph.</span>
    <span class="c1"># Parameters:</span>
    <span class="c1">#   -G_Community: the subgraph with of nodes that belong to the same commty    </span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   -gcn: the clique number of the graph</span>
    <span class="c1">#   -nofc: the number of maximal cliques in the graph</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_cliques"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_cliques.html#ta.TwitterGraphs.calculate_cliques">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_cliques</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
        
        <span class="n">gcn</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">graph_clique_number</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="n">nofc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">graph_number_of_cliques</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gcn</span><span class="p">,</span> <span class="n">nofc</span></div>
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_power_nodes_score</span>
    <span class="c1"># Description: calculates power nodes score    </span>
    <span class="c1"># This is to calculate how many of the total nodes </span>
    <span class="c1"># in graph are connected to a few top degree nodes</span>
    <span class="c1"># Parameters:</span>
    <span class="c1">#   -G: the graph to analyze</span>
    <span class="c1">#   -top_no: top number of nodes you want to analyze</span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   -pns: power nodes score    </span>
    <span class="c1">#         1 means that all other nodes in the graph </span>
    <span class="c1">#         are connected to the top nodes</span>
<div class="viewcode-block" id="TwitterGraphs.calculate_power_nodes_score"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_power_nodes_score.html#ta.TwitterGraphs.calculate_power_nodes_score">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_power_nodes_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">top_no</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>

        <span class="c1"># number of nodes of the original graph</span>
        <span class="n">no_of_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>                

        <span class="c1"># get the top 3 high degree nodes</span>
        <span class="n">arr_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_top_degree_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">top_no</span><span class="p">)):</span>
            <span class="n">arr_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
        <span class="c1"># creates a subgrpah of all nodes conencted to the top nodes</span>
        <span class="n">sub_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_node_subgraph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">arr_nodes</span><span class="p">)</span>
        
        <span class="c1"># number of nodes of the sub-graph of top nodes</span>
        <span class="n">no_of_nodes_sub_graph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> 
        
        <span class="c1"># calculates the ratio between the two.        </span>
        <span class="n">pns</span> <span class="o">=</span> <span class="n">no_of_nodes_sub_graph</span> <span class="o">/</span> <span class="n">no_of_nodes</span>

        <span class="k">return</span> <span class="n">pns</span></div>
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: calculate_average_node_degree</span>
    <span class="c1"># Description: calculates the average of the degree of all nodes        </span>
    <span class="c1"># Parameters:</span>
    <span class="c1">#   -G: the graph to analyze    </span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   -deg_mean: the mean </span>
<div class="viewcode-block" id="TwitterGraphs.calculate_average_node_degree"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.calculate_average_node_degree.html#ta.TwitterGraphs.calculate_average_node_degree">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_average_node_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
        
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>                
        <span class="n">deg_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">deg_mean</span></div>

    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: print_cluster_metrics</span>
    <span class="c1"># Description: print cluster graphs metrics</span>
<div class="viewcode-block" id="TwitterGraphs.print_cluster_metrics"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.print_cluster_metrics.html#ta.TwitterGraphs.print_cluster_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">print_cluster_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G_Community</span><span class="p">,</span> <span class="n">G_All</span><span class="p">,</span> <span class="n">top_no</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">acc_node_size_cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
        <span class="k">if</span> <span class="n">acc_node_size_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">acc_node_size_cutoff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of Nodes: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of Edges: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">edges</span><span class="p">())))</span>
        
        <span class="n">deg_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_average_node_degree</span><span class="p">(</span><span class="n">G_Community</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Node Degree: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deg_mean</span><span class="p">)</span>  <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
        
        <span class="n">sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_separability</span><span class="p">(</span><span class="n">G_Community</span><span class="p">,</span> <span class="n">G_All</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Separability: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
        
        <span class="n">den</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_density</span><span class="p">(</span><span class="n">G_Community</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Density: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
                            
        <span class="k">if</span> <span class="n">acc_node_size_cutoff</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_Community</span><span class="o">.</span><span class="n">nodes</span><span class="p">()):</span>
            <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_average_clustering_coef</span><span class="p">(</span><span class="n">G_Community</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Clustering Coefficient: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Clustering Coefficient: &quot;</span> <span class="o">+</span> <span class="s2">&quot; (**more nodes than the cutoff number)&quot;</span><span class="p">)</span>
                
        <span class="n">gcn</span><span class="p">,</span> <span class="n">nofc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_cliques</span><span class="p">(</span><span class="n">G_Community</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clique number: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gcn</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of maximal cliques: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nofc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
                
        <span class="n">pns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_power_nodes_score</span><span class="p">(</span><span class="n">G_Community</span><span class="p">,</span> <span class="n">top_no</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Power Nodes Score: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pns</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span></div>
        


    <span class="c1">#####################################</span>
    <span class="c1"># Method: eigenDecomposition</span>
    <span class="c1"># Description: This method performs the eigen decomposition on a given affinity matrix</span>
    <span class="c1"># Re-used code from https://github.com/ciortanmadalina/high_noise_clustering</span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   -af_matrix = Affinity matrix</span>
    <span class="c1">#    -bln_plot = flag to determine if we should plot the sorted eigen values for visual inspection or not</span>
    <span class="c1">#    -topK = number of suggestions as the optimal number of of clusters</span>
    <span class="c1"># Returns: </span>
    <span class="c1">#   -nb_clusters = the optimal number of clusters by eigengap heuristic</span>
    <span class="c1">#   -eigenvalues = all eigen values</span>
    <span class="c1">#   -eigenvectors = all eigen vectors</span>
<div class="viewcode-block" id="TwitterGraphs.eigenDecomposition"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.eigenDecomposition.html#ta.TwitterGraphs.eigenDecomposition">[docs]</a>    <span class="k">def</span> <span class="nf">eigenDecomposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">af_matrix</span><span class="p">,</span> <span class="n">bln_plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">topK</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>       
        
        <span class="c1">#construct the laplacian of the matrix</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">csgraph</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">af_matrix</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">n_components</span> <span class="o">=</span> <span class="n">af_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># LM parameter : Eigenvalues with largest magnitude (eigs, eigsh), that is, largest eigenvalues in </span>
        <span class="c1"># the euclidean norm of complex numbers.</span>
        <span class="c1">#eigenvalues, eigenvectors = sp.sparse.linalg.eigs(L)</span>
        <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">SLA</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s1">&#39;LM&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bln_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Largest eigen values of input matrix&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)),</span> <span class="n">eigenvalues</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="c1"># Identify the optimal number of clusters as the index corresponding</span>
        <span class="c1"># to the larger gap between eigen values</span>
        <span class="n">index_largest_gap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">topK</span><span class="p">]</span>
        <span class="n">nb_clusters</span> <span class="o">=</span> <span class="n">index_largest_gap</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">nb_clusters</span><span class="p">,</span> <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span></div>

    


    
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: remove_edges</span>
    <span class="c1"># Description: removes edges of nodes with less than the given degree. </span>
    <span class="c1"># (both nodes in the edge must be less than the given degree for us to remove the edge)</span>
<div class="viewcode-block" id="TwitterGraphs.remove_edges"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.remove_edges.html#ta.TwitterGraphs.remove_edges">[docs]</a>    <span class="k">def</span> <span class="nf">remove_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">min_degree_no</span><span class="p">):</span>
        
        <span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>        
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">()):</span>
            <span class="n">degree_node_from</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">degree_node_to</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">degree_node_from</span> <span class="o">&lt;</span> <span class="n">min_degree_no</span> <span class="ow">and</span> <span class="n">degree_node_to</span> <span class="o">&lt;</span> <span class="n">min_degree_no</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span><span class="mi">1</span>
                <span class="n">G2</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; edges removed&#39;</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">G2</span>    </div>
    
    

    <span class="c1">#####################################</span>
    <span class="c1"># Method: remove_edges_eithernode</span>
    <span class="c1"># Description: removes edges of nodes with less than the given degree. </span>
    <span class="c1"># (both nodes in the edge must be less than the given degree for us to remove the edge)</span>
<div class="viewcode-block" id="TwitterGraphs.remove_edges_eithernode"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.remove_edges_eithernode.html#ta.TwitterGraphs.remove_edges_eithernode">[docs]</a>    <span class="k">def</span> <span class="nf">remove_edges_eithernode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">min_degree_no</span><span class="p">):</span>
        
        <span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">edges</span><span class="p">()):</span>
            <span class="n">degree_node_from</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">degree_node_to</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">degree_node_from</span> <span class="o">&lt;</span> <span class="n">min_degree_no</span> <span class="ow">or</span> <span class="n">degree_node_to</span> <span class="o">&lt;</span> <span class="n">min_degree_no</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span><span class="mi">1</span>
                <span class="n">G2</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; edges removed&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">G2</span>       </div>
    
    
    
    <span class="c1">#####################################</span>
    <span class="c1"># Method: contract_nodes_degree1</span>
    <span class="c1"># Description: Contract nodes degree 1 in groups of the given number</span>
    <span class="k">def</span> <span class="nf">contract_nodes_degree1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">n_to_group</span><span class="p">):</span>    
        
        <span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    
        <span class="n">degree_to_contract</span> <span class="o">=</span> <span class="mi">1</span>                 
        
        <span class="k">for</span> <span class="n">node_degree</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>    
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">node_degree</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">D</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_degree</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">this_node_subgraph</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>


                <span class="c1">##################### degree1</span>
                <span class="n">nodes_degree1</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">this_node_subgraph</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span> <span class="k">if</span> <span class="n">degree</span> <span class="o">==</span> <span class="n">degree_to_contract</span><span class="p">]</span>
                <span class="n">subgraph_degree1</span> <span class="o">=</span> <span class="n">this_node_subgraph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">nodes_degree1</span><span class="p">)</span>

                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_to_group</span><span class="o">/</span><span class="p">(</span><span class="n">degree_to_contract</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">subgraph_degree1</span><span class="p">):</span>                           
                    <span class="k">if</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span><span class="o">%</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">first_node</span> <span class="o">=</span> <span class="n">node</span>
                    <span class="k">else</span><span class="p">:</span>        
                        <span class="n">G2</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">contracted_nodes</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">first_node</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">self_loops</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>                                                                             

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>        
                <span class="k">continue</span>
          

        <span class="k">return</span> <span class="n">G2</span>    
    
        
    <span class="c1">#####################################</span>
    <span class="c1"># Method: print_Measures</span>
    <span class="c1"># Description: print Graph measures to the screen and to a file </span>
<div class="viewcode-block" id="TwitterGraphs.print_Measures"><a class="viewcode-back" href="../generated/ta.TwitterGraphs.print_Measures.html#ta.TwitterGraphs.print_Measures">[docs]</a>    <span class="k">def</span> <span class="nf">print_Measures</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">G</span><span class="p">,</span> 
            <span class="n">blnCalculateDimater</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">blnCalculateRadius</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
            <span class="n">blnCalculateExtremaBounding</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">blnCalculateCenterNodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">fileName_to_print</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        
        <span class="c1">#verify if graph is connected or not</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blnGraphConnected</span> <span class="o">=</span>  <span class="n">is_connected</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">blnGraphConnected</span> <span class="o">=</span> <span class="kc">False</span>
            
        
        <span class="n">no_nodes</span> <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span>
        <span class="n">no_edges</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Nodes: &quot;</span> <span class="o">+</span> <span class="n">no_nodes</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Edges: &quot;</span> <span class="o">+</span> <span class="n">no_edges</span><span class="p">)</span>
        
        
        <span class="c1">#Calculate and print Diameter </span>
        <span class="k">if</span> <span class="n">blnCalculateDimater</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blnGraphConnected</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">diameter_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">distance_measures</span><span class="o">.</span><span class="n">diameter</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Diameter: &quot;</span> <span class="o">+</span> <span class="n">diameter_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diameter_value</span> <span class="o">=</span> <span class="s2">&quot;Not possible to calculate diameter. Graph must be connected&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">diameter_value</span><span class="p">)</span>
                
        <span class="c1">#Calculate and print Radius </span>
        <span class="k">if</span> <span class="n">blnCalculateRadius</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blnGraphConnected</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">radius_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">distance_measures</span><span class="o">.</span><span class="n">radius</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Radius: &quot;</span> <span class="o">+</span> <span class="n">radius_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">radius_value</span> <span class="o">=</span> <span class="s2">&quot;Not possible to calculate radius. Graph must be connected&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">radius_value</span><span class="p">)</span>        
        
        <span class="c1">#Calculate and print Extrema bounding </span>
        <span class="k">if</span> <span class="n">blnCalculateExtremaBounding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blnGraphConnected</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">extrema_bounding_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">distance_measures</span><span class="o">.</span><span class="n">extrema_bounding</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extrema bounding: &quot;</span> <span class="o">+</span> <span class="n">extrema_bounding_value</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extrema_bounding_value</span> <span class="o">=</span> <span class="s2">&quot;Not possible to calculate Extrema bounding. Graph must be connected&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">extrema_bounding_value</span><span class="p">)</span>
        
        <span class="c1">#Calculate and print Centers</span>
        <span class="k">if</span> <span class="n">blnCalculateCenterNodes</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">str_centers_nodes</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">blnGraphConnected</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">centers_nodes</span> <span class="o">=</span> <span class="n">distance_measures</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>    
                <span class="n">str_centers_nodes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">centers_nodes</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Centers with their degree: &quot;</span> <span class="o">+</span> <span class="n">str_centers_nodes</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">centers_nodes</span> <span class="o">=</span> <span class="s2">&quot;Not possible to calculate Centers. Graph must be connected&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">centers_nodes</span><span class="p">)</span>


        <span class="c1"># if file name is passed in the parameters, we save the measures into a file</span>
        <span class="k">if</span> <span class="n">fileName_to_print</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#creates path if does not exists</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName_to_print</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName_to_print</span><span class="p">))</span>
                        
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName_to_print</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Nodes: &quot;</span> <span class="o">+</span> <span class="n">no_nodes</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Edges: &quot;</span> <span class="o">+</span> <span class="n">no_edges</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">blnCalculateDimater</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Diameter: &quot;</span> <span class="o">+</span> <span class="n">diameter_value</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blnCalculateRadius</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Radius: &quot;</span> <span class="o">+</span> <span class="n">radius_value</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1">#if blnCalculateBaryCenter == True:</span>
            <span class="c1">#    f.write(&quot;Bary Center: &quot; + barycenter_node + &quot;\n&quot;)        </span>
            <span class="k">if</span> <span class="n">blnCalculateExtremaBounding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Extrema bounding: &quot;</span> <span class="o">+</span> <span class="n">extrema_bounding_value</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blnCalculateCenterNodes</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Centers with their degree: &quot;</span> <span class="o">+</span> <span class="n">str_centers_nodes</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">gensim</span>
<span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span>
<span class="kn">from</span> <span class="nn">gensim.models.coherencemodel</span> <span class="kn">import</span> <span class="n">CoherenceModel</span>

<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">words</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">,</span> <span class="n">wordnet</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">RegexpTokenizer</span>
<span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">PorterStemmer</span><span class="p">,</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">pos_tag</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span><span class="p">,</span> <span class="n">ImageColorGenerator</span>

<span class="c1">#dictionary_words = dict.fromkeys(words.words(), None)</span>
   
<span class="c1">#stopWords = set(stopwords.words(&#39;english&#39;))</span>
<span class="c1">#tokenizer = RegexpTokenizer(r&#39;\w+&#39;)</span>

<span class="c1">#stemmer = PorterStemmer()</span>
<span class="c1">#lemmatiser = WordNetLemmatizer()</span>

<span class="n">stop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
<span class="n">stop</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
<span class="n">stop</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span> 
<span class="n">lemma</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>

<span class="c1">#topic_doc_complete = []</span>
<span class="c1">#lda_model = &quot;&quot;</span>


<span class="k">class</span> <span class="nc">TwitterTopics</span><span class="p">:</span>   

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">mongoDB_database</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder_path</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_u_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_c_v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_u_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_c_v</span> <span class="o">=</span> <span class="mi">0</span>          
        
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">mongoDB_database</span>
        <span class="k">if</span> <span class="n">mongoDB_database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">topics</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_topics</span> <span class="o">=</span> <span class="kc">None</span>
                
        
    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">=</span> <span class="kc">None</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_u_mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_c_v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_u_mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_c_v</span> <span class="o">=</span> <span class="kc">None</span>
                

<div class="viewcode-block" id="TwitterTopics.get_coh_u_mass"><a class="viewcode-back" href="../generated/ta.TwitterTopics.get_coh_u_mass.html#ta.TwitterTopics.get_coh_u_mass">[docs]</a>    <span class="k">def</span> <span class="nf">get_coh_u_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_u_mass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_u_mass</span></div>
    
<div class="viewcode-block" id="TwitterTopics.get_coh_c_v"><a class="viewcode-back" href="../generated/ta.TwitterTopics.get_coh_c_v.html#ta.TwitterTopics.get_coh_c_v">[docs]</a>    <span class="k">def</span> <span class="nf">get_coh_c_v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_c_v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_c_v</span></div>
    

    <span class="c1">#create one array with all tweets of one hashtag for topic analysis</span>
<div class="viewcode-block" id="TwitterTopics.get_docs_from_file"><a class="viewcode-back" href="../generated/ta.TwitterTopics.get_docs_from_file.html#ta.TwitterTopics.get_docs_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_docs_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>

        <span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>                            
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>        
                <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">docs</span></div>


    <span class="c1">#clean documents for topic analysis</span>
<div class="viewcode-block" id="TwitterTopics.clean_docs"><a class="viewcode-back" href="../generated/ta.TwitterTopics.clean_docs.html#ta.TwitterTopics.clean_docs">[docs]</a>    <span class="k">def</span> <span class="nf">clean_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">delete_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delete_stop_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lemmatize_words</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> 
        
        <span class="n">doc_clean</span> <span class="o">=</span> <span class="n">doc</span>
        
        <span class="k">if</span> <span class="n">delete_numbers</span> <span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">doc_clean</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">delete_stop_words</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">doc_clean</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">doc_clean</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop</span><span class="p">])</span>
        
        <span class="n">doc_clean</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">doc_clean</span> <span class="k">if</span> <span class="n">ch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">lemmatize_words</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">doc_clean</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lemma</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">doc_clean</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">doc_clean</span></div>
        

    <span class="c1">#train model</span>
<div class="viewcode-block" id="TwitterTopics.train_model"><a class="viewcode-back" href="../generated/ta.TwitterTopics.train_model.html#ta.TwitterTopics.train_model">[docs]</a>    <span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_docs</span><span class="p">,</span> <span class="n">num_topics</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">blnSaveinDB</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blnSaveTrainedModelFiles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">txtFileName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lda_num_of_iterations</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">delete_stop_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lemmatize_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delete_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="c1">#starttime = datetime.datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)</span>
        <span class="c1">#print(&quot;Executing train_model... Started at: &quot; + starttime )        </span>

        <span class="n">doc_clean</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_docs</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">delete_numbers</span><span class="p">,</span> <span class="n">delete_stop_words</span><span class="p">,</span> <span class="n">lemmatize_words</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">topic_docs</span><span class="p">]</span>

        <span class="c1"># Creating the term dictionary of our corpus, where every unique term is assigned an index. dictionary = corpora.Dictionary(doc_clean)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">doc_clean</span><span class="p">)</span>

        <span class="c1"># Converting list of documents (corpus) into Document Term Matrix using dictionary prepared above.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_clean</span><span class="p">]</span>

        <span class="c1"># Creating the object for LDA model using gensim library</span>
        <span class="n">Lda</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ldamodel</span><span class="o">.</span><span class="n">LdaModel</span>

        
        <span class="n">file_data</span> <span class="o">=</span> <span class="p">[]</span>        
        
        <span class="k">if</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;lda&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
            <span class="c1"># Build the LDA model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="n">num_topics</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="n">lda_num_of_iterations</span><span class="p">)</span>                            
            <span class="c1">#get LDA coherence</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_u_mass</span> <span class="o">=</span> <span class="n">CoherenceModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">coherence</span><span class="o">=</span><span class="s1">&#39;u_mass&#39;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_c_v</span> <span class="o">=</span> <span class="n">CoherenceModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span><span class="p">,</span> <span class="n">texts</span><span class="o">=</span><span class="n">doc_clean</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">coherence</span><span class="o">=</span><span class="s1">&#39;c_v&#39;</span><span class="p">)</span>
            
            <span class="c1">#create json file with lda results</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_topics</span><span class="p">):</span>                
                <span class="n">topic</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">strtopic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;model_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;model_type&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s1">&#39;lda&#39;</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;timestamp&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">topic_docs</span><span class="p">))</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;coh_u_mass&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_u_mass</span><span class="o">.</span><span class="n">get_coherence</span><span class="p">())</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;coh_c_v&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lda_coh_c_v</span><span class="o">.</span><span class="n">get_coherence</span><span class="p">())</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">strtopic</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">num_topics</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
                
        <span class="k">if</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;lsi&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
            <span class="c1"># Build the LSI model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">LsiModel</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="n">num_topics</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">)</span>    
            <span class="c1">#get LSI coherence</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_u_mass</span> <span class="o">=</span> <span class="n">CoherenceModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_term_matrix</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">coherence</span><span class="o">=</span><span class="s1">&#39;u_mass&#39;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_c_v</span> <span class="o">=</span> <span class="n">CoherenceModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span><span class="p">,</span> <span class="n">texts</span><span class="o">=</span><span class="n">doc_clean</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">coherence</span><span class="o">=</span><span class="s1">&#39;c_v&#39;</span><span class="p">)</span>
        
            <span class="c1">#create json file with lsi results</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_topics</span><span class="p">):</span>
                <span class="n">topic</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">strtopic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;model_name&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;model_type&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="s1">&#39;lsi&#39;</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;timestamp&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;no_tweets&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">topic_docs</span><span class="p">))</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;coh_u_mass&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_u_mass</span><span class="o">.</span><span class="n">get_coherence</span><span class="p">())</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;coh_c_v&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsi_coh_c_v</span><span class="o">.</span><span class="n">get_coherence</span><span class="p">())</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;topic_no&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="n">strtopic</span> <span class="o">+</span> \
                        <span class="s1">&#39;&quot;, &quot;topic&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">num_topics</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">file_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


        <span class="c1"># Save if mongoDB collection is asked</span>
        <span class="k">if</span> <span class="n">blnSaveinDB</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c_topics</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t save topics in db. No mongoDB connection was set up.&quot;</span><span class="p">)</span>
                    
        <span class="c1"># Save results in a text file</span>
        <span class="k">if</span> <span class="n">txtFileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txtFileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file_data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    

            
            
        <span class="c1"># Save models into file</span>
        <span class="k">if</span> <span class="n">blnSaveTrainedModelFiles</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="c1">#creates path if does not exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/trained_models/&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/trained_models/&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/trained_models/&quot;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;_lda_model.model&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/trained_models/&quot;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;_dictionary.dict&quot;</span><span class="p">)</span></div>
        
        
        <span class="c1">#endtime = datetime.datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)</span>
        <span class="c1">#print(&quot;Finished executing train_model. Ended at: &quot; + endtime)</span>
    

    <span class="c1">#train model from file</span>
<div class="viewcode-block" id="TwitterTopics.train_model_from_file"><a class="viewcode-back" href="../generated/ta.TwitterTopics.train_model_from_file.html#ta.TwitterTopics.train_model_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">train_model_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">num_topics</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">blnSaveinDB</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blnSaveTrainedModelFiles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">txtFileName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lda_num_of_iterations</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">delete_stop_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lemmatize_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delete_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>        
        <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_docs_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_model</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">num_topics</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">blnSaveinDB</span><span class="p">,</span> <span class="n">blnSaveTrainedModelFiles</span><span class="p">,</span> <span class="n">txtFileName</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">lda_num_of_iterations</span><span class="p">,</span> <span class="n">delete_stop_words</span><span class="p">,</span> <span class="n">lemmatize_words</span><span class="p">,</span> <span class="n">delete_numbers</span><span class="p">)</span>        </div>
    
    
    
        
    
    <span class="c1">#plot graph with lda topics</span>
<div class="viewcode-block" id="TwitterTopics.plot_topics"><a class="viewcode-back" href="../generated/ta.TwitterTopics.plot_topics.html#ta.TwitterTopics.plot_topics">[docs]</a>    <span class="k">def</span> <span class="nf">plot_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">no_of_topics</span><span class="p">,</span> <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;lda&#39;</span><span class="p">,</span> <span class="n">fig_size_x</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span> <span class="n">fig_size_y</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        
        <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                
            <span class="n">fig_size_y</span> <span class="o">=</span> <span class="mi">7</span><span class="o">*</span><span class="p">(</span><span class="n">no_of_topics</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>        
            <span class="n">fiz</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_size_x</span><span class="p">,</span> <span class="n">fig_size_y</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_of_topics</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;lda&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lda_model</span><span class="o">.</span><span class="n">show_topic</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">,</span><span class="s1">&#39;prob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">)</span>        
                <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;lsi&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsi_model</span><span class="o">.</span><span class="n">show_topic</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">,</span><span class="s1">&#39;prob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">)</span>        

                <span class="n">no_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">no_of_topics</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">no_of_topics</span><span class="o">%</span><span class="mi">2</span>            
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">no_rows</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;topic &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cities&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Reds_d&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>

            <span class="c1">#save the file </span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

            <span class="c1">#plt.show()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span></div>
                

    
    <span class="c1"># read a frequency list into a pandas objects</span>
    <span class="c1"># file format word\tfrequency</span>
<div class="viewcode-block" id="TwitterTopics.read_freq_list_file"><a class="viewcode-back" href="../generated/ta.TwitterTopics.read_freq_list_file.html#ta.TwitterTopics.read_freq_list_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_freq_list_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="c1">#df = pd.read_csv(file_path, encoding = &quot;ISO-8859-1&quot;, header=None, sep=delimiter, lineterminator=&#39;\n&#39;)        </span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">df</span></div>
    
    
    <span class="c1">#plot a bar graph with the top frequency list</span>
<div class="viewcode-block" id="TwitterTopics.plot_top_freq_list"><a class="viewcode-back" href="../generated/ta.TwitterTopics.plot_top_freq_list.html#ta.TwitterTopics.plot_top_freq_list">[docs]</a>    <span class="k">def</span> <span class="nf">plot_top_freq_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fr_list</span><span class="p">,</span> <span class="n">top_no</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">exclude_top_no</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
                        
        <span class="k">if</span> <span class="n">exclude_top_no</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fr_list</span> <span class="o">=</span> <span class="n">fr_list</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">exclude_top_no</span><span class="p">:]</span>
        
        <span class="n">fr_list</span> <span class="o">=</span> <span class="n">fr_list</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">top_no</span><span class="p">,</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span>                            
        
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fr_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">top_no</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">int</span><span class="p">((</span><span class="n">top_no</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fr_list</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.5</span><span class="p">)):</span>
                
                <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">]</span>    
                <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])</span>  
                <span class="n">fr_list</span> <span class="o">=</span> <span class="n">fr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>            

        
        <span class="n">fr_list_gr</span> <span class="o">=</span> <span class="n">fr_list</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;word&quot;</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fr_list</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">))</span>                
        <span class="n">fr_list_gr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                
        <span class="c1">#plt.show()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span></div>
                
        
    
    <span class="c1">#plot a word cloudfor a frequency list</span>
<div class="viewcode-block" id="TwitterTopics.plot_word_cloud"><a class="viewcode-back" href="../generated/ta.TwitterTopics.plot_word_cloud.html#ta.TwitterTopics.plot_word_cloud">[docs]</a>    <span class="k">def</span> <span class="nf">plot_word_cloud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fr_list</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_existing_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>                
        
        <span class="n">wordcount</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">fr_list</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>            
            <span class="n">wordcount</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
    
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">wordcount</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">wordcount</span><span class="p">)</span>            

        <span class="c1"># Display the generated image:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replace_existing_file</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                        
        <span class="c1">#plt.show()            </span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>   <span class="c1"># Clear axis</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c1"># Clear figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close a figure window</span></div>
                        

    
    <span class="c1">#load existing model from file</span>
    <span class="c1">#predict topic of a new tweet based on model</span>
    
    
    
       

        

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Lia Nogueira

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>